<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2020-06-30" />

<title>fhircrackr: Handling HL7 FHIR resources in R</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">fhircrackr: Handling HL7 FHIR resources in R</h1>
<h4 class="date">2020-06-30</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p><code>fhircrackr</code> is a package designed to help analyzing HL7 FHIR resources.</p>
<p>FHIR stands for <em>Fast Healthcare Interoperability Resources</em> and is a standard describing data formats and elements (known as “resources”) as well as an application programming interface (API) for exchanging electronic health records. The standard was created by the Health Level Seven International (HL7) health-care standards organization. For more information on the FHIR standard, visit <a href="https://www.hl7.org/fhir/" class="uri">https://www.hl7.org/fhir/</a>.</p>
<p>While FHIR is a very useful standard to describe and exchange medical data in an interoperable way, it is not very useful for statistical analyses of said data. This is due to the fact that FHIR data is stored in many nested and interlinked resources instead of matrix-like structures.</p>
<p>Thus, to be able to do statistical analyses a tool is needed that allows converting these nested resources into data frames. This process of flattening FHIR resources is not trivial, as the unpredictable degree of nesting and connectedness of the resources makes generic solutions to this problem not feasible.</p>
<p>We therefore implemented a package that makes it possible to download FHIR resources from a server into R and to flatten these resources into (multiple) data frames.</p>
<p>The package is still under development. The CRAN version of the package contains all functions that are already stable, for more recent (but potentially unstable) developments, the development version of the package can be downloaded from GitHub using <code>devtools::install_github(&quot;POLAR-fhiR/fhircrackr&quot;)</code>.</p>
</div>
<div id="prerequisites" class="section level2">
<h2>Prerequisites</h2>
<p>The complexity of the problem requires a couple of prerequisites both regarding knowledge and access to data. We will shortly list the preconditions to using the <code>fhircrackr</code> package here:</p>
<ol style="list-style-type: decimal">
<li><p>First of all, you need the endpoint of the FHIR server you want to access. If you don’t have you own FHIR server, you can use one of the publicly available servers, such as <a href="https://hapi.fhir.org/baseR4">https://hapi.fhir.org/baseR4</a> or <a href="http://fhir.hl7.de:8080/baseDstu3">http://fhir.hl7.de:8080/baseDstu3</a>. The endpoint of a FHIR server is often referred to as [base].</p></li>
<li><p>To download ressources from the server, you should be familiar with <a href="https://www.hl7.org/fhir/search.html">FHIR search requests</a>. FHIR search allows you to download sets of resources that match very specific requirements. As the focus of this package is dealing with FHIR resources in R, rather than the intricacies of FHIR search, we will mostly use simple examples of FHIR search requests. Most of them will have the form <code>[base]/[type]?parameter(s)</code>, where <code>[type]</code> refers to the type of resource you are looking for and <code>parameter(s)</code> characterise specific properties those resources should have. <code>http://hapi.fhir.org/baseR4/Patient?gender=female</code> for example downloads all Patient resources from the fhir server at <code>http://hapi.fhir.org/baseR4/</code> that represent female patients.</p></li>
<li><p>In the first step, <code>fhircrackr</code> downloads the resources in xml format into R. To specify which elements from the FHIR resources you want in your data frame, you should have at least some familiarity with XPath expressions. A good tutorial on XPath expressions can be found <a href="https://www.w3schools.com/xml/xpath_intro.asp">here</a>.</p></li>
</ol>
<p>In the following we’ll go through a typical workflow with <code>fhircrackr</code> step by step.</p>
</div>
<div id="download-and-flatten-fhir-resources-from-a-server" class="section level2">
<h2>Download and flatten fhir resources from a server</h2>
<div id="example-1-download-patient-resources" class="section level3">
<h3>Example 1: Download Patient resources</h3>
<p>We will start with a very simple example and use <code>fhir_search()</code> to download Patient resources from a publicly available HAPI server after we’ve loaded the package with <code>library(fhircrackr)</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(fhircrackr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">patient_bundles &lt;-<span class="st"> </span><span class="kw">fhir_search</span>(<span class="dt">request=</span><span class="st">&quot;http://hapi.fhir.org/baseR4/Patient?&quot;</span>, <span class="dt">max_bundles=</span><span class="dv">2</span>)</a></code></pre></div>
<p>The minimum information <code>fhir_search()</code> requires is a string containing the full FHIR search request in the argument <code>request</code>. In general, a fhir search request returns a <em>bundle</em> of the resources you requested. If there are a lot of resources matching your request, the search result isn’t returned in one big bundle but distributed over several of them. If the argument <code>max_bundles</code> is set to its default <code>Inf</code>, <code>fhir_search()</code> will return all available bundles, meaning all resources matching your request. If you set it to <code>2</code> as in the above example, the download will stop after the first two bundles. Note that in this case, the result <em>may not contain all</em> the resources from the server matching your request.</p>
<p>If you want to connect to a fhir server that uses basic authentification, you can supply the arguments <code>username</code> and <code>password</code>.</p>
<p>Because endpoints can sometimes be hard to reach, <code>fhir_search()</code> will start five attempts to connect to the endpoint before it gives up. With the arguments <code>max_attempts</code> and <code>delay_between_attempts</code> you can control this number as well the time interval between attempts.</p>
<p>As you can see in the next block of code, <code>fhir_search()</code> returns a list of xml objects where each list element represents one bundle of resources, so a list of two xml objects in our case:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">str</span>(patient_bundles)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt;  $ http://hapi.fhir.org/baseR4/Patient?                                                                                                      :List of 2</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt;   ..$ node:&lt;externalptr&gt; </span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt;   ..$ doc :&lt;externalptr&gt; </span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt;   ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;xml_document&quot; &quot;xml_node&quot;</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt;  $ http://hapi.fhir.org/baseR4?_getpages=4e4aef4b-d689-44fc-a51f-5e9e223d9d5a&amp;_getpagesoffset=20&amp;_count=20&amp;_pretty=true&amp;_bundletype=searchset:List of 2</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt;   ..$ node:&lt;externalptr&gt; </span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt;   ..$ doc :&lt;externalptr&gt; </span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt;   ..- attr(*, &quot;class&quot;)= chr [1:2] &quot;xml_document&quot; &quot;xml_node&quot;</span></a></code></pre></div>
<p>If for some reason you cannot connect to a FHIR server at the moment but want to explore the following functions anyway, the package provides an example list of bundles containing Patient and MedicationStatement resources. See <code>?medication_bundles</code> for how to use it.</p>
<p>Now we know that inside these xml objects there is the patient data somewhere. To get it out, we will use <code>fhir_crack()</code>. The most important arguments <code>fhir_crack()</code> takes is <code>bundles</code>, the list of bundles that is returned by <code>fhir_search()</code> and <code>design</code>, an object that tells the function wich data to extract from the bundle. It returns a list of data.frames.</p>
<p>In general, <code>design</code> is a named list containing one element per data frame that will be created. The element names of <code>design</code> are going to be the names of the resulting data frames. It usually makes sense to create one data frame per type of resource. Because we have just downloaded resources of the type Patient, the <code>design</code> here would be a list of length 1.</p>
<p>The elements of <code>design</code> are lists themselves. They can be of length 1 or length 2, depending on the level of precision in extracting the attributes. There are three levels of precision in extracting the data for our data frame with <code>fhir_crack()</code>:</p>
<div id="extract-all-available-attributes" class="section level4">
<h4>1. Extract all available attributes</h4>
<p>If we want to extract all available attributes, the list describing the data frames inside design is a list of length 1, containing only an Xpath expression to the resource type we want to extract:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">#define which elements of the resources are of interest</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">design1 &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="dt">Patients =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">    <span class="st">&quot;.//Patient&quot;</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb3-7" data-line-number="7"></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#Convert resources</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">list_of_tables &lt;-<span class="st"> </span><span class="kw">fhir_crack</span>(patient_bundles, design1)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt;  Patients</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt;  1....................</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt;  2....................</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt; FHIR-Resources cracked.</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#have look at part of the results</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17">list_of_tables<span class="op">$</span>Patients[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">5</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="co">#&gt;   text.status.value text.div.div.class text.div.table.class</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="co">#&gt; 1         generated     hapiHeaderText    hapiPropertyTable</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="co">#&gt; 2         generated     hapiHeaderText    hapiPropertyTable</span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="co">#&gt; 3         generated     hapiHeaderText    hapiPropertyTable</span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22"><span class="co">#&gt; 4         generated     hapiHeaderText    hapiPropertyTable</span></a>
<a class="sourceLine" id="cb3-23" data-line-number="23"><span class="co">#&gt; 5         generated     hapiHeaderText    hapiPropertyTable</span></a>
<a class="sourceLine" id="cb3-24" data-line-number="24"><span class="co">#&gt;   identifier.type.coding.system.value identifier.type.coding.code.value</span></a>
<a class="sourceLine" id="cb3-25" data-line-number="25"><span class="co">#&gt; 1         http://hl7.org/fhir/v2/0203                                MR</span></a>
<a class="sourceLine" id="cb3-26" data-line-number="26"><span class="co">#&gt; 2         http://hl7.org/fhir/v2/0203                                MR</span></a>
<a class="sourceLine" id="cb3-27" data-line-number="27"><span class="co">#&gt; 3         http://hl7.org/fhir/v2/0203                                MR</span></a>
<a class="sourceLine" id="cb3-28" data-line-number="28"><span class="co">#&gt; 4         http://hl7.org/fhir/v2/0203                                MR</span></a>
<a class="sourceLine" id="cb3-29" data-line-number="29"><span class="co">#&gt; 5         http://hl7.org/fhir/v2/0203                                MR</span></a>
<a class="sourceLine" id="cb3-30" data-line-number="30"><span class="co">#&gt;                 identifier.value.value</span></a>
<a class="sourceLine" id="cb3-31" data-line-number="31"><span class="co">#&gt; 1 4034a31f-57cf-4dde-944e-6a3522627bb3</span></a>
<a class="sourceLine" id="cb3-32" data-line-number="32"><span class="co">#&gt; 2 4f63e2ee-fe67-468f-98de-5b322de8c9ad</span></a>
<a class="sourceLine" id="cb3-33" data-line-number="33"><span class="co">#&gt; 3 c70c62d9-4cce-46b0-ae01-96202edba35f</span></a>
<a class="sourceLine" id="cb3-34" data-line-number="34"><span class="co">#&gt; 4 46561a78-1e69-42f2-9b5e-0f46e39c6189</span></a>
<a class="sourceLine" id="cb3-35" data-line-number="35"><span class="co">#&gt; 5 f1bb77f1-60c5-4a74-abeb-4a4353d63079</span></a></code></pre></div>
<p>Note that this can easily become a rather wide and sparse data frame. This is due to the fact that every attribute appearing in at least one of the resources will be turned into a variable (i.e. column), even if none of the other resources contain this attribute. For those resources, the value on that attribute will be set to <code>NA</code>. Depnding on the variability of the resources, the resulting data frame can contain a lot of <code>NA</code> values. If a recource has multiple entries for an attribute, these are pasted together using the string provided in the argument <code>sep</code> as a seperator. The column names in this option are automatically generated by pasting together the path to the respective attribute.</p>
</div>
<div id="extract-all-attributes-at-a-certain-level" class="section level4">
<h4>2. Extract all attributes at a certain level</h4>
<p>We can extract all attributes that are found on a certain level of the resource, if we specify this level in an XPath expression and provide it as the second element of the list describing the data.frame:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">#define which elements of the resources are of interest</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">design2 &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="dt">Patients =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">    <span class="st">&quot;.//Patient&quot;</span>,</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">    <span class="st">&quot;./*/@value&quot;</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#Convert resources</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10">list_of_tables &lt;-<span class="st"> </span><span class="kw">fhir_crack</span>(patient_bundles, design2)</a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt;  Patients</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt;  1....................</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt;  2....................</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; FHIR-Resources cracked.</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#have look at the results</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="kw">head</span>(list_of_tables<span class="op">$</span>Patients)</a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt;   id.value gender.value birthDate.value active.value deceasedBoolean.value</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">#&gt; 1   642193         &lt;NA&gt;            &lt;NA&gt;         &lt;NA&gt;                  &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="co">#&gt; 2   642194         &lt;NA&gt;            &lt;NA&gt;         &lt;NA&gt;                  &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="co">#&gt; 3   642201         &lt;NA&gt;            &lt;NA&gt;         &lt;NA&gt;                  &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">#&gt; 4   642202         &lt;NA&gt;            &lt;NA&gt;         &lt;NA&gt;                  &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="co">#&gt; 5   642209         &lt;NA&gt;            &lt;NA&gt;         &lt;NA&gt;                  &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="co">#&gt; 6   642210         &lt;NA&gt;            &lt;NA&gt;         &lt;NA&gt;                  &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb4-26" data-line-number="26"><span class="co">#&gt;   multipleBirthBoolean.value</span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="co">#&gt; 1                       &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="co">#&gt; 2                       &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29"><span class="co">#&gt; 3                       &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="co">#&gt; 4                       &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31"><span class="co">#&gt; 5                       &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32"><span class="co">#&gt; 6                       &lt;NA&gt;</span></a></code></pre></div>
<p><code>&quot;./*/@value&quot;</code> for example tells <code>fhir_crack()</code> to extract all attributes that are located (exactly) one level below the root level.</p>
</div>
<div id="extract-specific-attributes" class="section level4">
<h4>3. Extract specific attributes</h4>
<p>If we know exactly which attributes we want to extract, we can specify them in a named list that we provide as the second element of the list describing the data.frame:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">#define which elements of the resources are of interest</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">design3 &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">    </a>
<a class="sourceLine" id="cb5-4" data-line-number="4">    <span class="dt">Patients =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">        <span class="st">&quot;.//Patient&quot;</span>,</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">        <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">            <span class="dt">PID           =</span> <span class="st">&quot;id/@value&quot;</span>,</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">            <span class="dt">NAME.USE      =</span> <span class="st">&quot;name/use/@value&quot;</span>,</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">            <span class="dt">NAME.GIVEN    =</span> <span class="st">&quot;name/given/@value&quot;</span>,</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">            <span class="dt">NAME.FAMILY   =</span> <span class="st">&quot;name/family/@value&quot;</span>,</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">            <span class="dt">GENDER        =</span> <span class="st">&quot;gender/@value&quot;</span>,</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">            <span class="dt">BIRTHDAY      =</span> <span class="st">&quot;birthDate/@value&quot;</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13">        )</a>
<a class="sourceLine" id="cb5-14" data-line-number="14">    )</a>
<a class="sourceLine" id="cb5-15" data-line-number="15">) </a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#Convert resources</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17">list_of_tables &lt;-<span class="st"> </span><span class="kw">fhir_crack</span>(patient_bundles, design3)</a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">#&gt;  Patients</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co">#&gt;  1....................</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="co">#&gt;  2....................</span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="co">#&gt; FHIR-Resources cracked.</span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"><span class="co">#have look at the results</span></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="kw">head</span>(list_of_tables<span class="op">$</span>Patients)</a>
<a class="sourceLine" id="cb5-26" data-line-number="26"><span class="co">#&gt;      PID NAME.USE NAME.GIVEN NAME.FAMILY GENDER BIRTHDAY</span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="co">#&gt; 1 642193                 Bob   Alexander                </span></a>
<a class="sourceLine" id="cb5-28" data-line-number="28"><span class="co">#&gt; 2 642194               Caleb     Cushing                </span></a>
<a class="sourceLine" id="cb5-29" data-line-number="29"><span class="co">#&gt; 3 642201                 Bob   Alexander                </span></a>
<a class="sourceLine" id="cb5-30" data-line-number="30"><span class="co">#&gt; 4 642202               Caleb     Cushing                </span></a>
<a class="sourceLine" id="cb5-31" data-line-number="31"><span class="co">#&gt; 5 642209                 Bob   Alexander                </span></a>
<a class="sourceLine" id="cb5-32" data-line-number="32"><span class="co">#&gt; 6 642210               Caleb     Cushing</span></a></code></pre></div>
<p>This options will usually return the most tidy and clear data frames. You should always extract the resource id, because this is used to link to other resources you might also extract. If you are not sure which attributes are available or where they are located in the resource, it can be helpful to start by extracting all availabe attributes. Then you can get an overview over the available attributes and their location and continue by doing a second, more targeted extraction to get your final data frame.</p>
<p>Of course the previous example is using just one resource type. If you are interested in several types of resources, <code>design</code> will have more elements and the result will be a list of several data frames.</p>
<p>The abstract form <code>design</code> should therefore have is:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">    </a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#Option 1: extract all attributes   </span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="op">&lt;</span>Name of first data frame<span class="op">&gt;</span><span class="st"> </span><span class="er">=</span><span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">    <span class="op">&lt;</span>XPath to resource type<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">  </span>),</a>
<a class="sourceLine" id="cb6-7" data-line-number="7"></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#Option 2: extract attributes from certain level  </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9">  <span class="op">&lt;</span>Name of second data frame<span class="op">&gt;</span><span class="st"> </span><span class="er">=</span><span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">    <span class="op">&lt;</span>XPath to resource type<span class="op">&gt;</span>,</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">    <span class="op">&lt;</span>XPath indicating attribute level<span class="op">&gt;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="st">  </span>),</a>
<a class="sourceLine" id="cb6-13" data-line-number="13"></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#Option 3: extract specific attributes  </span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15">  <span class="op">&lt;</span>Name of third data frame<span class="op">&gt;</span><span class="st"> </span><span class="er">=</span><span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">    <span class="op">&lt;</span>XPath to resource type<span class="op">&gt;</span>,</a>
<a class="sourceLine" id="cb6-17" data-line-number="17">    <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb6-18" data-line-number="18">      <span class="op">&lt;</span>column name <span class="dv">1</span><span class="op">&gt;</span><span class="st"> </span><span class="er">=</span><span class="st"> </span><span class="er">&lt;</span>XPath to attribute<span class="op">&gt;</span>,</a>
<a class="sourceLine" id="cb6-19" data-line-number="19">      <span class="op">&lt;</span>column name <span class="dv">2</span><span class="op">&gt;</span><span class="st"> </span><span class="er">=</span><span class="st"> </span><span class="er">&lt;</span>XPath to attribute<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="st">      </span>...</a>
<a class="sourceLine" id="cb6-21" data-line-number="21">    ) </a>
<a class="sourceLine" id="cb6-22" data-line-number="22">  ),</a>
<a class="sourceLine" id="cb6-23" data-line-number="23">  ...</a>
<a class="sourceLine" id="cb6-24" data-line-number="24">)</a></code></pre></div>
</div>
</div>
<div id="example-2-download-medicationstatement-and-corresponding-patient-resources" class="section level3">
<h3>Example 2: Download MedicationStatement and corresponding Patient resources</h3>
<p>In reality your FHIR search requests are probably going to be slightly more complex than just asking for Patient resources. Consider the following example where we want to download MedicationStatements refering to a certain medication we specify with its snomed code and also the Patient resources the MedicationStatements are linked to.</p>
<p>When the FHIR search request gets longer, it can be helpful to build up the request piece by piece like this:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">search_request  &lt;-<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  <span class="st">&quot;https://hapi.fhir.org/baseR4/&quot;</span>, <span class="co">#server endpoint</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  <span class="st">&quot;MedicationStatement?&quot;</span>, <span class="co">#look for MedicationsStatements</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">  <span class="st">&quot;code=http://snomed.info/ct|429374003&quot;</span>, <span class="co">#only choose resources with this loinc code</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">  <span class="st">&quot;&amp;_include=MedicationStatement:subject&quot;</span>) <span class="co">#include the corresponding Patient resources</span></a></code></pre></div>
<p>Then we can download the resources:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">medication_bundles &lt;-<span class="st"> </span><span class="kw">fhir_search</span>(search_request, <span class="dt">max_bundles =</span> <span class="dv">3</span>)</a></code></pre></div>
<p>And convert them into to data frames, one for the MedicationStatements and one for the Patients:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">design &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">    <span class="dt">MedicationStatement =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">        <span class="st">&quot;.//MedicationStatement&quot;</span>,</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">        <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">            <span class="dt">MS.ID              =</span> <span class="st">&quot;id/@value&quot;</span>,</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">            <span class="dt">STATUS.TEXT        =</span> <span class="st">&quot;text/status/@value&quot;</span>,</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">            <span class="dt">STATUS             =</span> <span class="st">&quot;status/@value&quot;</span>,</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">            <span class="dt">MEDICATION.SYSTEM  =</span> <span class="st">&quot;medicationCodeableConcept/coding/system/@value&quot;</span>,</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">            <span class="dt">MEDICATION.CODE    =</span> <span class="st">&quot;medicationCodeableConcept/coding/code/@value&quot;</span>,</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">            <span class="dt">MEDICATION.DISPLAY =</span> <span class="st">&quot;medicationCodeableConcept/coding/display/@value&quot;</span>,</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">            <span class="dt">DOSAGE             =</span> <span class="st">&quot;dosage/text/@value&quot;</span>,</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">            <span class="dt">PATIENT            =</span> <span class="st">&quot;subject/reference/@value&quot;</span>,</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">            <span class="dt">LAST.UPDATE        =</span> <span class="st">&quot;meta/lastUpdated/@value&quot;</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17">        )</a>
<a class="sourceLine" id="cb9-18" data-line-number="18">    ),</a>
<a class="sourceLine" id="cb9-19" data-line-number="19"></a>
<a class="sourceLine" id="cb9-20" data-line-number="20">    <span class="dt">Patients =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb9-21" data-line-number="21"></a>
<a class="sourceLine" id="cb9-22" data-line-number="22">        <span class="st">&quot;.//Patient&quot;</span>,</a>
<a class="sourceLine" id="cb9-23" data-line-number="23">        <span class="st">&quot;./*/@value&quot;</span></a>
<a class="sourceLine" id="cb9-24" data-line-number="24">    )</a>
<a class="sourceLine" id="cb9-25" data-line-number="25">)</a>
<a class="sourceLine" id="cb9-26" data-line-number="26"></a>
<a class="sourceLine" id="cb9-27" data-line-number="27"></a>
<a class="sourceLine" id="cb9-28" data-line-number="28">list_of_tables &lt;-<span class="st"> </span><span class="kw">fhir_crack</span>(medication_bundles, design)</a>
<a class="sourceLine" id="cb9-29" data-line-number="29"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-30" data-line-number="30"><span class="co">#&gt;  MedicationStatement</span></a>
<a class="sourceLine" id="cb9-31" data-line-number="31"><span class="co">#&gt;  1....................</span></a>
<a class="sourceLine" id="cb9-32" data-line-number="32"><span class="co">#&gt;  2....................</span></a>
<a class="sourceLine" id="cb9-33" data-line-number="33"><span class="co">#&gt;  3....................</span></a>
<a class="sourceLine" id="cb9-34" data-line-number="34"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-35" data-line-number="35"><span class="co">#&gt;  Patients</span></a>
<a class="sourceLine" id="cb9-36" data-line-number="36"><span class="co">#&gt;  1....................</span></a>
<a class="sourceLine" id="cb9-37" data-line-number="37"><span class="co">#&gt;  2....................</span></a>
<a class="sourceLine" id="cb9-38" data-line-number="38"><span class="co">#&gt;  3....................</span></a>
<a class="sourceLine" id="cb9-39" data-line-number="39"><span class="co">#&gt; FHIR-Resources cracked.</span></a>
<a class="sourceLine" id="cb9-40" data-line-number="40"></a>
<a class="sourceLine" id="cb9-41" data-line-number="41"><span class="kw">head</span>(list_of_tables<span class="op">$</span>MedicationStatement)</a>
<a class="sourceLine" id="cb9-42" data-line-number="42"><span class="co">#&gt;   MS.ID STATUS.TEXT STATUS     MEDICATION.SYSTEM MEDICATION.CODE</span></a>
<a class="sourceLine" id="cb9-43" data-line-number="43"><span class="co">#&gt; 1 30233   generated active http://snomed.info/ct       429374003</span></a>
<a class="sourceLine" id="cb9-44" data-line-number="44"><span class="co">#&gt; 2 42012   generated active http://snomed.info/ct       429374003</span></a>
<a class="sourceLine" id="cb9-45" data-line-number="45"><span class="co">#&gt; 3 42091   generated active http://snomed.info/ct       429374003</span></a>
<a class="sourceLine" id="cb9-46" data-line-number="46"><span class="co">#&gt; 4 45646   generated active http://snomed.info/ct       429374003</span></a>
<a class="sourceLine" id="cb9-47" data-line-number="47"><span class="co">#&gt; 5 45724   generated active http://snomed.info/ct       429374003</span></a>
<a class="sourceLine" id="cb9-48" data-line-number="48"><span class="co">#&gt; 6 45802   generated active http://snomed.info/ct       429374003</span></a>
<a class="sourceLine" id="cb9-49" data-line-number="49"><span class="co">#&gt;   MEDICATION.DISPLAY           DOSAGE       PATIENT</span></a>
<a class="sourceLine" id="cb9-50" data-line-number="50"><span class="co">#&gt; 1   simvastatin 40mg 1 tab once daily Patient/30163</span></a>
<a class="sourceLine" id="cb9-51" data-line-number="51"><span class="co">#&gt; 2   simvastatin 40mg 1 tab once daily Patient/41945</span></a>
<a class="sourceLine" id="cb9-52" data-line-number="52"><span class="co">#&gt; 3   simvastatin 40mg 1 tab once daily Patient/42024</span></a>
<a class="sourceLine" id="cb9-53" data-line-number="53"><span class="co">#&gt; 4   simvastatin 40mg 1 tab once daily Patient/45579</span></a>
<a class="sourceLine" id="cb9-54" data-line-number="54"><span class="co">#&gt; 5   simvastatin 40mg 1 tab once daily Patient/45657</span></a>
<a class="sourceLine" id="cb9-55" data-line-number="55"><span class="co">#&gt; 6   simvastatin 40mg 1 tab once daily Patient/45735</span></a>
<a class="sourceLine" id="cb9-56" data-line-number="56"><span class="co">#&gt;                     LAST.UPDATE</span></a>
<a class="sourceLine" id="cb9-57" data-line-number="57"><span class="co">#&gt; 1 2019-09-26T14:34:44.543+00:00</span></a>
<a class="sourceLine" id="cb9-58" data-line-number="58"><span class="co">#&gt; 2 2019-10-09T20:12:49.778+00:00</span></a>
<a class="sourceLine" id="cb9-59" data-line-number="59"><span class="co">#&gt; 3 2019-10-09T22:44:05.728+00:00</span></a>
<a class="sourceLine" id="cb9-60" data-line-number="60"><span class="co">#&gt; 4 2019-10-11T16:17:42.365+00:00</span></a>
<a class="sourceLine" id="cb9-61" data-line-number="61"><span class="co">#&gt; 5 2019-10-11T16:30:24.411+00:00</span></a>
<a class="sourceLine" id="cb9-62" data-line-number="62"><span class="co">#&gt; 6 2019-10-11T16:32:05.206+00:00</span></a>
<a class="sourceLine" id="cb9-63" data-line-number="63"></a>
<a class="sourceLine" id="cb9-64" data-line-number="64"><span class="kw">head</span>(list_of_tables<span class="op">$</span>Patients)</a>
<a class="sourceLine" id="cb9-65" data-line-number="65"><span class="co">#&gt;   id.value gender.value birthDate.value</span></a>
<a class="sourceLine" id="cb9-66" data-line-number="66"><span class="co">#&gt; 1    60096         male      2019-11-13</span></a>
<a class="sourceLine" id="cb9-67" data-line-number="67"><span class="co">#&gt; 2    49443       female      1970-10-19</span></a>
<a class="sourceLine" id="cb9-68" data-line-number="68"><span class="co">#&gt; 3    46213       female      2019-10-11</span></a>
<a class="sourceLine" id="cb9-69" data-line-number="69"><span class="co">#&gt; 4    45735         male      1970-10-11</span></a>
<a class="sourceLine" id="cb9-70" data-line-number="70"><span class="co">#&gt; 5    42024       female      1979-10-09</span></a>
<a class="sourceLine" id="cb9-71" data-line-number="71"><span class="co">#&gt; 6    58504         male      2019-11-08</span></a></code></pre></div>
<p>As you can see, the result now contains two data frames, one for Patient resources and one for MedicationStatement resources.</p>
</div>
<div id="example-3-multiple-entries" class="section level3">
<h3>Example 3: Multiple entries</h3>
<p>A particularly complicated problem in flattening FHIR resources is caused by the fact that there can be multiple entries to an attribute. The profile your FHIR resources have been built by defines how often a particular attribute can appear in a resource. This is called the <em>cardinality</em> of the attribute. For example the Patient resource defined <a href="https://www.hl7.org/fhir/patient.html#resource">here</a> can have zero or one birthdates but arbitratily many addresses. In general, <code>fhir_crack()</code> will paste multiple entries for same attribute together, using the seperator provided by the <code>sep</code> argument. In most cases this will work just fine, but there are some special cases that require a little more attention.</p>
<p>Let’s have a look at the following example, where we have a bundle containing just two Patient resources:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">bundle&lt;-xml2<span class="op">::</span><span class="kw">read_xml</span>(</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">    <span class="st">&quot;&lt;Bundle&gt;</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">        </span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">        &lt;Patient&gt;</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="st">            &lt;id value='id1'/&gt;</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="st">            &lt;address&gt;</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="st">                &lt;use value='home'/&gt;</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="st">                &lt;city value='Amsterdam'/&gt;</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="st">                &lt;type value='physical'/&gt;</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="st">                &lt;country value='Netherlands'/&gt;</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="st">            &lt;/address&gt;</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="st">            &lt;birthDate value='1992-02-06'/&gt;</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="st">        &lt;/Patient&gt;</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="st">        </span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="st">        &lt;Patient&gt;</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="st">            &lt;id value='id2'/&gt;</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="st">            &lt;address&gt;</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="st">                &lt;use value='home'/&gt;</span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="st">                &lt;city value='Rome'/&gt;</span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="st">                &lt;type value='physical'/&gt;</span></a>
<a class="sourceLine" id="cb10-21" data-line-number="21"><span class="st">                &lt;country value='Italy'/&gt;</span></a>
<a class="sourceLine" id="cb10-22" data-line-number="22"><span class="st">            &lt;/address&gt;</span></a>
<a class="sourceLine" id="cb10-23" data-line-number="23"><span class="st">            &lt;address&gt;</span></a>
<a class="sourceLine" id="cb10-24" data-line-number="24"><span class="st">                &lt;use value='work'/&gt;</span></a>
<a class="sourceLine" id="cb10-25" data-line-number="25"><span class="st">                &lt;city value='Stockholm'/&gt;</span></a>
<a class="sourceLine" id="cb10-26" data-line-number="26"><span class="st">                &lt;type value='postal'/&gt;</span></a>
<a class="sourceLine" id="cb10-27" data-line-number="27"><span class="st">                &lt;country value='Sweden'/&gt;</span></a>
<a class="sourceLine" id="cb10-28" data-line-number="28"><span class="st">            &lt;/address&gt;          </span></a>
<a class="sourceLine" id="cb10-29" data-line-number="29"><span class="st">            &lt;birthDate value='1980-05-23'/&gt;</span></a>
<a class="sourceLine" id="cb10-30" data-line-number="30"><span class="st">        &lt;/Patient&gt;</span></a>
<a class="sourceLine" id="cb10-31" data-line-number="31"><span class="st">        </span></a>
<a class="sourceLine" id="cb10-32" data-line-number="32"><span class="st">        &lt;Patient&gt;</span></a>
<a class="sourceLine" id="cb10-33" data-line-number="33"><span class="st">                &lt;id value='id3'/&gt; </span></a>
<a class="sourceLine" id="cb10-34" data-line-number="34"><span class="st">                &lt;address&gt;</span></a>
<a class="sourceLine" id="cb10-35" data-line-number="35"><span class="st">                    &lt;use value='home'/&gt;</span></a>
<a class="sourceLine" id="cb10-36" data-line-number="36"><span class="st">                    &lt;city value='Berlin'/&gt;</span></a>
<a class="sourceLine" id="cb10-37" data-line-number="37"><span class="st">                &lt;/address&gt;</span></a>
<a class="sourceLine" id="cb10-38" data-line-number="38"><span class="st">                &lt;address&gt;</span></a>
<a class="sourceLine" id="cb10-39" data-line-number="39"><span class="st">                    &lt;type value='postal'/&gt;</span></a>
<a class="sourceLine" id="cb10-40" data-line-number="40"><span class="st">                    &lt;country value='France'/&gt;</span></a>
<a class="sourceLine" id="cb10-41" data-line-number="41"><span class="st">                &lt;/address&gt;</span></a>
<a class="sourceLine" id="cb10-42" data-line-number="42"><span class="st">                &lt;address&gt;</span></a>
<a class="sourceLine" id="cb10-43" data-line-number="43"><span class="st">                    &lt;use value='work'/&gt;</span></a>
<a class="sourceLine" id="cb10-44" data-line-number="44"><span class="st">                    &lt;city value='London'/&gt;</span></a>
<a class="sourceLine" id="cb10-45" data-line-number="45"><span class="st">                    &lt;type value='postal'/&gt;</span></a>
<a class="sourceLine" id="cb10-46" data-line-number="46"><span class="st">                    &lt;country value='England'/&gt;</span></a>
<a class="sourceLine" id="cb10-47" data-line-number="47"><span class="st">                &lt;/address&gt;</span></a>
<a class="sourceLine" id="cb10-48" data-line-number="48"><span class="st">                &lt;birthDate value='1974-12-25'/&gt;</span></a>
<a class="sourceLine" id="cb10-49" data-line-number="49"><span class="st">            &lt;/Patient&gt;      </span></a>
<a class="sourceLine" id="cb10-50" data-line-number="50"><span class="st">        </span></a>
<a class="sourceLine" id="cb10-51" data-line-number="51"><span class="st">    &lt;/Bundle&gt;&quot;</span></a>
<a class="sourceLine" id="cb10-52" data-line-number="52">)</a>
<a class="sourceLine" id="cb10-53" data-line-number="53"></a>
<a class="sourceLine" id="cb10-54" data-line-number="54">bundle_list&lt;-<span class="kw">list</span>(bundle)</a></code></pre></div>
<p>This bundle contains three Patient resources. The first resource has just one entry for the address attribute. The second Patient resource has two entries containing the same elements for the address attribute. The third Patient resource has a rather messy address attribute, with three entries containing different elements.</p>
<p>Let’s see what happens if we extract all attributes:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">design1 &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">    <span class="dt">Patients =</span> <span class="kw">list</span>(<span class="st">&quot;.//Patient&quot;</span>)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">df1 &lt;-<span class="st"> </span><span class="kw">fhir_crack</span>(bundle_list, design1, <span class="dt">sep =</span> <span class="st">&quot; | &quot;</span>,)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt;  Patients</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt;  1...</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt; FHIR-Resources cracked.</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10">df1<span class="op">$</span>Patients</a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt;   id.value address.use.value address.city.value address.type.value</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt; 1      id1              home          Amsterdam           physical</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt; 2      id2       home | work   Rome | Stockholm  physical | postal</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt; 3      id3       home | work    Berlin | London    postal | postal</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt;   address.country.value birthDate.value</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt; 1           Netherlands      1992-02-06</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt; 2        Italy | Sweden      1980-05-23</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt; 3      France | England      1974-12-25</span></a></code></pre></div>
<p>As you can see, multiple entries for the same attribute (address) are pasted together. This works fine for Patient 2, but for Patient 3 you can see a problem with the number of entries that are displayed. The original Patient resource had <em>three</em> (inclomplete) <code>address</code> entries, but because the first two of them use complementary elements (<code>use</code> and <code>city</code> vs. <code>type</code> and <code>country</code>), the resulting pasted entries look like there had just been two entries for the <code>address</code> attribute.</p>
<p>You can counter this problem with the <code>add_indices</code> argument and customize the appearance of the indices with <code>brackets</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">design2 &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">    <span class="dt">Patients =</span> <span class="kw">list</span>(<span class="st">&quot;.//Patient&quot;</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">df2 &lt;-<span class="st"> </span><span class="kw">fhir_crack</span>(bundle_list, design1, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>, <span class="dt">add_indices =</span> T, <span class="dt">brackets =</span> <span class="kw">c</span>(<span class="st">&quot;&lt;&quot;</span>, <span class="st">&quot;&gt;&quot;</span>) )</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt;  Patients</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt;  1...</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt; FHIR-Resources cracked.</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10">df2<span class="op">$</span>Patients</a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt;   id.value   address.use.value       address.city.value</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt; 1   &lt;1&gt;id1           &lt;1.1&gt;home           &lt;1.1&gt;Amsterdam</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">#&gt; 2   &lt;1&gt;id2 &lt;1.1&gt;home &lt;2.1&gt;work &lt;1.1&gt;Rome &lt;2.1&gt;Stockholm</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co">#&gt; 3   &lt;1&gt;id3 &lt;1.1&gt;home &lt;3.1&gt;work  &lt;1.1&gt;Berlin &lt;3.1&gt;London</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co">#&gt;          address.type.value    address.country.value birthDate.value</span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="co">#&gt; 1             &lt;1.1&gt;physical         &lt;1.1&gt;Netherlands   &lt;1&gt;1992-02-06</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co">#&gt; 2 &lt;1.1&gt;physical &lt;2.1&gt;postal   &lt;1.1&gt;Italy &lt;2.1&gt;Sweden   &lt;1&gt;1980-05-23</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="co">#&gt; 3   &lt;2.1&gt;postal &lt;3.1&gt;postal &lt;2.1&gt;France &lt;3.1&gt;England   &lt;1&gt;1974-12-25</span></a></code></pre></div>
<p>Now the indices display the entry the value belongs to. That way you can see that Patient resource 3 had three entries for the attribute <code>address</code> and you can also see which attributes belong to which entry.</p>
<p>Of course this is a very specific that only occurs if your resources have multiple entries with complementary elements. In the vast majority of cases multiple entries in one resource will look identical, thus making numbering of those entries superfluous.</p>
</div>
</div>
<div id="save-and-load-downloaded-bundles" class="section level2">
<h2>Save and load downloaded bundles</h2>
<p>Since <code>fhir_crack()</code> discards of all the data not specified in <code>design</code> it makes sense to store the original search result for reproducibility and in case you realise later on that you need elements from the resources that you haven’t extracted at first.</p>
<p>There are two ways of saving the FHIR bundles you downloaded: Either you save them as R objects, or you write them to an xml file.</p>
<div id="save-and-load-bundles-as-r-objects" class="section level3">
<h3>Save and load bundles as R objects</h3>
<p>If you want to save the list of downloaded bundles as an <code>.rda</code> or <code>.RData</code> file, you cannot just R’s <code>save()</code>or <code>save_image()</code> on it, because this will break the external pointers in the xml objects representing your bundles. Instead, you have to serialize the bundles before saving and unserialize them after loading. For single xml objects the package <code>xml2</code> proved serialization functions. For convenience, however, <code>fhircrackr</code> provides the functions <code>fhir_serialize()</code> and <code>fhir_unserialize()</code> that you can use directly on the list of bundles returned by <code>fhir_search()</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co">#serialize bundles</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">serialized_bundles &lt;-<span class="st"> </span><span class="kw">fhir_serialize</span>(patient_bundles)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co">#have a look at them</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="kw">head</span>(serialized_bundles[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co">#&gt; [1] 58 0a 00 00 00 03</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#save</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="kw">save</span>(serialized_bundles, <span class="dt">file=</span><span class="st">&quot;bundles.rda&quot;</span>)</a></code></pre></div>
<p>If you load this bundle again, you have to unserialize it, before you can work with it:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co">#load bundles</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw">load</span>(<span class="st">&quot;bundles.rda&quot;</span>)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co">#unserialize</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">bundles &lt;-<span class="st"> </span><span class="kw">fhir_unserialize</span>(serialized_bundles)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6"></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co">#have a look</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="kw">head</span>(bundles[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">#&gt; $node</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt; &lt;pointer: 0x5644af907640&gt;</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">#&gt; $doc</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co">#&gt; &lt;pointer: 0x5644b05fb750&gt;</span></a></code></pre></div>
<p>After unserialization, the pointers are restored and you can continue to work with the bundles. Note that the example bundle <code>medication_bundles</code> that is provided with the <code>fhircrackr</code> package is also provided in its serialized form and has to be unserialized as described on its help page.</p>
</div>
<div id="save-and-load-bundles-as-xml-files" class="section level3">
<h3>Save and load bundles as xml files</h3>
<p>If you want to store the bundles in xml files instead of R objects, you can use the functions <code>fhir_save()</code> and <code>fhir_load()</code>. <code>fhir_save()</code> takes a list of bundles in form of xml objects (as returned by <code>fhir_search()</code>) and writes them into the directory specified in the argument <code>directory</code>. Each bundle is saved as a seperate xml-file. If the folder defined in <code>directory</code> doesn’t exist, it is created in the current working directory.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co">#save bundles as xml files</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">fhir_save</span>(patient_bundles, <span class="dt">directory=</span><span class="st">&quot;MyDirectory&quot;</span>)</a></code></pre></div>
<p>To read bundles saved with <code>fhir_save()</code> back into R, you can use <code>fhir_load()</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">bundles &lt;-<span class="st"> </span><span class="kw">fhir_load</span>(<span class="st">&quot;MyDirectory&quot;</span>)</a></code></pre></div>
<p><code>fhir_load()</code> takes the name of the directory (or path to it) as its only argument. All xml-files in this directory will be read into R and returned as a list of bundles in xml format just as returned by <code>fhir_search()</code>.</p>
</div>
</div>
<div id="download-capability-statement" class="section level2">
<h2>Download capability statement</h2>
<p>The <a href="https://www.hl7.org/fhir/capabilitystatement.html">capability statement</a> documents a set of capabilities (behaviors) of a FHIR Server for a particular version of FHIR. You can download this statement using the function <code>fhir_capability_statement()</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">cap &lt;-<span class="st"> </span><span class="kw">fhir_capability_statement</span>(<span class="st">&quot;http://hapi.fhir.org/baseR4/&quot;</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="co">#&gt; Download completed. All available bundles were downloaded.</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="co">#&gt; FHIR-Resources cracked.</span></a></code></pre></div>
<p><code>fhir_capability_statement()</code> takes a FHIR server endpoint and returns a list of data frames containing all information from the capability statement of this server.</p>
<p>You can then access the parts that interest you, for example:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">cap<span class="op">$</span>META<span class="op">$</span>software.version</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="co">#&gt; NULL</span></a></code></pre></div>
</div>
<div id="further-options" class="section level2">
<h2>Further Options</h2>
<div id="extract-data-below-resource-level" class="section level3">
<h3>Extract data below resource level</h3>
<p>While we recommend extracting exactly one data frame per resource, it is technically possible to choose a different level per data frame:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">design &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">    <span class="dt">MedCodes=</span><span class="kw">list</span>(<span class="st">&quot;.//medicationCodeableConcept/coding&quot;</span>)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">)</a>
<a class="sourceLine" id="cb19-4" data-line-number="4"></a>
<a class="sourceLine" id="cb19-5" data-line-number="5">df &lt;-<span class="st"> </span><span class="kw">fhir_crack</span>(medication_bundles, design)</a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="co">#&gt;  MedCodes</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="co">#&gt;  1....................</span></a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="co">#&gt;  2....................</span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10"><span class="co">#&gt;  3....................</span></a>
<a class="sourceLine" id="cb19-11" data-line-number="11"><span class="co">#&gt; FHIR-Resources cracked.</span></a>
<a class="sourceLine" id="cb19-12" data-line-number="12"></a>
<a class="sourceLine" id="cb19-13" data-line-number="13"><span class="kw">head</span>(df<span class="op">$</span>MedCodes)</a>
<a class="sourceLine" id="cb19-14" data-line-number="14"><span class="co">#&gt;            system.value code.value    display.value</span></a>
<a class="sourceLine" id="cb19-15" data-line-number="15"><span class="co">#&gt; 1 http://snomed.info/ct  429374003 simvastatin 40mg</span></a>
<a class="sourceLine" id="cb19-16" data-line-number="16"><span class="co">#&gt; 2 http://snomed.info/ct  429374003 simvastatin 40mg</span></a>
<a class="sourceLine" id="cb19-17" data-line-number="17"><span class="co">#&gt; 3 http://snomed.info/ct  429374003 simvastatin 40mg</span></a>
<a class="sourceLine" id="cb19-18" data-line-number="18"><span class="co">#&gt; 4 http://snomed.info/ct  429374003 simvastatin 40mg</span></a>
<a class="sourceLine" id="cb19-19" data-line-number="19"><span class="co">#&gt; 5 http://snomed.info/ct  429374003 simvastatin 40mg</span></a>
<a class="sourceLine" id="cb19-20" data-line-number="20"><span class="co">#&gt; 6 http://snomed.info/ct  429374003 simvastatin 40mg</span></a></code></pre></div>
<p>The above example shows that instead of the MedicationStatement resource, we can choose the MedicationCodeableConcept as the root level for our extraction. This can be useful to get a quick and relatively clean overview over the types of codes used on this level of the resource. It is however important to note that this mode of extraction makes it impossible to recognise if each row belongs to one ressource of if several of these rows came from the same ressource. This of course also means that you cannot link this information to data from other ressources because this extraction mode discards of that information.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
