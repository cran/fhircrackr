<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2024-03-21" />

<title>fhircrackr Intro: Handling HL7® FHIR® Resources in R</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">fhircrackr Intro: Handling HL7® FHIR®
Resources in R</h1>
<h4 class="date">2024-03-21</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p><code>fhircrackr</code> is a package designed to help analyzing HL7
FHIR<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
resources.</p>
<p>FHIR stands for <em>Fast Healthcare Interoperability Resources</em>
and is a standard describing data formats and elements (known as
“resources”) as well as an application programming interface (API) for
exchanging electronic health records. The standard was created by the
Health Level Seven International (HL7) health-care standards
organization. For more information on the FHIR standard, visit
<a href="https://www.hl7.org/fhir/" target="_blank">https://www.hl7.org/fhir/</a>.</p>
<p>While FHIR is a very useful standard to describe and exchange medical
data in an interoperable way, it is not at all useful for statistical
analyses of data. This is due to the fact that FHIR data is stored in
many nested and interlinked resources instead of matrix-like
structures.</p>
<p>Thus, to be able to do statistical analyses a tool is needed that
allows converting these nested resources into data frames. This process
of tabulating FHIR resources is not trivial, as the unpredictable degree
of nesting and connectedness of the resources makes generic solutions to
this problem not feasible.</p>
<p>We therefore implemented a package that makes it possible to download
FHIR resources from a server into R and to tabulate these resources into
(multiple) data frames.</p>
<p>The package is still under development. The CRAN version of the
package contains all functions that are already stable, for more recent
(but potentially unstable) developments, the development version of the
package can be downloaded from GitHub using
<code>devtools::install_github(&quot;POLAR-fhiR/fhircrackr&quot;)</code>.</p>
<p>This vignette is an introduction on the basic functionalities of the
<code>fhircrackr</code> and should give you a broad overview over what
the package can do. For more detailed instructions on each subtopic
please have a look the other vignettes. This introduction covers the
following topics:</p>
<ul>
<li><p>Prerequisites</p></li>
<li><p>Downloading resources from a FHIR server</p></li>
<li><p>Flattening resources</p></li>
<li><p>Multiple entries</p></li>
<li><p>Saving and loading downloaded bundles</p></li>
</ul>
</div>
<div id="prerequisites" class="section level2">
<h2>Prerequisites</h2>
<p>The complexity of the problem requires a couple of prerequisites both
regarding your knowledge and access to data. We will shortly list the
preconditions for using the <code>fhircrackr</code> package here:</p>
<ol style="list-style-type: decimal">
<li><p>First of all, you need the base URL of the FHIR server you want
to access. If you don’t have your own FHIR server, you can use one of
the available public servers, such as
<code>https://hapi.fhir.org/baseR4</code> or
<code>http://fhir.hl7.de:8080/baseDstu3</code>. The base URL of a FHIR
server is often referred to as [base].</p></li>
<li><p>To download resources from the server, you should be familiar
with <a href="https://www.hl7.org/fhir/search.html" target="_blank">FHIR
search requests</a>. FHIR search allows you to download sets of
resources that match very specific requirements. The
<code>fhircrackr</code> package offers some help building FHIR search
requests, for this please see the vignette on downloading FHIR
resources.</p></li>
<li><p>In the first step, <code>fhircrackr</code> downloads the
resources in xml format into R. To specify which elements from the FHIR
resources you want in your data frame, you should have at least some
familiarity with XPath expressions. A good tutorial on XPath expressions
can be found here:
<a href="https://www.w3schools.com/xml/xpath_intro.asp" target="_blank">https://www.w3schools.com/xml/xpath_intro.asp</a>.</p></li>
</ol>
<p>In the following we’ll go through a typical workflow with
<code>fhircrackr</code> step by step. The first and foremost step is of
course, to install and load the package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;fhircrackr&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(fhircrackr)</span></code></pre></div>
</div>
<div id="downloading-resources" class="section level2">
<h2>Downloading resources</h2>
<p>To download resources from a FHIR server, you need to send a FHIR
search request using <code>fhir_search()</code>. This introduction will
not go into the details of building a valid FHIR search request. For
that, please see the vignette on downloading FHIR resources or have a
look at <code>?fhir_url</code>. Here we will use a simple example of
downloading all Patient resources from a public HAPI server:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>request <span class="ot">&lt;-</span> <span class="fu">fhir_url</span>(<span class="at">url =</span> <span class="st">&quot;http://fhir.hl7.de:8080/baseDstu3&quot;</span>, <span class="at">resource =</span> <span class="st">&quot;Patient&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>patient_bundles <span class="ot">&lt;-</span> <span class="fu">fhir_search</span>(<span class="at">request =</span> request, <span class="at">max_bundles =</span> <span class="dv">2</span>, <span class="at">verbose =</span> <span class="dv">0</span>)</span></code></pre></div>
<p>The minimum information <code>fhir_search()</code> requires is a url
containing the full FHIR search request in the argument
<code>request</code> which you can build by a call to
<code>fhir_url()</code> or by providing an explicit string. In general,
a FHIR search request returns a <em>bundle</em> of the resources you
requested. If there are a lot of resources matching your request, the
search result isn’t returned in one big bundle but distributed over
several of them. If the argument <code>max_bundles</code> is set to its
default <code>Inf</code>, <code>fhir_search()</code> will return all
available bundles, meaning all resources matching your request. If you
set it to <code>2</code> as in the example above, the download will stop
after the first two bundles. Note that in this case, the result <em>may
not contain all</em> the resources from the server matching your
request.</p>
<p>If you want to connect to a FHIR server that uses basic
authentication, you can supply the arguments <code>username</code> and
<code>password</code>. If your server uses some form of bearer token
authorization, you can supply the token in the argument
<code>token</code>.</p>
<p>As you can see in the next block of code, <code>fhir_search()</code>
returns a <code>fhir_bundle_list</code> object, which is basically a
list of xml objects where each list element represents one bundle of
resources, so a list of two xml objects in our case:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">length</span>(patient_bundles)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>patient_bundles</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt; An object of class &quot;fhir_bundle_list&quot;</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; A fhir_bundle_xml object</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; No. of entries : 20</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; Self Link: http://hapi.fhir.org/baseR4/Patient</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; Next Link: http://hapi.fhir.org/baseR4?_getpages=ce958386-53d0-4042-888c-cad53bf5d5a1 ...</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; {xml_node}</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; &lt;Bundle&gt;</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt;  [1] &lt;id value=&quot;ce958386-53d0-4042-888c-cad53bf5d5a1&quot;/&gt;</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt;  [2] &lt;meta&gt;\n  &lt;lastUpdated value=&quot;2021-05-10T12:12:43.317+00:00&quot;/&gt;\n&lt;/meta&gt;</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt;  [3] &lt;type value=&quot;searchset&quot;/&gt;</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt;  [4] &lt;link&gt;\n  &lt;relation value=&quot;self&quot;/&gt;\n  &lt;url value=&quot;http://hapi.fhir.org/b ...</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">#&gt;  [5] &lt;link&gt;\n  &lt;relation value=&quot;next&quot;/&gt;\n  &lt;url value=&quot;http://hapi.fhir.org/b ...</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">#&gt;  [6] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837602&quot;/ ...</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co">#&gt;  [7] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/example-r ...</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co">#&gt;  [8] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837624&quot;/ ...</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="co">#&gt;  [9] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837626&quot;/ ...</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co">#&gt; [10] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837631&quot;/ ...</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="co">#&gt; [11] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837716&quot;/ ...</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="co">#&gt; [12] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837720&quot;/ ...</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="co">#&gt; [13] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837714&quot;/ ...</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="co">#&gt; [14] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837721&quot;/ ...</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="co">#&gt; [15] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837722&quot;/ ...</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="co">#&gt; [16] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837723&quot;/ ...</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="co">#&gt; [17] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837724&quot;/ ...</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="co">#&gt; [18] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/cfsb16116 ...</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="co">#&gt; [19] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837736&quot;/ ...</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a><span class="co">#&gt; [20] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837737&quot;/ ...</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a><span class="co">#&gt; ...</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="co">#&gt; A fhir_bundle_xml object</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a><span class="co">#&gt; No. of entries : 20</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a><span class="co">#&gt; Self Link: http://hapi.fhir.org/baseR4?_getpages=ce958386-53d0-4042-888c-cad53bf5d5a1 ...</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="co">#&gt; Next Link: http://hapi.fhir.org/baseR4?_getpages=ce958386-53d0-4042-888c-cad53bf5d5a1 ...</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a><span class="co">#&gt; {xml_node}</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a><span class="co">#&gt; &lt;Bundle&gt;</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a><span class="co">#&gt;  [1] &lt;id value=&quot;ce958386-53d0-4042-888c-cad53bf5d5a1&quot;/&gt;</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a><span class="co">#&gt;  [2] &lt;meta&gt;\n  &lt;lastUpdated value=&quot;2021-05-10T12:12:43.317+00:00&quot;/&gt;\n&lt;/meta&gt;</span></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a><span class="co">#&gt;  [3] &lt;type value=&quot;searchset&quot;/&gt;</span></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a><span class="co">#&gt;  [4] &lt;link&gt;\n  &lt;relation value=&quot;self&quot;/&gt;\n  &lt;url value=&quot;http://hapi.fhir.org/b ...</span></span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a><span class="co">#&gt;  [5] &lt;link&gt;\n  &lt;relation value=&quot;next&quot;/&gt;\n  &lt;url value=&quot;http://hapi.fhir.org/b ...</span></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a><span class="co">#&gt;  [6] &lt;link&gt;\n  &lt;relation value=&quot;previous&quot;/&gt;\n  &lt;url value=&quot;http://hapi.fhir.o ...</span></span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a><span class="co">#&gt;  [7] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837760&quot;/ ...</span></span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a><span class="co">#&gt;  [8] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837766&quot;/ ...</span></span>
<span id="cb3-51"><a href="#cb3-51" tabindex="-1"></a><span class="co">#&gt;  [9] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837768&quot;/ ...</span></span>
<span id="cb3-52"><a href="#cb3-52" tabindex="-1"></a><span class="co">#&gt; [10] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837781&quot;/ ...</span></span>
<span id="cb3-53"><a href="#cb3-53" tabindex="-1"></a><span class="co">#&gt; [11] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837783&quot;/ ...</span></span>
<span id="cb3-54"><a href="#cb3-54" tabindex="-1"></a><span class="co">#&gt; [12] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837784&quot;/ ...</span></span>
<span id="cb3-55"><a href="#cb3-55" tabindex="-1"></a><span class="co">#&gt; [13] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837787&quot;/ ...</span></span>
<span id="cb3-56"><a href="#cb3-56" tabindex="-1"></a><span class="co">#&gt; [14] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837788&quot;/ ...</span></span>
<span id="cb3-57"><a href="#cb3-57" tabindex="-1"></a><span class="co">#&gt; [15] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837789&quot;/ ...</span></span>
<span id="cb3-58"><a href="#cb3-58" tabindex="-1"></a><span class="co">#&gt; [16] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837790&quot;/ ...</span></span>
<span id="cb3-59"><a href="#cb3-59" tabindex="-1"></a><span class="co">#&gt; [17] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837791&quot;/ ...</span></span>
<span id="cb3-60"><a href="#cb3-60" tabindex="-1"></a><span class="co">#&gt; [18] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837792&quot;/ ...</span></span>
<span id="cb3-61"><a href="#cb3-61" tabindex="-1"></a><span class="co">#&gt; [19] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837793&quot;/ ...</span></span>
<span id="cb3-62"><a href="#cb3-62" tabindex="-1"></a><span class="co">#&gt; [20] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837794&quot;/ ...</span></span>
<span id="cb3-63"><a href="#cb3-63" tabindex="-1"></a><span class="co">#&gt; ...</span></span></code></pre></div>
<p>If for some reason you cannot connect to a FHIR server at the moment
but want to explore the following functions anyway, the package provides
two example lists of bundles containing Patient and MedicationStatement
resources. See <code>?patient_bundles</code> and
<code>?medication_bundles</code> for how to use them.</p>
</div>
<div id="flattening-resources" class="section level2">
<h2>Flattening resources</h2>
<p>Now we know that inside these xml objects there is the patient data
somewhere. To bring it into a tabular format, we will use
<code>fhir_crack()</code> which creates one table per resource type
requested in the <code>design</code> argument. The most important
argument <code>fhir_crack()</code> takes is <code>bundles</code>, the
list of bundles that is returned by <code>fhir_search()</code>. The
second important argument is <code>design</code>, an object that tells
the function which data to extract from the bundle and how.
<code>fhir_crack()</code> returns (a list of) data.frames or data.tables
(if argument <code>data.table = TRUE</code>).</p>
<p>The object that is passed to the <code>design</code> argument can be
of class <code>fhir_table_description</code> or
<code>fhir_design</code>. A <code>fhir_table_description</code> is used
when you want to extract just one resource type, resulting in a single
table. A <code>fhir_design</code> is basically a named list of
<code>fhir_table_descriptions</code> and is used when you want to
extract several resource types at once, resulting in a named list of
tables.</p>
<p>The details of what the different elements of a
<code>fhir_table_description</code> or <code>fhir_design</code> mean are
described in the vignette on flattening resources. Please refer to this
document for more information, as we will just use one simple example
here.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co">#define table_description</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>table_description <span class="ot">&lt;-</span> <span class="fu">fhir_table_description</span>(</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    <span class="at">resource =</span> <span class="st">&quot;Patient&quot;</span>,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    <span class="at">cols     =</span> <span class="fu">c</span>(</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>        <span class="at">id        =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>        <span class="at">use_name    =</span> <span class="st">&quot;name/use&quot;</span>,</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>        <span class="at">given_name  =</span> <span class="st">&quot;name/given&quot;</span>,</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>        <span class="at">family_name =</span> <span class="st">&quot;name/family&quot;</span>,</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>        <span class="at">gender      =</span> <span class="st">&quot;gender&quot;</span>,</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>        <span class="at">birthday    =</span> <span class="st">&quot;birthDate&quot;</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>    ),</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>    <span class="at">sep           =</span> <span class="st">&quot; ~ &quot;</span>,</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>    <span class="at">brackets      =</span> <span class="fu">c</span>(<span class="st">&quot;&lt;&lt;&quot;</span>, <span class="st">&quot;&gt;&gt;&quot;</span>),</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>    <span class="at">rm_empty_cols =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>    <span class="at">format        =</span> <span class="st">&#39;compact&#39;</span>,</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>    <span class="at">keep_attr     =</span> <span class="cn">FALSE</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>)</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#have a look</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>table_description</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt; A fhir_table_description with the following elements: </span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="co">#&gt; resource: Patient</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="co">#&gt; cols: </span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a><span class="co">#&gt; ------------ -----------------</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a><span class="co">#&gt; column name | xpath expression</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a><span class="co">#&gt; ------------ -----------------</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a><span class="co">#&gt; id          | id</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a><span class="co">#&gt; use_name    | name/use</span></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a><span class="co">#&gt; given_name  | name/given</span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a><span class="co">#&gt; family_name | name/family</span></span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a><span class="co">#&gt; gender      | gender</span></span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a><span class="co">#&gt; birthday    | birthDate</span></span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a><span class="co">#&gt; ------------ -----------------</span></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a><span class="co">#&gt; sep:           &#39; ~ &#39;</span></span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a><span class="co">#&gt; brackets:      &#39;&lt;&lt;&#39;, &#39;&gt;&gt;&#39;</span></span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a><span class="co">#&gt; rm_empty_cols: FALSE</span></span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a><span class="co">#&gt; format:        &#39;compact&#39;</span></span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a><span class="co">#&gt; keep_attr:     FALSE</span></span></code></pre></div>
<p>Each of the five style elements <code>sep</code>,
<code>brackets</code>, <code>remove_empty_columns</code>,
<code>format</code> and <code>keep_attr</code> in
<code>table_description</code> can also be controlled directly by the
argument of the same name of <code>fhir_crack()</code>. If one of these
function arguments is <code>NULL</code> (the default value for each
argument), the corresponding value specified from the
<code>table_description</code> will be used. If the argument in
<code>fhir_crack</code> is set, the corresponding value in
<code>fhir_table_description</code> will be overruled. If both the
<code>fhir_crack</code> function argument and the corresponding
component in <code>fhir_table_description</code> are <code>NULL</code>,
the respective default value (<code>sep = &#39;:::&#39;</code>,
<code>brackets = NULL</code>, <code>rm_empty_cols = TRUE</code>,
<code>format = &#39;compact&#39;</code>, <code>keep_attr = FALSE</code>) will be
applied.</p>
<p>After it is defined, the <code>fhir_table_description</code> can be
used in <code>fhir_crack()</code> like this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co">#flatten resources</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>patients <span class="ot">&lt;-</span> <span class="fu">fhir_crack</span>(<span class="at">bundles =</span> patient_bundles, <span class="at">design =</span> table_description, <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#have look at the results</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="fu">head</span>(patients)</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt;             id                                       use_name</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; 1 &lt;&lt;1&gt;&gt;2072744                                &lt;&lt;1.1&gt;&gt;official</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; 2 &lt;&lt;1&gt;&gt;2431578                                &lt;&lt;1.1&gt;&gt;official</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; 3 &lt;&lt;1&gt;&gt;2431568 &lt;&lt;1.1&gt;&gt;official ~ &lt;&lt;2.1&gt;&gt;usual ~ &lt;&lt;3.1&gt;&gt;maiden</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; 4 &lt;&lt;1&gt;&gt;2431577                                &lt;&lt;1.1&gt;&gt;official</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; 5 &lt;&lt;1&gt;&gt;2431757                                     &lt;&lt;1.1&gt;&gt;old</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt; 6 &lt;&lt;1&gt;&gt;2431759                                &lt;&lt;1.1&gt;&gt;official</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt;                                                               given_name</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt; 1                                                 &lt;&lt;1.1&gt;&gt;K ~ &lt;&lt;1.2&gt;&gt;Kari</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; 2                                                           &lt;&lt;1.1&gt;&gt;Roman</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; 3 &lt;&lt;1.1&gt;&gt;Peter ~ &lt;&lt;1.2&gt;&gt;James ~ &lt;&lt;2.1&gt;&gt;Jim ~ &lt;&lt;3.1&gt;&gt;Peter ~ &lt;&lt;3.2&gt;&gt;James</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt; 4                                         &lt;&lt;1.1&gt;&gt;Ganpat ~ &lt;&lt;1.2&gt;&gt;Malekar</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt; 5                                                                   &lt;NA&gt;</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt; 6                                                             &lt;&lt;1.1&gt;&gt;ABC</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt;                        family_name      gender        birthday</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co">#&gt; 1                  &lt;&lt;1.1&gt;&gt;Nordmann &lt;&lt;1&gt;&gt;female &lt;&lt;1&gt;&gt;2018-09-12</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="co">#&gt; 2                     &lt;&lt;1.1&gt;&gt;Smith   &lt;&lt;1&gt;&gt;male &lt;&lt;1&gt;&gt;2021-07-19</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="co">#&gt; 3 &lt;&lt;1.1&gt;&gt;Chalmers ~ &lt;&lt;3.1&gt;&gt;Windsor   &lt;&lt;1&gt;&gt;male &lt;&lt;1&gt;&gt;1974-12-25</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="co">#&gt; 4                   &lt;&lt;1.1&gt;&gt;Malekar   &lt;&lt;1&gt;&gt;male &lt;&lt;1&gt;&gt;1996-02-07</span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="co">#&gt; 5                    &lt;&lt;1.1&gt;&gt;murali   &lt;&lt;1&gt;&gt;male            &lt;NA&gt;</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a><span class="co">#&gt; 6                       &lt;&lt;1.1&gt;&gt;XYZ   &lt;&lt;1&gt;&gt;male &lt;&lt;1&gt;&gt;1998-01-03</span></span></code></pre></div>
</div>
<div id="multiple-entries" class="section level2">
<h2>Multiple entries</h2>
<p>A particularly complicated problem in flattening FHIR resources is
caused by the fact that there can be multiple occurrences of the same
FHIR element within one resource. For a more detailed description of
this problem, please see the vignette on flattening resources.</p>
<p>In general, <code>fhir_crack()</code> will paste multiple entries for
the same attribute together in the table, using the separator provided
by the <code>sep</code> argument.</p>
<p>Let’s have a look at the following simple example, where we have a
bundle containing just two Patient resources. The example is part of the
<code>fhircrackr</code> package and you can make it available like
this:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>bundles <span class="ot">&lt;-</span> <span class="fu">fhir_unserialize</span>(<span class="at">bundles =</span> example_bundles1)</span></code></pre></div>
<p>This represents a bundle list with only one very simple bundle of
just two Patient resources which looks like this:</p>
<pre><code>&lt;Bundle&gt;

    &lt;Patient&gt;
        &lt;id value=&#39;id1&#39;/&gt;
        &lt;address&gt;
            &lt;use value=&#39;home&#39;/&gt;
            &lt;city value=&#39;Amsterdam&#39;/&gt;
            &lt;type value=&#39;physical&#39;/&gt;
            &lt;country value=&#39;Netherlands&#39;/&gt;
        &lt;/address&gt;
        &lt;name&gt;
            &lt;given value=&#39;Marie&#39;/&gt;
        &lt;/name&gt;
    &lt;/Patient&gt;

    &lt;Patient&gt;
        &lt;id value=&#39;id3&#39;/&gt;
        &lt;address&gt;
            &lt;use value=&#39;home&#39;/&gt;
            &lt;city value=&#39;Berlin&#39;/&gt;
        &lt;/address&gt;
        &lt;address&gt;
            &lt;type value=&#39;postal&#39;/&gt;
            &lt;country value=&#39;France&#39;/&gt;
        &lt;/address&gt;
        &lt;address&gt;
            &lt;use value=&#39;work&#39;/&gt;
            &lt;city value=&#39;London&#39;/&gt;
            &lt;type value=&#39;postal&#39;/&gt;
            &lt;country value=&#39;England&#39;/&gt;
        &lt;/address&gt;
        &lt;name&gt;
            &lt;given value=&#39;Frank&#39;/&gt;
        &lt;/name&gt;
        &lt;name&gt;
            &lt;given value=&#39;Max&#39;/&gt;
        &lt;/name&gt;         
    &lt;/Patient&gt;      

&lt;/Bundle&gt;</code></pre>
<p>The first resource has just one entry for the address attribute. The
second Patient resource has an address attribute with three entries
containing different elements and also two entries for the name
attribute.</p>
<p>This is where the style elements of the
<code>table_description</code> comes into play:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>table_description <span class="ot">&lt;-</span> <span class="fu">fhir_table_description</span>(</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    <span class="at">resource =</span> <span class="st">&quot;Patient&quot;</span>,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    <span class="at">brackets      =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>),</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    <span class="at">sep           =</span> <span class="st">&quot; | &quot;</span>,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    <span class="at">rm_empty_cols =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    <span class="at">format        =</span> <span class="st">&#39;compact&#39;</span>,</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>    <span class="at">keep_attr     =</span> <span class="cn">FALSE</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">fhir_crack</span>(<span class="at">bundles =</span> bundles, <span class="at">design =</span> table_description, <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>df</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt;                address.city            address.country</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; 1            [1.1]Amsterdam           [1.1]Netherlands</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt; 2 [1.1]Berlin | [3.1]London [2.1]France | [3.1]England</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt;                address.type           address.use     id            name.given</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt; 1             [1.1]physical             [1.1]home [1]id1            [1.1]Marie</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt; 2 [2.1]postal | [3.1]postal [1.1]home | [3.1]work [1]id3 [1.1]Frank | [2.1]Max</span></span></code></pre></div>
<p>Multiple entries are pasted together with the specified separator
string (in this case: <code>&quot; | &quot;</code>) in between and the indices
(inside the specified bracket strings (here: <code>&quot;[&quot;</code> and
<code>&quot;]&quot;</code>)) display the entry the value belongs to. That way you
can see that Patient resource 2 had three entries for the attribute
<code>address</code> and you can also see which attributes belong to
which entry.</p>
<p>If you know beforehand that you only need home addresses, you can use
predicates in your XPath expressions that filter for that and avoid
multiple entries in your table:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>table_description <span class="ot">&lt;-</span> <span class="fu">fhir_table_description</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>    <span class="at">resource =</span> <span class="st">&quot;Patient&quot;</span>,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>        <span class="at">id =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>        <span class="at">city =</span> <span class="st">&quot;address[use[@value=&#39;home&#39;]]/city&quot;</span>,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">&quot;address[use[@value=&#39;home&#39;]]/type&quot;</span>,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>        <span class="at">country =</span> <span class="st">&quot;address[use[@value=&#39;home&#39;]]/country&quot;</span>,</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">&quot;name/given&quot;</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>    )</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>)</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>df_filtered <span class="ot">&lt;-</span> <span class="fu">fhir_crack</span>(<span class="at">bundles =</span> bundles, <span class="at">design =</span> table_description, <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>df_filtered</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt;    id      city     type     country        name</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt; 1 id1 Amsterdam physical Netherlands       Marie</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt; 2 id3    Berlin     &lt;NA&gt;        &lt;NA&gt; Frank:::Max</span></span></code></pre></div>
<p>If you can’t filter during cracking, there are several options to
deal with the resulting multiple entries in your table.</p>
</div>
<div id="process-tables-with-multiple-entries" class="section level2">
<h2>Process Tables with multiple Entries</h2>
<div id="melt-tables-with-multiple-entries" class="section level3">
<h3>Melt tables with multiple entries</h3>
<p>If the table produced by <code>fhir_crack()</code> contains multiple
entries, you’ll probably want to divide these entries into distinct
observations at some point. This is where <code>fhir_melt()</code> comes
into play. <code>fhir_melt()</code> takes an <em>indexed table</em> with
multiple entries in one or several <code>columns</code> and spreads (aka
melts) these entries over several rows.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">fhir_melt</span>(</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>    <span class="at">indexed_data_frame =</span> df,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>    <span class="at">columns            =</span> <span class="st">&quot;address.city&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    <span class="at">brackets           =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>),</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>    <span class="at">sep                =</span> <span class="st">&quot; | &quot;</span>,</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    <span class="at">all_columns        =</span> <span class="cn">FALSE</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>)</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt;   resource_identifier address.city</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; 1                   1 [1]Amsterdam</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; 2                   2    [1]Berlin</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt; 3                   2         &lt;NA&gt;</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; 4                   2    [1]London</span></span></code></pre></div>
<p>The new variable <code>resource_identifier</code> maps which rows in
the created table belong to which row (usually equivalent to one
resource) in the original table. <code>brackets</code> and
<code>sep</code> have to be the same character vectors that have been
used to build the indices with <code>fhir_crack()</code>.
<code>columns</code> is a character vector with the names of the
variables/columns you want to melt. You can provide more than one column
here but it makes sense to only have variables from the same repeating
attribute together in one call to <code>fhir_melt()</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;address.city&quot;</span>, <span class="st">&quot;address.use&quot;</span>, <span class="st">&quot;address.type&quot;</span>, <span class="st">&quot;address.country&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="fu">fhir_melt</span>(</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>    <span class="at">indexed_data_frame =</span> df,</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    <span class="at">columns            =</span> cols,</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    <span class="at">brackets           =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>),</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    <span class="at">sep                =</span> <span class="st">&quot; | &quot;</span>,</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>    <span class="at">all_columns        =</span> <span class="cn">FALSE</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>)</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt;   resource_identifier address.city address.use address.type address.country</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt; 1                   1 [1]Amsterdam     [1]home  [1]physical  [1]Netherlands</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt; 2                   2    [1]Berlin     [1]home         &lt;NA&gt;            &lt;NA&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt; 3                   2         &lt;NA&gt;        &lt;NA&gt;    [1]postal       [1]France</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt; 4                   2    [1]London     [1]work    [1]postal      [1]England</span></span></code></pre></div>
<p>With the argument <code>all_columns</code> you can control whether
the resulting table contains only the molten columns or all columns of
the original table:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>molten <span class="ot">&lt;-</span> <span class="fu">fhir_melt</span>(</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>    <span class="at">indexed_data_frame =</span> df,</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    <span class="at">columns            =</span> cols,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>    <span class="at">brackets           =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>),</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    <span class="at">sep                =</span> <span class="st">&quot; | &quot;</span>,</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>    <span class="at">all_columns        =</span> <span class="cn">TRUE</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>)</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>molten</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt;   address.city address.country address.type address.use     id</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; 1 [1]Amsterdam  [1]Netherlands  [1]physical     [1]home [1]id1</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt; 2    [1]Berlin            &lt;NA&gt;         &lt;NA&gt;     [1]home [1]id3</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt; 3         &lt;NA&gt;       [1]France    [1]postal        &lt;NA&gt; [1]id3</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="co">#&gt; 4    [1]London      [1]England    [1]postal     [1]work [1]id3</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co">#&gt;              name.given resource_identifier</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="co">#&gt; 1            [1.1]Marie                   1</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="co">#&gt; 2 [1.1]Frank | [2.1]Max                   2</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="co">#&gt; 3 [1.1]Frank | [2.1]Max                   2</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co">#&gt; 4 [1.1]Frank | [2.1]Max                   2</span></span></code></pre></div>
<p>Values on the other variables will just repeat in the newly created
rows. For more information please see the vignette on flattening
resources.</p>
</div>
<div id="remove-indices" class="section level3">
<h3>Remove indices</h3>
<p>Once you have sorted out the multiple entries, you might want to get
rid of the indices in your data frame. This can be achieved using
<code>fhir_rm_indices()</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">fhir_rm_indices</span>(<span class="at">indexed_data_frame =</span> molten, <span class="at">brackets =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>))</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#&gt;   address.city address.country address.type address.use  id  name.given</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt; 1    Amsterdam     Netherlands     physical        home id1       Marie</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt; 2       Berlin            &lt;NA&gt;         &lt;NA&gt;        home id3 Frank | Max</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt; 3         &lt;NA&gt;          France       postal        &lt;NA&gt; id3 Frank | Max</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt; 4       London         England       postal        work id3 Frank | Max</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt;   resource_identifier</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt; 1                   1</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt; 2                   2</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">#&gt; 3                   2</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt; 4                   2</span></span></code></pre></div>
<p>Again, <code>brackets</code> should be given the same character
vector that was used for <code>fhir_crack()</code> and
<code>fhir_melt()</code> respectively.</p>
</div>
</div>
<div id="save-and-load-downloaded-bundles" class="section level2">
<h2>Save and load downloaded bundles</h2>
<p>Since <code>fhir_crack()</code> ignores all data that are not
specified in <code>design</code>, it makes sense to store the original
search result for reproducibility and in case you realize later on that
you need elements from the resources that you haven’t extracted at
first.</p>
<p>There are two ways of saving the FHIR bundles you downloaded: Either
you save them as R objects, or you write them to an xml file.</p>
<div id="save-and-load-bundles-as-r-objects" class="section level3">
<h3>Save and load bundles as R objects</h3>
<p>If you want to save the list of downloaded bundles as an
<code>.rda</code> or <code>.RData</code> file, you can’t just use R’s
<code>save()</code> or <code>save_image()</code> on it, because this
will break the external pointers in the xml objects representing your
bundles. Instead, you have to serialize the bundles before saving and
unserialize them after loading. For single xml objects the package
<code>xml2</code> provides serialization functions. For convenience,
however, <code>fhircrackr</code> provides the functions
<code>fhir_serialize()</code> that can be used directly on the bundles
returned by <code>fhir_search()</code> and
<code>fhir_unserialize()</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co">#serialize bundles</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>serialized_bundles <span class="ot">&lt;-</span> <span class="fu">fhir_serialize</span>(<span class="at">bundles =</span> patient_bundles)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#have a look at them</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="fu">head</span>(serialized_bundles[[<span class="dv">1</span>]])</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt; [1] 58 0a 00 00 00 03</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co">#create temporary directory for saving</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>temp_dir <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#save</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="fu">saveRDS</span>(serialized_bundles, <span class="at">file =</span> <span class="fu">paste0</span>(temp_dir, <span class="st">&quot;/bundles.rda&quot;</span>))</span></code></pre></div>
<p>If you reload this bundle, you have to unserialize it before you can
work with it:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co">#load bundles</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>serialized_bundles_reloaded <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(temp_dir, <span class="st">&quot;/bundles.rda&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co">#unserialize</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>bundles <span class="ot">&lt;-</span> <span class="fu">fhir_unserialize</span>(<span class="at">bundles =</span> serialized_bundles_reloaded)</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co">#have a look</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>bundles</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="co">#&gt; An object of class &quot;fhir_bundle_list&quot;</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="co">#&gt; A fhir_bundle_xml object</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co">#&gt; No. of entries : 20</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co">#&gt; Self Link: http://hapi.fhir.org/baseR4/Patient</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="co">#&gt; Next Link: http://hapi.fhir.org/baseR4?_getpages=ce958386-53d0-4042-888c-cad53bf5d5a1 ...</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co">#&gt; {xml_node}</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="co">#&gt; &lt;Bundle&gt;</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="co">#&gt;  [1] &lt;id value=&quot;ce958386-53d0-4042-888c-cad53bf5d5a1&quot;/&gt;</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="co">#&gt;  [2] &lt;meta&gt;\n  &lt;lastUpdated value=&quot;2021-05-10T12:12:43.317+00:00&quot;/&gt;\n&lt;/meta&gt;</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="co">#&gt;  [3] &lt;type value=&quot;searchset&quot;/&gt;</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="co">#&gt;  [4] &lt;link&gt;\n  &lt;relation value=&quot;self&quot;/&gt;\n  &lt;url value=&quot;http://hapi.fhir.org/b ...</span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="co">#&gt;  [5] &lt;link&gt;\n  &lt;relation value=&quot;next&quot;/&gt;\n  &lt;url value=&quot;http://hapi.fhir.org/b ...</span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a><span class="co">#&gt;  [6] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837602&quot;/ ...</span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a><span class="co">#&gt;  [7] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/example-r ...</span></span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a><span class="co">#&gt;  [8] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837624&quot;/ ...</span></span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a><span class="co">#&gt;  [9] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837626&quot;/ ...</span></span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a><span class="co">#&gt; [10] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837631&quot;/ ...</span></span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a><span class="co">#&gt; [11] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837716&quot;/ ...</span></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a><span class="co">#&gt; [12] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837720&quot;/ ...</span></span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a><span class="co">#&gt; [13] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837714&quot;/ ...</span></span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a><span class="co">#&gt; [14] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837721&quot;/ ...</span></span>
<span id="cb17-29"><a href="#cb17-29" tabindex="-1"></a><span class="co">#&gt; [15] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837722&quot;/ ...</span></span>
<span id="cb17-30"><a href="#cb17-30" tabindex="-1"></a><span class="co">#&gt; [16] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837723&quot;/ ...</span></span>
<span id="cb17-31"><a href="#cb17-31" tabindex="-1"></a><span class="co">#&gt; [17] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837724&quot;/ ...</span></span>
<span id="cb17-32"><a href="#cb17-32" tabindex="-1"></a><span class="co">#&gt; [18] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/cfsb16116 ...</span></span>
<span id="cb17-33"><a href="#cb17-33" tabindex="-1"></a><span class="co">#&gt; [19] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837736&quot;/ ...</span></span>
<span id="cb17-34"><a href="#cb17-34" tabindex="-1"></a><span class="co">#&gt; [20] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837737&quot;/ ...</span></span>
<span id="cb17-35"><a href="#cb17-35" tabindex="-1"></a><span class="co">#&gt; ...</span></span>
<span id="cb17-36"><a href="#cb17-36" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-37"><a href="#cb17-37" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb17-38"><a href="#cb17-38" tabindex="-1"></a><span class="co">#&gt; A fhir_bundle_xml object</span></span>
<span id="cb17-39"><a href="#cb17-39" tabindex="-1"></a><span class="co">#&gt; No. of entries : 20</span></span>
<span id="cb17-40"><a href="#cb17-40" tabindex="-1"></a><span class="co">#&gt; Self Link: http://hapi.fhir.org/baseR4?_getpages=ce958386-53d0-4042-888c-cad53bf5d5a1 ...</span></span>
<span id="cb17-41"><a href="#cb17-41" tabindex="-1"></a><span class="co">#&gt; Next Link: http://hapi.fhir.org/baseR4?_getpages=ce958386-53d0-4042-888c-cad53bf5d5a1 ...</span></span>
<span id="cb17-42"><a href="#cb17-42" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb17-43"><a href="#cb17-43" tabindex="-1"></a><span class="co">#&gt; {xml_node}</span></span>
<span id="cb17-44"><a href="#cb17-44" tabindex="-1"></a><span class="co">#&gt; &lt;Bundle&gt;</span></span>
<span id="cb17-45"><a href="#cb17-45" tabindex="-1"></a><span class="co">#&gt;  [1] &lt;id value=&quot;ce958386-53d0-4042-888c-cad53bf5d5a1&quot;/&gt;</span></span>
<span id="cb17-46"><a href="#cb17-46" tabindex="-1"></a><span class="co">#&gt;  [2] &lt;meta&gt;\n  &lt;lastUpdated value=&quot;2021-05-10T12:12:43.317+00:00&quot;/&gt;\n&lt;/meta&gt;</span></span>
<span id="cb17-47"><a href="#cb17-47" tabindex="-1"></a><span class="co">#&gt;  [3] &lt;type value=&quot;searchset&quot;/&gt;</span></span>
<span id="cb17-48"><a href="#cb17-48" tabindex="-1"></a><span class="co">#&gt;  [4] &lt;link&gt;\n  &lt;relation value=&quot;self&quot;/&gt;\n  &lt;url value=&quot;http://hapi.fhir.org/b ...</span></span>
<span id="cb17-49"><a href="#cb17-49" tabindex="-1"></a><span class="co">#&gt;  [5] &lt;link&gt;\n  &lt;relation value=&quot;next&quot;/&gt;\n  &lt;url value=&quot;http://hapi.fhir.org/b ...</span></span>
<span id="cb17-50"><a href="#cb17-50" tabindex="-1"></a><span class="co">#&gt;  [6] &lt;link&gt;\n  &lt;relation value=&quot;previous&quot;/&gt;\n  &lt;url value=&quot;http://hapi.fhir.o ...</span></span>
<span id="cb17-51"><a href="#cb17-51" tabindex="-1"></a><span class="co">#&gt;  [7] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837760&quot;/ ...</span></span>
<span id="cb17-52"><a href="#cb17-52" tabindex="-1"></a><span class="co">#&gt;  [8] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837766&quot;/ ...</span></span>
<span id="cb17-53"><a href="#cb17-53" tabindex="-1"></a><span class="co">#&gt;  [9] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837768&quot;/ ...</span></span>
<span id="cb17-54"><a href="#cb17-54" tabindex="-1"></a><span class="co">#&gt; [10] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837781&quot;/ ...</span></span>
<span id="cb17-55"><a href="#cb17-55" tabindex="-1"></a><span class="co">#&gt; [11] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837783&quot;/ ...</span></span>
<span id="cb17-56"><a href="#cb17-56" tabindex="-1"></a><span class="co">#&gt; [12] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837784&quot;/ ...</span></span>
<span id="cb17-57"><a href="#cb17-57" tabindex="-1"></a><span class="co">#&gt; [13] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837787&quot;/ ...</span></span>
<span id="cb17-58"><a href="#cb17-58" tabindex="-1"></a><span class="co">#&gt; [14] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837788&quot;/ ...</span></span>
<span id="cb17-59"><a href="#cb17-59" tabindex="-1"></a><span class="co">#&gt; [15] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837789&quot;/ ...</span></span>
<span id="cb17-60"><a href="#cb17-60" tabindex="-1"></a><span class="co">#&gt; [16] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837790&quot;/ ...</span></span>
<span id="cb17-61"><a href="#cb17-61" tabindex="-1"></a><span class="co">#&gt; [17] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837791&quot;/ ...</span></span>
<span id="cb17-62"><a href="#cb17-62" tabindex="-1"></a><span class="co">#&gt; [18] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837792&quot;/ ...</span></span>
<span id="cb17-63"><a href="#cb17-63" tabindex="-1"></a><span class="co">#&gt; [19] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837793&quot;/ ...</span></span>
<span id="cb17-64"><a href="#cb17-64" tabindex="-1"></a><span class="co">#&gt; [20] &lt;entry&gt;\n  &lt;fullUrl value=&quot;http://hapi.fhir.org/baseR4/Patient/1837794&quot;/ ...</span></span>
<span id="cb17-65"><a href="#cb17-65" tabindex="-1"></a><span class="co">#&gt; ...</span></span></code></pre></div>
<p>After unserialization, the pointers are restored and you can continue
to work with the bundles. Note that the example bundles
<code>medication_bundles</code> and <code>patient_bundles</code> that
are provided with the <code>fhircrackr</code> package are also provided
in their serialized form and have to be unserialized as described on
their help page.</p>
</div>
<div id="save-and-load-bundles-as-xml-files" class="section level3">
<h3>Save and load bundles as xml files</h3>
<p>If you want to store the bundles in xml files instead of R objects,
you can use the functions <code>fhir_save()</code> and
<code>fhir_load()</code>. <code>fhir_save()</code> takes a list of
bundles in form of xml objects (as returned by
<code>fhir_search()</code>) and writes them into the directory specified
in the argument <code>directory</code>. Each bundle is saved as a
separate xml-file. If the folder defined in <code>directory</code>
doesn’t exist, it is created in the current working directory.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co">#save bundles as xml files</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">fhir_save</span>(<span class="at">bundles =</span> patient_bundles, <span class="at">directory =</span> temp_dir)</span></code></pre></div>
<p>To read bundles saved with <code>fhir_save()</code> back into R, you
can use <code>fhir_load()</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>bundles <span class="ot">&lt;-</span> <span class="fu">fhir_load</span>(<span class="at">directory =</span> temp_dir)</span></code></pre></div>
<p><code>fhir_load()</code> takes the name of the directory (or path to
it) as its only argument. All xml-files in this directory are read into
R and returned as a list of bundles in xml format just as returned by
<code>fhir_search()</code>.</p>
</div>
</div>
<div id="acknowledgments" class="section level2">
<h2>Acknowledgments</h2>
<p>This work was carried out by the SMITH consortium and the
cross-consortium use case POLAR_MI; both are part of the German
Initiative for Medical Informatics and funded by the German Federal
Ministry of Education and Research (BMBF), grant no. 01ZZ1803A ,
01ZZ1803C and 01ZZ1910A.</p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>FHIR is the registered trademark of HL7 and is used with
the permission of HL7. Use of the FHIR trademark does not constitute
endorsement of this product by HL7<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
