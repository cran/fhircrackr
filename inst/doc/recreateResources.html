<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2024-03-21" />

<title>fhircrackr: Recreate FHIR resources</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">fhircrackr: Recreate FHIR resources</h1>
<h4 class="date">2024-03-21</h4>


<div id="TOC">
<ul>
<li><a href="#preparation" id="toc-preparation">Preparation</a></li>
<li><a href="#crack-to-wide-format" id="toc-crack-to-wide-format">Crack
to wide format</a></li>
<li><a href="#modify-the-data" id="toc-modify-the-data">Modify the
data</a></li>
<li><a href="#recreate-a-single-resource" id="toc-recreate-a-single-resource">Recreate a single resource</a></li>
<li><a href="#recreate-a-bundle-of-resources" id="toc-recreate-a-bundle-of-resources">Recreate a bundle of
resources</a></li>
<li><a href="#different-attributes" id="toc-different-attributes">Different attributes</a></li>
<li><a href="#upload-resources-to-a-server" id="toc-upload-resources-to-a-server">Upload resources to a
server</a></li>
<li><a href="#linked-resources" id="toc-linked-resources">Linked
resources</a></li>
</ul>
</div>

<p>This vignette covers all topics concerned with recreating resources.
If you are interested in a quick overview over the fhircrackr package,
please have a look at the fhircrackr:intro vignette.</p>
<p>Before running any of the following code, you need to load the
<code>fhircrackr</code> package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(fhircrackr)</span></code></pre></div>
<div id="preparation" class="section level2">
<h2>Preparation</h2>
<p>In the other vignettes you saw how to download and flatten resources.
Now we’ll have a look at how to turn flattened tables back into FHIR
resources. This allows you to extract resources from a server,
manipulate their content in R and to upload them to a server again. One
scenario where this might be useful is downloading data from one server,
anonymizing it and uploading it to another server. If you are working
with sensitive data please note that it is your responsibility alone to
check that any resources you upload to an insecure server are
sufficiently anonymized.</p>
<p>For the rest of the vignette, we’ll work with
<code>example_bundles2</code> from <code>fhircrackr</code>, which can be
made accessible like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>bundles <span class="ot">&lt;-</span> <span class="fu">fhir_unserialize</span>(<span class="at">bundles =</span> example_bundles2)</span></code></pre></div>
<p>See <code>?example_bundles2</code> to what this bundle looks
like.</p>
</div>
<div id="crack-to-wide-format" class="section level2">
<h2>Crack to wide format</h2>
<p>Starting with the FHIR resources, the first thing you’ll have to do
is to crack the data to a wide format. For more information on the
process, please see the vignette on flattening resources. Make sure that
you allow <code>fhir_crack()</code> to generate the column names
automatically, i.e. don’t state explicit column names in the
<code>fhir_table_description</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>patients <span class="ot">&lt;-</span> <span class="fu">fhir_table_description</span>(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="at">resource =</span> <span class="st">&quot;Patient&quot;</span>,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="at">brackets =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>),</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="at">sep      =</span> <span class="st">&quot; | &quot;</span>,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="at">format   =</span> <span class="st">&quot;wide&quot;</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>table <span class="ot">&lt;-</span> <span class="fu">fhir_crack</span>(<span class="at">bundles =</span> bundles, <span class="at">design =</span> patients, <span class="at">verbose =</span> <span class="dv">0</span>)</span></code></pre></div>
<p>The resulting table looks like this:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>table</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#   [1.1]address.city [2.1]address.city [3.1]address.city [1.1]address.country</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co"># 1         Amsterdam              &lt;NA&gt;              &lt;NA&gt;          Netherlands</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co"># 2              Rome         Stockholm              &lt;NA&gt;                Italy</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co"># 3            Berlin              &lt;NA&gt;            London                 &lt;NA&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#   [2.1]address.country [3.1]address.country [1.1]address.type [2.1]address.type</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co"># 1                 &lt;NA&gt;                 &lt;NA&gt;          physical              &lt;NA&gt;</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co"># 2               Sweden                 &lt;NA&gt;          physical            postal</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co"># 3               France              England              &lt;NA&gt;            postal</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#   [3.1]address.type [1.1]address.use [2.1]address.use [3.1]address.use [1]id</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co"># 1              &lt;NA&gt;             home             &lt;NA&gt;             &lt;NA&gt;   id1</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co"># 2              &lt;NA&gt;             home             work             &lt;NA&gt;   id2</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co"># 3            postal             home             &lt;NA&gt;             work   id3</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#   [1.1]name.given [2.1]name.given</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co"># 1           Marie            &lt;NA&gt;</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co"># 2           Susie            &lt;NA&gt;</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co"># 3           Frank             Max</span></span></code></pre></div>
</div>
<div id="modify-the-data" class="section level2">
<h2>Modify the data</h2>
<p>You can now modify the data. For example, we could remove the name
and id and change all city entries to <code>xxx</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co">#remove name and id</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>modified_table <span class="ot">&lt;-</span> <span class="fu">subset</span>(table, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">[1.1]name.given</span><span class="st">`</span>, <span class="st">`</span><span class="at">[2.1]name.given</span><span class="st">`</span>, <span class="st">`</span><span class="at">[1]id</span><span class="st">`</span>))</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#anonymize city</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>modified_table[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">sapply</span>(modified_table[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="cf">function</span>(x){<span class="fu">sub</span>(<span class="st">&quot;.*&quot;</span>, <span class="st">&quot;xxx&quot;</span>, x)})</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>modified_table</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#   [1.1]address.city [2.1]address.city [3.1]address.city [1.1]address.country</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co"># 1               xxx              &lt;NA&gt;              &lt;NA&gt;          Netherlands</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co"># 2               xxx               xxx              &lt;NA&gt;                Italy</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co"># 3               xxx              &lt;NA&gt;               xxx                 &lt;NA&gt;</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#   [2.1]address.country [3.1]address.country [1.1]address.type [2.1]address.type</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co"># 1                 &lt;NA&gt;                 &lt;NA&gt;          physical              &lt;NA&gt;</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co"># 2               Sweden                 &lt;NA&gt;          physical            postal</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co"># 3               France              England              &lt;NA&gt;            postal</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#   [3.1]address.type [1.1]address.use [2.1]address.use [3.1]address.use</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co"># 1              &lt;NA&gt;             home             &lt;NA&gt;             &lt;NA&gt;</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co"># 2              &lt;NA&gt;             home             work             &lt;NA&gt;</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co"># 3            postal             home             &lt;NA&gt;             work</span></span></code></pre></div>
</div>
<div id="recreate-a-single-resource" class="section level2">
<h2>Recreate a single resource</h2>
<p>To create resources from this data, the <code>fhircrackr</code> makes
use of the structure information inherent in the column names. If you
want to get an overview over this structure before creating the actual
xml-objects, you can use the function <code>fhir_tree()</code> that
creates a string representing the structure which can be printed to the
console using <code>cat()</code> or written to a text file:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">fhir_tree</span>(modified_table, <span class="at">resource =</span> <span class="st">&quot;Patient&quot;</span>, <span class="at">brackets =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>), <span class="at">keep_ids =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co"># Patient1</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#   address1: physical</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#   city1: Netherlands</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#   country1: home</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co"># Patient2</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#   address1: physical</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#   address3: work</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#   city1: Italy</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#   country1: home</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co"># Patient3</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#   address1: xxx</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#   address2: postal</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#   address3: France</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#   city1: England</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#   country1: work</span></span></code></pre></div>
<p>To create a FHIR resource out of the first row of the table, you can
use the function <code>fhir_build_resource()</code>. This function takes
a single row of a cast table and the resource type you intend to create
and builds an object of class <code>fhir_resource</code>, which is
essentially an xml-object:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>new_resource <span class="ot">&lt;-</span> <span class="fu">fhir_build_resource</span>(<span class="at">row           =</span> modified_table[<span class="dv">1</span>,], </span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>                                    <span class="at">resource_type =</span> <span class="st">&quot;Patient&quot;</span>, </span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>                                    <span class="at">brackets      =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>))</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>new_resource</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co"># A fhir_resource object</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co"># &lt;Patient&gt;</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#   &lt;address value=&quot;physical&quot;/&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#   &lt;city value=&quot;Netherlands&quot;/&gt;</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#   &lt;country value=&quot;home&quot;/&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co"># &lt;/Patient&gt;</span></span></code></pre></div>
</div>
<div id="recreate-a-bundle-of-resources" class="section level2">
<h2>Recreate a bundle of resources</h2>
<p>It is also possible to bundle several resources to upload them to the
server together. This is done using bundles of type transaction or batch
(see
<a href="https://www.hl7.org/fhir/bundle.html" target="_blank">https://www.hl7.org/fhir/bundle.html</a>
and
<a href="https://www.hl7.org/fhir/http.html" target="_blank">https://www.hl7.org/fhir/http.html</a>).</p>
<p>We can create such a bundle from a wide table using the function
<code>fhir_build_bundle()</code>, which takes a wide table and the
resource type represented in the table, as well as information on the
type of bundle you want to create:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>transaction_bundle <span class="ot">&lt;-</span> <span class="fu">fhir_build_bundle</span>(</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="at">table         =</span> modified_table,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="at">brackets      =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>),</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="at">resource_type =</span> <span class="st">&quot;Patient&quot;</span>,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="at">bundle_type   =</span> <span class="st">&quot;transaction&quot;</span>,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  <span class="at">verbose       =</span> <span class="dv">0</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>)</span></code></pre></div>
<p>You can have a look at the bundle like this:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co">#Overview</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>transaction_bundle</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co"># A fhir_bundle_xml object</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># No. of entries : 3</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#  </span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co"># {xml_node}</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co"># &lt;Bundle&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co"># [1] &lt;type value=&quot;transaction&quot;/&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co"># [2] &lt;entry&gt;\n  &lt;Patient value=&quot;home&quot;/&gt;\n  &lt;address value=&quot;physical&quot;/&gt;\n  &lt;cit ...</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co"># [3] &lt;entry&gt;\n  &lt;Patient value=&quot;home&quot;/&gt;\n  &lt;address value=&quot;physical&quot;/&gt;\n  &lt;add ...</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co"># [4] &lt;entry&gt;\n  &lt;Patient value=&quot;home&quot;/&gt;\n  &lt;address value=&quot;xxx&quot;/&gt;\n  &lt;city val ...</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#print complete string</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">toString</span>(transaction_bundle))</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co"># &lt;Bundle&gt;</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#   &lt;type value=&quot;transaction&quot;/&gt;</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#   &lt;entry&gt;</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="co">#     &lt;Patient value=&quot;home&quot;/&gt;</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#     &lt;address value=&quot;physical&quot;/&gt;</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="co">#     &lt;city value=&quot;Netherlands&quot;/&gt;</span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co">#     &lt;resource value=&quot;xxx&quot;/&gt;</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="co">#   &lt;/entry&gt;</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="co">#   &lt;entry&gt;</span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a><span class="co">#     &lt;Patient value=&quot;home&quot;/&gt;</span></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a><span class="co">#     &lt;address value=&quot;physical&quot;/&gt;</span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a><span class="co">#     &lt;address value=&quot;work&quot;/&gt;</span></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a><span class="co">#     &lt;city value=&quot;postal&quot;/&gt;</span></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a><span class="co">#     &lt;resource value=&quot;Sweden&quot;/&gt;</span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a><span class="co">#   &lt;/entry&gt;</span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a><span class="co">#   &lt;entry&gt;</span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a><span class="co">#     &lt;Patient value=&quot;home&quot;/&gt;</span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a><span class="co">#     &lt;address value=&quot;xxx&quot;/&gt;</span></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a><span class="co">#     &lt;city value=&quot;work&quot;/&gt;</span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a><span class="co">#     &lt;resource value=&quot;postal&quot;/&gt;</span></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a><span class="co">#   &lt;/entry&gt;</span></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a><span class="co"># &lt;/Bundle&gt;</span></span></code></pre></div>
<p>If you are familiar with transaction bundles, you’ll notice that this
bundle is lacking some information to be POSTable to a server: The
<code>request</code> element. To be able to upload resources to a
server, a transaction/batch bundle must have a <code>request</code>
element for each resource which holds the url and the HTTP verb (usually
<code>POST</code> or <code>PUT</code>) for the respective resource,
otherwise the server will throw an error.</p>
<p>The modified table we have used so far doesn’t have this information,
so we have to add it like this:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>request <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="at">request.method =</span> <span class="fu">c</span>(<span class="st">&quot;POST&quot;</span>,    <span class="st">&quot;POST&quot;</span>,    <span class="st">&quot;POST&quot;</span>),</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="at">request.url    =</span> <span class="fu">c</span>(<span class="st">&quot;Patient&quot;</span>, <span class="st">&quot;Patient&quot;</span>, <span class="st">&quot;Patient&quot;</span>)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>request_table <span class="ot">&lt;-</span> <span class="fu">cbind</span>(modified_table, request)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>request_table</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#   [1.1]address.city [2.1]address.city [3.1]address.city [1.1]address.country</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co"># 1               xxx              &lt;NA&gt;              &lt;NA&gt;          Netherlands</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co"># 2               xxx               xxx              &lt;NA&gt;                Italy</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co"># 3               xxx              &lt;NA&gt;               xxx                 &lt;NA&gt;</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#   [2.1]address.country [3.1]address.country [1.1]address.type [2.1]address.type</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co"># 1                 &lt;NA&gt;                 &lt;NA&gt;          physical              &lt;NA&gt;</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co"># 2               Sweden                 &lt;NA&gt;          physical            postal</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co"># 3               France              England              &lt;NA&gt;            postal</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">#   [3.1]address.type [1.1]address.use [2.1]address.use [3.1]address.use</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co"># 1              &lt;NA&gt;             home             &lt;NA&gt;             &lt;NA&gt;</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co"># 2              &lt;NA&gt;             home             work             &lt;NA&gt;</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="co"># 3            postal             home             &lt;NA&gt;             work</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="co">#   request.method request.url</span></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a><span class="co"># 1           POST     Patient</span></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a><span class="co"># 2           POST     Patient</span></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a><span class="co"># 3           POST     Patient</span></span></code></pre></div>
<p>Now when we build a transaction bundle, it has all the information we
need:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>transaction_bundle <span class="ot">&lt;-</span> <span class="fu">fhir_build_bundle</span>(</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="at">table         =</span> request_table,</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="at">resource_type =</span> <span class="st">&quot;Patient&quot;</span>,</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="at">bundle_type   =</span> <span class="st">&quot;transaction&quot;</span>, </span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="at">brackets      =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>),</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  <span class="at">verbose       =</span> <span class="dv">0</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>)</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">toString</span>(transaction_bundle))</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co"># &lt;Bundle&gt;</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#   &lt;type value=&quot;transaction&quot;/&gt;</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#   &lt;entry&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#     &lt;request&gt;</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#       &lt;method value=&quot;POST&quot;/&gt;</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">#       &lt;url value=&quot;Patient&quot;/&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#     &lt;/request&gt;</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#     &lt;resource&gt;</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#       &lt;Patient&gt;</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co">#         &lt;address&gt;</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a><span class="co">#           &lt;city value=&quot;xxx&quot;/&gt;</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="co">#           &lt;country value=&quot;Netherlands&quot;/&gt;</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a><span class="co">#           &lt;type value=&quot;physical&quot;/&gt;</span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a><span class="co">#           &lt;use value=&quot;home&quot;/&gt;</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a><span class="co">#         &lt;/address&gt;</span></span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a><span class="co">#       &lt;/Patient&gt;</span></span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a><span class="co">#     &lt;/resource&gt;</span></span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a><span class="co">#   &lt;/entry&gt;</span></span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a><span class="co">#   &lt;entry&gt;</span></span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a><span class="co">#     &lt;request&gt;</span></span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a><span class="co">#       &lt;method value=&quot;POST&quot;/&gt;</span></span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a><span class="co">#       &lt;url value=&quot;Patient&quot;/&gt;</span></span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a><span class="co">#     &lt;/request&gt;</span></span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a><span class="co">#     &lt;resource&gt;</span></span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a><span class="co">#       &lt;Patient&gt;</span></span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a><span class="co">#         &lt;address&gt;</span></span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a><span class="co">#           &lt;city value=&quot;xxx&quot;/&gt;</span></span>
<span id="cb11-37"><a href="#cb11-37" tabindex="-1"></a><span class="co">#           &lt;country value=&quot;Italy&quot;/&gt;</span></span>
<span id="cb11-38"><a href="#cb11-38" tabindex="-1"></a><span class="co">#           &lt;type value=&quot;physical&quot;/&gt;</span></span>
<span id="cb11-39"><a href="#cb11-39" tabindex="-1"></a><span class="co">#           &lt;use value=&quot;home&quot;/&gt;</span></span>
<span id="cb11-40"><a href="#cb11-40" tabindex="-1"></a><span class="co">#         &lt;/address&gt;</span></span>
<span id="cb11-41"><a href="#cb11-41" tabindex="-1"></a><span class="co">#         &lt;address&gt;</span></span>
<span id="cb11-42"><a href="#cb11-42" tabindex="-1"></a><span class="co">#           &lt;city value=&quot;xxx&quot;/&gt;</span></span>
<span id="cb11-43"><a href="#cb11-43" tabindex="-1"></a><span class="co">#           &lt;country value=&quot;Sweden&quot;/&gt;</span></span>
<span id="cb11-44"><a href="#cb11-44" tabindex="-1"></a><span class="co">#           &lt;type value=&quot;postal&quot;/&gt;</span></span>
<span id="cb11-45"><a href="#cb11-45" tabindex="-1"></a><span class="co">#           &lt;use value=&quot;work&quot;/&gt;</span></span>
<span id="cb11-46"><a href="#cb11-46" tabindex="-1"></a><span class="co">#         &lt;/address&gt;</span></span>
<span id="cb11-47"><a href="#cb11-47" tabindex="-1"></a><span class="co">#       &lt;/Patient&gt;</span></span>
<span id="cb11-48"><a href="#cb11-48" tabindex="-1"></a><span class="co">#     &lt;/resource&gt;</span></span>
<span id="cb11-49"><a href="#cb11-49" tabindex="-1"></a><span class="co">#   &lt;/entry&gt;</span></span>
<span id="cb11-50"><a href="#cb11-50" tabindex="-1"></a><span class="co">#   &lt;entry&gt;</span></span>
<span id="cb11-51"><a href="#cb11-51" tabindex="-1"></a><span class="co">#     &lt;request&gt;</span></span>
<span id="cb11-52"><a href="#cb11-52" tabindex="-1"></a><span class="co">#       &lt;method value=&quot;POST&quot;/&gt;</span></span>
<span id="cb11-53"><a href="#cb11-53" tabindex="-1"></a><span class="co">#       &lt;url value=&quot;Patient&quot;/&gt;</span></span>
<span id="cb11-54"><a href="#cb11-54" tabindex="-1"></a><span class="co">#     &lt;/request&gt;</span></span>
<span id="cb11-55"><a href="#cb11-55" tabindex="-1"></a><span class="co">#     &lt;resource&gt;</span></span>
<span id="cb11-56"><a href="#cb11-56" tabindex="-1"></a><span class="co">#       &lt;Patient&gt;</span></span>
<span id="cb11-57"><a href="#cb11-57" tabindex="-1"></a><span class="co">#         &lt;address&gt;</span></span>
<span id="cb11-58"><a href="#cb11-58" tabindex="-1"></a><span class="co">#           &lt;city value=&quot;xxx&quot;/&gt;</span></span>
<span id="cb11-59"><a href="#cb11-59" tabindex="-1"></a><span class="co">#           &lt;use value=&quot;home&quot;/&gt;</span></span>
<span id="cb11-60"><a href="#cb11-60" tabindex="-1"></a><span class="co">#         &lt;/address&gt;</span></span>
<span id="cb11-61"><a href="#cb11-61" tabindex="-1"></a><span class="co">#         &lt;address&gt;</span></span>
<span id="cb11-62"><a href="#cb11-62" tabindex="-1"></a><span class="co">#           &lt;city value=&quot;xxx&quot;/&gt;</span></span>
<span id="cb11-63"><a href="#cb11-63" tabindex="-1"></a><span class="co">#           &lt;country value=&quot;England&quot;/&gt;</span></span>
<span id="cb11-64"><a href="#cb11-64" tabindex="-1"></a><span class="co">#           &lt;type value=&quot;postal&quot;/&gt;</span></span>
<span id="cb11-65"><a href="#cb11-65" tabindex="-1"></a><span class="co">#           &lt;use value=&quot;work&quot;/&gt;</span></span>
<span id="cb11-66"><a href="#cb11-66" tabindex="-1"></a><span class="co">#         &lt;/address&gt;</span></span>
<span id="cb11-67"><a href="#cb11-67" tabindex="-1"></a><span class="co">#         &lt;address&gt;</span></span>
<span id="cb11-68"><a href="#cb11-68" tabindex="-1"></a><span class="co">#           &lt;country value=&quot;France&quot;/&gt;</span></span>
<span id="cb11-69"><a href="#cb11-69" tabindex="-1"></a><span class="co">#           &lt;type value=&quot;postal&quot;/&gt;</span></span>
<span id="cb11-70"><a href="#cb11-70" tabindex="-1"></a><span class="co">#         &lt;/address&gt;</span></span>
<span id="cb11-71"><a href="#cb11-71" tabindex="-1"></a><span class="co">#       &lt;/Patient&gt;</span></span>
<span id="cb11-72"><a href="#cb11-72" tabindex="-1"></a><span class="co">#     &lt;/resource&gt;</span></span>
<span id="cb11-73"><a href="#cb11-73" tabindex="-1"></a><span class="co">#   &lt;/entry&gt;</span></span>
<span id="cb11-74"><a href="#cb11-74" tabindex="-1"></a><span class="co"># &lt;/Bundle&gt;</span></span></code></pre></div>
</div>
<div id="different-attributes" class="section level2">
<h2>Different attributes</h2>
<p>Almost all the time, the only xml attribute that is used in a FHIR
resource is the <code>value</code> attribute like in this small example
resource:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">fhir_unserialize</span>(example_resource1)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co"># A fhir_resource object</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co"># &lt;Patient&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#   &lt;name&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#     &lt;given value=&quot;Marie&quot;/&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#   &lt;/name&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#   &lt;gender value=&quot;female&quot;/&gt;</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#   &lt;birthDate value=&quot;1970-01-01&quot;/&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co"># &lt;/Patient&gt;</span></span></code></pre></div>
<p>In rare cases, however, there can be other types of attributes,
namely <code>id</code> or <code>url</code>, which looks for example like
this:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">fhir_unserialize</span>(example_resource3)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co"># A fhir_resource object</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co"># &lt;Medication&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#   &lt;code&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#     &lt;coding&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#       &lt;system value=&quot;http://www.nlm.nih.gov/research/umls/rxnorm&quot;/&gt;</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#       &lt;code value=&quot;1594660&quot;/&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#       &lt;display value=&quot;Alemtuzumab 10mg/ml (Lemtrada)&quot;/&gt;</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#     &lt;/coding&gt;</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">#   &lt;/code&gt;</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#   &lt;ingredient id=&quot;1&quot;&gt;</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co">#     &lt;itemReference&gt;</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">#       &lt;reference value=&quot;Substance/5463&quot;/&gt;</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co">#     &lt;/itemReference&gt;</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">#   &lt;/ingredient&gt;</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="co">#   &lt;ingredient id=&quot;2&quot;&gt;</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="co">#     &lt;itemReference&gt;</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="co">#       &lt;reference value=&quot;Substance/3401&quot;/&gt;</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="co">#     &lt;/itemReference&gt;</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a><span class="co">#   &lt;/ingredient&gt;</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a><span class="co"># &lt;/Medication&gt;</span></span></code></pre></div>
<p>As you can see, this example Medication has ingredient elements which
have an <code>id</code> attribute. <code>fhir_crack()</code> will
extract any kind of attributes, e.g. from this bundle containing the
above Medication resource:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>bundle <span class="ot">&lt;-</span> <span class="fu">fhir_unserialize</span>(example_bundles4)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>med <span class="ot">&lt;-</span> <span class="fu">fhir_table_description</span>(<span class="at">resource =</span> <span class="st">&quot;Medication&quot;</span>, </span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>                              <span class="at">cols     =</span> <span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;ingredient&quot;</span>, <span class="st">&quot;ingredient/itemReference/reference&quot;</span>),</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>                              <span class="at">format   =</span> <span class="st">&quot;wide&quot;</span>,</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>                              <span class="at">brackets =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>)</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>without_attribute <span class="ot">&lt;-</span> <span class="fu">fhir_crack</span>(<span class="at">bundles =</span> bundle, <span class="at">design =</span> med, <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>without_attribute</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#   [1]id [1]ingredient [2]ingredient [1.1.1]ingredient.itemReference.reference</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co"># 1  1285             1             2                            Substance/5463</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co"># 2 45226             1             2                            Substance/6912</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="co">#   [2.1.1]ingredient.itemReference.reference</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="co"># 1                            Substance/3401</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co"># 2                            Substance/3710</span></span></code></pre></div>
<p>If you are interested in which kind of attribute the extracted value
had, you can set <code>keep_attr=TRUE</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>with_attribute <span class="ot">&lt;-</span> <span class="fu">fhir_crack</span>(<span class="at">bundles =</span> bundle, <span class="at">design =</span> med, <span class="at">keep_attr =</span> <span class="cn">TRUE</span>, <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>with_attribute</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#   [1]id@value [1]ingredient@id [2]ingredient@id</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co"># 1        1285                1                2</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co"># 2       45226                1                2</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#   [1.1.1]ingredient.itemReference.reference@value</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co"># 1                                  Substance/5463</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co"># 2                                  Substance/6912</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#   [2.1.1]ingredient.itemReference.reference@value</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co"># 1                                  Substance/3401</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co"># 2                                  Substance/3710</span></span></code></pre></div>
<p>This is important when you want to recreate the resources properly.
If there is no attribute information in the column names,
<code>fhir_build_resource()</code> will assume that all columns have
<code>value</code> attributes, which is wrong in this case:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">fhir_build_resource</span>(<span class="at">row =</span> without_attribute[<span class="dv">1</span>,], <span class="at">resource_type =</span> <span class="st">&quot;Medication&quot;</span>, <span class="at">brackets =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>))</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co"># A fhir_resource object</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co"># &lt;Medication&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#   &lt;id value=&quot;1285&quot;/&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#   &lt;ingredient value=&quot;1&quot;&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#     &lt;itemReference&gt;</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#       &lt;reference value=&quot;Substance/5463&quot;/&gt;</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#     &lt;/itemReference&gt;</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#   &lt;/ingredient&gt;</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#   &lt;ingredient value=&quot;2&quot;&gt;</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#     &lt;itemReference&gt;</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co">#       &lt;reference value=&quot;Substance/3401&quot;/&gt;</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co">#     &lt;/itemReference&gt;</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="co">#   &lt;/ingredient&gt;</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co"># &lt;/Medication&gt;</span></span></code></pre></div>
<p>Instead one should build the resource from a table that contains the
attribute information:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">fhir_build_resource</span>(<span class="at">row =</span> with_attribute[<span class="dv">1</span>,], <span class="at">resource_type =</span> <span class="st">&quot;Medication&quot;</span>, <span class="at">brackets =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>))</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="co"># A fhir_resource object</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="co"># &lt;Medication&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co">#   &lt;id value=&quot;1285&quot;/&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="co">#   &lt;ingredient id=&quot;1&quot;&gt;</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="co">#     &lt;itemReference&gt;</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co">#       &lt;reference value=&quot;Substance/5463&quot;/&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="co">#     &lt;/itemReference&gt;</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co">#   &lt;/ingredient&gt;</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co">#   &lt;ingredient id=&quot;2&quot;&gt;</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="co">#     &lt;itemReference&gt;</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="co">#       &lt;reference value=&quot;Substance/3401&quot;/&gt;</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co">#     &lt;/itemReference&gt;</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="co">#   &lt;/ingredient&gt;</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="co"># &lt;/Medication&gt;</span></span></code></pre></div>
</div>
<div id="upload-resources-to-a-server" class="section level2">
<h2>Upload resources to a server</h2>
<div id="upload-a-single-resource" class="section level3">
<h3>Upload a single resource</h3>
<p>In general there are two modes of loading resources to a FHIR server.
You either intend to newly <em>create</em> them on the server or you
wish to <em>update</em> a resource that is already present on the
server. These two modes correspond to using either <code>POST</code>
(for creation) or <code>PUT</code> (for updating). When you
<code>POST</code> a resource to the server, the URL you
<code>POST</code> it to has the form <code>[base]/[resourceType]</code>,
e.g. <code>http://hapi.fhir.org/baseR4/Patient</code>. You can for
example <code>POST</code> the resource we have just created like
this:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">fhir_post</span>(<span class="at">url =</span> <span class="st">&quot;http://hapi.fhir.org/baseR4/Patient&quot;</span>, <span class="at">body =</span> new_resource)</span></code></pre></div>
<pre><code># Resource sucessfully created</code></pre>
<p>When you do this, the Patient resource in <code>new_resource</code>
is created under a new, server generated id (also called logical or
resource id) on the server. It therefore makes sense for the POSTed
resource to not have a resource id, because if it does, most servers
will overwrite this id.</p>
<p>Things are different if you intend to update a resource that is
already present on the server. In this case, you’d <code>PUT</code> a
resource to an URL containing the exact address of the targeted resource
on the server which has the form
<code>[base]/[resourceType]/[resourceId]</code>. The resource you are
sending with a <code>PUT</code> must have a resource id that is
identical to the the one on the server.</p>
<p>Assuming that the resource <code>[base]/Patient/id1</code> exists on
the server, we could for example update it like this:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co">#create resource</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>new_resource_with_id <span class="ot">&lt;-</span> <span class="fu">fhir_build_resource</span>(table[<span class="dv">1</span>,], <span class="at">resource_type =</span> <span class="st">&quot;Patient&quot;</span>, <span class="at">brackets =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>))</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>new_resource_with_id</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co"># A fhir_resource object</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co"># &lt;Patient&gt;</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="co">#   &lt;address&gt;</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="co">#     &lt;city value=&quot;Amsterdam&quot;/&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="co">#     &lt;country value=&quot;Netherlands&quot;/&gt;</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="co">#     &lt;type value=&quot;physical&quot;/&gt;</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a><span class="co">#     &lt;use value=&quot;home&quot;/&gt;</span></span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a><span class="co">#   &lt;/address&gt;</span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="co">#   &lt;id value=&quot;id1&quot;/&gt;</span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a><span class="co">#   &lt;name&gt;</span></span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a><span class="co">#     &lt;given value=&quot;Marie&quot;/&gt;</span></span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a><span class="co">#   &lt;/name&gt;</span></span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a><span class="co"># &lt;/Patient&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">fhir_put</span>(<span class="at">url =</span> <span class="st">&quot;http://hapi.fhir.org/baseR4/Patient/id1&quot;</span>, <span class="at">body =</span> new_resource_with_id)</span></code></pre></div>
<pre><code># Ressource successfully updated.</code></pre>
<p>If the no resource exists under the id you are trying to PUT your
resource to, the FHIR server will perform something called <em>Update as
create</em>, meaning the the resource you send to the server is newly
created with the specified id (as opposed to a server generated id). In
this case <code>fhir_put()</code> will inform you like this:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">fhir_put</span>(<span class="at">url =</span> <span class="st">&quot;http://hapi.fhir.org/baseR4/Patient/id1&quot;</span>, </span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>         <span class="at">body =</span> new_resource_with_id, </span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>         <span class="at">brackets =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>))</span></code></pre></div>
<pre><code># Ressource successfully created.</code></pre>
</div>
<div id="upload-a-bundle-of-resources" class="section level3">
<h3>Upload a bundle of resources</h3>
<p>It is also possible to upload a bundle of resources together. The
bundle in the we’ve created with <code>fhir_build_bundle()</code> is
such a bundle:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>transaction_bundle</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="co"># A fhir_bundle_xml object</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="co"># No. of entries : 3</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="co">#  </span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="co"># {xml_node}</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a><span class="co"># &lt;Bundle&gt;</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a><span class="co"># [1] &lt;type value=&quot;transaction&quot;/&gt;</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="co"># [2] &lt;entry&gt;\n  &lt;request&gt;\n    &lt;method value=&quot;POST&quot;/&gt;\n    &lt;url value=&quot;Patient ...</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="co"># [3] &lt;entry&gt;\n  &lt;request&gt;\n    &lt;method value=&quot;POST&quot;/&gt;\n    &lt;url value=&quot;Patient ...</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a><span class="co"># [4] &lt;entry&gt;\n  &lt;request&gt;\n    &lt;method value=&quot;POST&quot;/&gt;\n    &lt;url value=&quot;Patient ...</span></span></code></pre></div>
<p>The <code>request</code> element we’ve added before specifies for
each resource which HTTP verb (<code>PUT</code> or <code>POST</code>)
and which url to use. Note that the URL must match the HTTP action,
i.e. with PUT the URL must contain a resource id, while with
<code>POST</code> it cannot contain a resource id.</p>
<p>You can <code>POST</code> the bundle to the server like this:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">fhir_post</span>(<span class="st">&quot;http://hapi.fhir.org/baseR4&quot;</span>, <span class="at">body =</span> transaction_bundle)</span></code></pre></div>
<pre><code># Bundle sucessfully POSTed</code></pre>
</div>
</div>
<div id="linked-resources" class="section level2">
<h2>Linked resources</h2>
<p>Uploading independent resources of a single type to a server is easy,
as you’ve seen above. Matters get a lot more complicated, however, when
resources contain references to other resources, e.g. a
MedicationStatement resource that links to a Patient resource.</p>
<p>How to best upload interlinked resources to a FHIR server depends on
the individual settings of the server, but in most cases it makes sense
to include the linked resources in the same transaction bundle. This can
be achieved with <code>fhir_build_bundle()</code> by passing a list of
tables to the function. The most tricky part in this is to get
references right because you need to know the id of the referenced
resource beforehand. That is why in most cases it is easier to PUT the
resources instead of POSTing them, because this allows you to choose the
resource id yourself. The details of creating valid transaction bundles
is beyond the scope of this vignette, but here is a small example to
illustrate the general process. First let’s crack and cast a simple
example bundle containing 3 Patients and one Observation resource:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co">#unserialize example bundles</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>bundles <span class="ot">&lt;-</span> <span class="fu">fhir_unserialize</span>(example_bundles3)</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a><span class="co">#crack</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>Patient <span class="ot">&lt;-</span> <span class="fu">fhir_table_description</span>(</span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>  <span class="at">resource =</span> <span class="st">&quot;Patient&quot;</span>,</span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>  <span class="at">sep      =</span> <span class="st">&quot;:::&quot;</span>,</span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>  <span class="at">brackets =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>,<span class="st">&quot;]&quot;</span>),</span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a>  <span class="at">format   =</span> <span class="st">&quot;wide&quot;</span></span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a>)</span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a>Observation <span class="ot">&lt;-</span> <span class="fu">fhir_table_description</span>(</span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a>  <span class="at">resource =</span> <span class="st">&quot;Observation&quot;</span>,</span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a>  <span class="at">sep      =</span> <span class="st">&quot;:::&quot;</span>,</span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a>  <span class="at">brackets =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>,<span class="st">&quot;]&quot;</span>),</span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a>  <span class="at">format   =</span> <span class="st">&quot;wide&quot;</span></span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a>)</span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a>tables <span class="ot">&lt;-</span> <span class="fu">fhir_crack</span>(</span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a>  <span class="at">bundles =</span> bundles,</span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a>  <span class="at">design  =</span> <span class="fu">fhir_design</span>(Patient, Observation),</span>
<span id="cb28-22"><a href="#cb28-22" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span></span>
<span id="cb28-23"><a href="#cb28-23" tabindex="-1"></a>)</span></code></pre></div>
<p>Now we need to add the request information. We use PUT for all
resources to have control over their ids.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="co">#add request info to Patients</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>tables<span class="sc">$</span>Patient<span class="sc">$</span>request.method <span class="ot">&lt;-</span> <span class="st">&quot;PUT&quot;</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>tables<span class="sc">$</span>Patient<span class="sc">$</span>request.url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Patient/&quot;</span>, tables<span class="sc">$</span>Patient<span class="sc">$</span><span class="st">`</span><span class="at">[1]id</span><span class="st">`</span>)</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a><span class="co">#add request info to Observation</span></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>tables<span class="sc">$</span>Observation<span class="sc">$</span>request.method <span class="ot">&lt;-</span> <span class="st">&quot;PUT&quot;</span></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>tables<span class="sc">$</span>Observation<span class="sc">$</span>request.url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Observation/&quot;</span>, tables<span class="sc">$</span>Observation<span class="sc">$</span><span class="st">`</span><span class="at">[1]id</span><span class="st">`</span>)</span></code></pre></div>
<p>The augmented tables look like this:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>tables<span class="sc">$</span>Patient</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="co">#   [1.1]address.city [2.1]address.city [3.1]address.city [1.1]address.country</span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="co"># 1         Amsterdam              &lt;NA&gt;              &lt;NA&gt;          Netherlands</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="co"># 2              Rome         Stockholm              &lt;NA&gt;                Italy</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="co"># 3            Berlin              &lt;NA&gt;            London                 &lt;NA&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="co">#   [2.1]address.country [3.1]address.country [1.1]address.type [2.1]address.type</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a><span class="co"># 1                 &lt;NA&gt;                 &lt;NA&gt;          physical              &lt;NA&gt;</span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a><span class="co"># 2               Sweden                 &lt;NA&gt;          physical            postal</span></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a><span class="co"># 3               France              England              &lt;NA&gt;            postal</span></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a><span class="co">#   [3.1]address.type [1.1]address.use [2.1]address.use [3.1]address.use [1]id</span></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a><span class="co"># 1              &lt;NA&gt;             home             &lt;NA&gt;             &lt;NA&gt;   id1</span></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a><span class="co"># 2              &lt;NA&gt;             home             work             &lt;NA&gt;   id2</span></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a><span class="co"># 3            postal             home             &lt;NA&gt;             work   id3</span></span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a><span class="co">#   [1.1]name.given [2.1]name.given request.method request.url</span></span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a><span class="co"># 1           Marie            &lt;NA&gt;            PUT Patient/id1</span></span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a><span class="co"># 2           Susie            &lt;NA&gt;            PUT Patient/id2</span></span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a><span class="co"># 3           Frank             Max            PUT Patient/id3</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>tables<span class="sc">$</span>Observation</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="co">#   [1.1.1]code.coding.code [1.2.1]code.coding.code [1.1.1]code.coding.display</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a><span class="co"># 1                 29463-7                27113001                Body Weight</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a><span class="co">#   [1.2.1]code.coding.display [1.1.1]code.coding.system</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a><span class="co"># 1                Body weight          http://loinc.org</span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a><span class="co">#   [1.2.1]code.coding.system [1]id [1.1]subject.reference request.method</span></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a><span class="co"># 1    http://snomed.info/sct  obs1            Patient/id2            PUT</span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a><span class="co">#        request.url</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a><span class="co"># 1 Observation/obs1</span></span></code></pre></div>
<p>You can build a bundle from them by giving this list to
<code>fhir_build_bundle()</code>:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>bundle <span class="ot">&lt;-</span> <span class="fu">fhir_build_bundle</span>(<span class="at">table    =</span> tables,</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>                            <span class="at">brackets =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>,<span class="st">&quot;]&quot;</span>))</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="co"># Created a  transaction Bundle with 4 resources.</span></span></code></pre></div>
<p>The bundle looks like this:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">toString</span>(bundle))</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="co"># &lt;Bundle&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a><span class="co">#   &lt;type value=&quot;transaction&quot;/&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="co">#   &lt;entry&gt;</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="co">#     &lt;request&gt;</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a><span class="co">#       &lt;method value=&quot;PUT&quot;/&gt;</span></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a><span class="co">#       &lt;url value=&quot;Patient/id1&quot;/&gt;</span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a><span class="co">#     &lt;/request&gt;</span></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a><span class="co">#     &lt;resource&gt;</span></span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a><span class="co">#       &lt;Patient&gt;</span></span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a><span class="co">#         &lt;address&gt;</span></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a><span class="co">#           &lt;city value=&quot;Amsterdam&quot;/&gt;</span></span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a><span class="co">#           &lt;country value=&quot;Netherlands&quot;/&gt;</span></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a><span class="co">#           &lt;type value=&quot;physical&quot;/&gt;</span></span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a><span class="co">#           &lt;use value=&quot;home&quot;/&gt;</span></span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a><span class="co">#         &lt;/address&gt;</span></span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a><span class="co">#         &lt;id value=&quot;id1&quot;/&gt;</span></span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a><span class="co">#         &lt;name&gt;</span></span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a><span class="co">#           &lt;given value=&quot;Marie&quot;/&gt;</span></span>
<span id="cb33-20"><a href="#cb33-20" tabindex="-1"></a><span class="co">#         &lt;/name&gt;</span></span>
<span id="cb33-21"><a href="#cb33-21" tabindex="-1"></a><span class="co">#       &lt;/Patient&gt;</span></span>
<span id="cb33-22"><a href="#cb33-22" tabindex="-1"></a><span class="co">#     &lt;/resource&gt;</span></span>
<span id="cb33-23"><a href="#cb33-23" tabindex="-1"></a><span class="co">#   &lt;/entry&gt;</span></span>
<span id="cb33-24"><a href="#cb33-24" tabindex="-1"></a><span class="co">#   &lt;entry&gt;</span></span>
<span id="cb33-25"><a href="#cb33-25" tabindex="-1"></a><span class="co">#     &lt;request&gt;</span></span>
<span id="cb33-26"><a href="#cb33-26" tabindex="-1"></a><span class="co">#       &lt;method value=&quot;PUT&quot;/&gt;</span></span>
<span id="cb33-27"><a href="#cb33-27" tabindex="-1"></a><span class="co">#       &lt;url value=&quot;Patient/id2&quot;/&gt;</span></span>
<span id="cb33-28"><a href="#cb33-28" tabindex="-1"></a><span class="co">#     &lt;/request&gt;</span></span>
<span id="cb33-29"><a href="#cb33-29" tabindex="-1"></a><span class="co">#     &lt;resource&gt;</span></span>
<span id="cb33-30"><a href="#cb33-30" tabindex="-1"></a><span class="co">#       &lt;Patient&gt;</span></span>
<span id="cb33-31"><a href="#cb33-31" tabindex="-1"></a><span class="co">#         &lt;address&gt;</span></span>
<span id="cb33-32"><a href="#cb33-32" tabindex="-1"></a><span class="co">#           &lt;city value=&quot;Rome&quot;/&gt;</span></span>
<span id="cb33-33"><a href="#cb33-33" tabindex="-1"></a><span class="co">#           &lt;country value=&quot;Italy&quot;/&gt;</span></span>
<span id="cb33-34"><a href="#cb33-34" tabindex="-1"></a><span class="co">#           &lt;type value=&quot;physical&quot;/&gt;</span></span>
<span id="cb33-35"><a href="#cb33-35" tabindex="-1"></a><span class="co">#           &lt;use value=&quot;home&quot;/&gt;</span></span>
<span id="cb33-36"><a href="#cb33-36" tabindex="-1"></a><span class="co">#         &lt;/address&gt;</span></span>
<span id="cb33-37"><a href="#cb33-37" tabindex="-1"></a><span class="co">#         &lt;address&gt;</span></span>
<span id="cb33-38"><a href="#cb33-38" tabindex="-1"></a><span class="co">#           &lt;city value=&quot;Stockholm&quot;/&gt;</span></span>
<span id="cb33-39"><a href="#cb33-39" tabindex="-1"></a><span class="co">#           &lt;country value=&quot;Sweden&quot;/&gt;</span></span>
<span id="cb33-40"><a href="#cb33-40" tabindex="-1"></a><span class="co">#           &lt;type value=&quot;postal&quot;/&gt;</span></span>
<span id="cb33-41"><a href="#cb33-41" tabindex="-1"></a><span class="co">#           &lt;use value=&quot;work&quot;/&gt;</span></span>
<span id="cb33-42"><a href="#cb33-42" tabindex="-1"></a><span class="co">#         &lt;/address&gt;</span></span>
<span id="cb33-43"><a href="#cb33-43" tabindex="-1"></a><span class="co">#         &lt;id value=&quot;id2&quot;/&gt;</span></span>
<span id="cb33-44"><a href="#cb33-44" tabindex="-1"></a><span class="co">#         &lt;name&gt;</span></span>
<span id="cb33-45"><a href="#cb33-45" tabindex="-1"></a><span class="co">#           &lt;given value=&quot;Susie&quot;/&gt;</span></span>
<span id="cb33-46"><a href="#cb33-46" tabindex="-1"></a><span class="co">#         &lt;/name&gt;</span></span>
<span id="cb33-47"><a href="#cb33-47" tabindex="-1"></a><span class="co">#       &lt;/Patient&gt;</span></span>
<span id="cb33-48"><a href="#cb33-48" tabindex="-1"></a><span class="co">#     &lt;/resource&gt;</span></span>
<span id="cb33-49"><a href="#cb33-49" tabindex="-1"></a><span class="co">#   &lt;/entry&gt;</span></span>
<span id="cb33-50"><a href="#cb33-50" tabindex="-1"></a><span class="co">#   &lt;entry&gt;</span></span>
<span id="cb33-51"><a href="#cb33-51" tabindex="-1"></a><span class="co">#     &lt;request&gt;</span></span>
<span id="cb33-52"><a href="#cb33-52" tabindex="-1"></a><span class="co">#       &lt;method value=&quot;PUT&quot;/&gt;</span></span>
<span id="cb33-53"><a href="#cb33-53" tabindex="-1"></a><span class="co">#       &lt;url value=&quot;Patient/id3&quot;/&gt;</span></span>
<span id="cb33-54"><a href="#cb33-54" tabindex="-1"></a><span class="co">#     &lt;/request&gt;</span></span>
<span id="cb33-55"><a href="#cb33-55" tabindex="-1"></a><span class="co">#     &lt;resource&gt;</span></span>
<span id="cb33-56"><a href="#cb33-56" tabindex="-1"></a><span class="co">#       &lt;Patient&gt;</span></span>
<span id="cb33-57"><a href="#cb33-57" tabindex="-1"></a><span class="co">#         &lt;address&gt;</span></span>
<span id="cb33-58"><a href="#cb33-58" tabindex="-1"></a><span class="co">#           &lt;city value=&quot;Berlin&quot;/&gt;</span></span>
<span id="cb33-59"><a href="#cb33-59" tabindex="-1"></a><span class="co">#           &lt;use value=&quot;home&quot;/&gt;</span></span>
<span id="cb33-60"><a href="#cb33-60" tabindex="-1"></a><span class="co">#         &lt;/address&gt;</span></span>
<span id="cb33-61"><a href="#cb33-61" tabindex="-1"></a><span class="co">#         &lt;address&gt;</span></span>
<span id="cb33-62"><a href="#cb33-62" tabindex="-1"></a><span class="co">#           &lt;city value=&quot;London&quot;/&gt;</span></span>
<span id="cb33-63"><a href="#cb33-63" tabindex="-1"></a><span class="co">#           &lt;country value=&quot;England&quot;/&gt;</span></span>
<span id="cb33-64"><a href="#cb33-64" tabindex="-1"></a><span class="co">#           &lt;type value=&quot;postal&quot;/&gt;</span></span>
<span id="cb33-65"><a href="#cb33-65" tabindex="-1"></a><span class="co">#           &lt;use value=&quot;work&quot;/&gt;</span></span>
<span id="cb33-66"><a href="#cb33-66" tabindex="-1"></a><span class="co">#         &lt;/address&gt;</span></span>
<span id="cb33-67"><a href="#cb33-67" tabindex="-1"></a><span class="co">#         &lt;address&gt;</span></span>
<span id="cb33-68"><a href="#cb33-68" tabindex="-1"></a><span class="co">#           &lt;country value=&quot;France&quot;/&gt;</span></span>
<span id="cb33-69"><a href="#cb33-69" tabindex="-1"></a><span class="co">#           &lt;type value=&quot;postal&quot;/&gt;</span></span>
<span id="cb33-70"><a href="#cb33-70" tabindex="-1"></a><span class="co">#         &lt;/address&gt;</span></span>
<span id="cb33-71"><a href="#cb33-71" tabindex="-1"></a><span class="co">#         &lt;id value=&quot;id3&quot;/&gt;</span></span>
<span id="cb33-72"><a href="#cb33-72" tabindex="-1"></a><span class="co">#         &lt;name&gt;</span></span>
<span id="cb33-73"><a href="#cb33-73" tabindex="-1"></a><span class="co">#           &lt;given value=&quot;Frank&quot;/&gt;</span></span>
<span id="cb33-74"><a href="#cb33-74" tabindex="-1"></a><span class="co">#         &lt;/name&gt;</span></span>
<span id="cb33-75"><a href="#cb33-75" tabindex="-1"></a><span class="co">#         &lt;name&gt;</span></span>
<span id="cb33-76"><a href="#cb33-76" tabindex="-1"></a><span class="co">#           &lt;given value=&quot;Max&quot;/&gt;</span></span>
<span id="cb33-77"><a href="#cb33-77" tabindex="-1"></a><span class="co">#         &lt;/name&gt;</span></span>
<span id="cb33-78"><a href="#cb33-78" tabindex="-1"></a><span class="co">#       &lt;/Patient&gt;</span></span>
<span id="cb33-79"><a href="#cb33-79" tabindex="-1"></a><span class="co">#     &lt;/resource&gt;</span></span>
<span id="cb33-80"><a href="#cb33-80" tabindex="-1"></a><span class="co">#   &lt;/entry&gt;</span></span>
<span id="cb33-81"><a href="#cb33-81" tabindex="-1"></a><span class="co">#   &lt;entry&gt;</span></span>
<span id="cb33-82"><a href="#cb33-82" tabindex="-1"></a><span class="co">#     &lt;request&gt;</span></span>
<span id="cb33-83"><a href="#cb33-83" tabindex="-1"></a><span class="co">#       &lt;method value=&quot;PUT&quot;/&gt;</span></span>
<span id="cb33-84"><a href="#cb33-84" tabindex="-1"></a><span class="co">#       &lt;url value=&quot;Observation/obs1&quot;/&gt;</span></span>
<span id="cb33-85"><a href="#cb33-85" tabindex="-1"></a><span class="co">#     &lt;/request&gt;</span></span>
<span id="cb33-86"><a href="#cb33-86" tabindex="-1"></a><span class="co">#     &lt;resource&gt;</span></span>
<span id="cb33-87"><a href="#cb33-87" tabindex="-1"></a><span class="co">#       &lt;Observation&gt;</span></span>
<span id="cb33-88"><a href="#cb33-88" tabindex="-1"></a><span class="co">#         &lt;code&gt;</span></span>
<span id="cb33-89"><a href="#cb33-89" tabindex="-1"></a><span class="co">#           &lt;coding&gt;</span></span>
<span id="cb33-90"><a href="#cb33-90" tabindex="-1"></a><span class="co">#             &lt;code value=&quot;29463-7&quot;/&gt;</span></span>
<span id="cb33-91"><a href="#cb33-91" tabindex="-1"></a><span class="co">#             &lt;display value=&quot;Body Weight&quot;/&gt;</span></span>
<span id="cb33-92"><a href="#cb33-92" tabindex="-1"></a><span class="co">#             &lt;system value=&quot;http://loinc.org&quot;/&gt;</span></span>
<span id="cb33-93"><a href="#cb33-93" tabindex="-1"></a><span class="co">#           &lt;/coding&gt;</span></span>
<span id="cb33-94"><a href="#cb33-94" tabindex="-1"></a><span class="co">#           &lt;coding&gt;</span></span>
<span id="cb33-95"><a href="#cb33-95" tabindex="-1"></a><span class="co">#             &lt;code value=&quot;27113001&quot;/&gt;</span></span>
<span id="cb33-96"><a href="#cb33-96" tabindex="-1"></a><span class="co">#             &lt;display value=&quot;Body weight&quot;/&gt;</span></span>
<span id="cb33-97"><a href="#cb33-97" tabindex="-1"></a><span class="co">#             &lt;system value=&quot;http://snomed.info/sct&quot;/&gt;</span></span>
<span id="cb33-98"><a href="#cb33-98" tabindex="-1"></a><span class="co">#           &lt;/coding&gt;</span></span>
<span id="cb33-99"><a href="#cb33-99" tabindex="-1"></a><span class="co">#         &lt;/code&gt;</span></span>
<span id="cb33-100"><a href="#cb33-100" tabindex="-1"></a><span class="co">#         &lt;id value=&quot;obs1&quot;/&gt;</span></span>
<span id="cb33-101"><a href="#cb33-101" tabindex="-1"></a><span class="co">#         &lt;subject&gt;</span></span>
<span id="cb33-102"><a href="#cb33-102" tabindex="-1"></a><span class="co">#           &lt;reference value=&quot;Patient/id2&quot;/&gt;</span></span>
<span id="cb33-103"><a href="#cb33-103" tabindex="-1"></a><span class="co">#         &lt;/subject&gt;</span></span>
<span id="cb33-104"><a href="#cb33-104" tabindex="-1"></a><span class="co">#       &lt;/Observation&gt;</span></span>
<span id="cb33-105"><a href="#cb33-105" tabindex="-1"></a><span class="co">#     &lt;/resource&gt;</span></span>
<span id="cb33-106"><a href="#cb33-106" tabindex="-1"></a><span class="co">#   &lt;/entry&gt;</span></span>
<span id="cb33-107"><a href="#cb33-107" tabindex="-1"></a><span class="co"># &lt;/Bundle&gt;</span></span></code></pre></div>
<p>This bundle can be POSTed to a server like this:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="fu">fhir_post</span>(<span class="at">url =</span> <span class="st">&quot;http://hapi.fhir.org/baseR4&quot;</span>, <span class="at">body =</span> bundle)</span></code></pre></div>
<pre><code># Bundle sucessfully POSTed</code></pre>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
