<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2023-02-10" />

<title>fhircrackr: Flatten FHIR resources</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">fhircrackr: Flatten FHIR resources</h1>
<h4 class="date">2023-02-10</h4>


<div id="TOC">
<ul>
<li><a href="#preparation" id="toc-preparation">Preparation</a></li>
<li><a href="#extracting-one-resource-type" id="toc-extracting-one-resource-type">Extracting one resource type</a>
<ul>
<li><a href="#the-table_description" id="toc-the-table_description">The
table_description</a></li>
<li><a href="#examples" id="toc-examples">Examples</a></li>
</ul></li>
<li><a href="#extracting-more-than-one-resource-type" id="toc-extracting-more-than-one-resource-type">Extracting more than one
resource type</a></li>
<li><a href="#saving-and-reading-designs" id="toc-saving-and-reading-designs">Saving and reading designs</a></li>
<li><a href="#multiple-entries" id="toc-multiple-entries">Multiple
entries</a></li>
<li><a href="#process-tables-with-multiple-entries" id="toc-process-tables-with-multiple-entries">Process tables with
multiple entries</a>
<ul>
<li><a href="#melt-tables-with-multiple-entries" id="toc-melt-tables-with-multiple-entries">Melt tables with multiple
entries</a></li>
<li><a href="#remove-indices" id="toc-remove-indices">Remove
indices</a></li>
<li><a href="#cast-tables-with-multiple-entries" id="toc-cast-tables-with-multiple-entries">Cast tables with multiple
entries</a></li>
</ul></li>
</ul>
</div>

<p>This vignette covers all topics concerned with flattening FHIR
resources in some depth. If you are interested in a quick overview,
please have a look at the fhircrackr:intro vignette.</p>
<p>Before running any of the following code, you need to load the
<code>fhircrackr</code> package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fhircrackr)</span></code></pre></div>
<div id="preparation" class="section level2">
<h2>Preparation</h2>
<p>In the vignette <code>fhircrackr: Download FHIR resources</code> you
saw how to download FHIR resources into R. Now we’ll have a look at how
to flatten them into data.frames/data.tables. For the rest of the
vignette, we’ll work with the two example data sets from
<code>fhircrackr</code>, which can be made accessible like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pat_bundles <span class="ot">&lt;-</span> <span class="fu">fhir_unserialize</span>(<span class="at">bundles =</span> patient_bundles)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>med_bundles <span class="ot">&lt;-</span> <span class="fu">fhir_unserialize</span>(<span class="at">bundles =</span> medication_bundles)</span></code></pre></div>
<p>See <code>?patient_bundles</code> and
<code>?medication_bundles</code> for the FHIR search requests that
generated them.</p>
<p>There are two extraction scenarios when you want to flatten FHIR
bundles: Either you want to extract just one resource type, or you want
to extract several resource types. Because the structure of different
resource types is quite dissimilar, it makes sense to create one table
per resource type. Therefore the result of the flattening process in
<code>fhircrackr</code> can be either a single table (when extracting
just one resource type) or a list of tables (when extracting more than
one resource type). Both scenarios are realized with a call to
<code>fhir_crack()</code>. We will now explain the two scenarios
individually.</p>
</div>
<div id="extracting-one-resource-type" class="section level2">
<h2>Extracting one resource type</h2>
<p>We’ll start with <code>pat_bundles</code>, which only contains
Patient resources. To transform them into a table, we will use
<code>fhir_crack()</code>. The most important argument
<code>fhir_crack()</code> takes is <code>bundles</code>, an object of
class <code>fhir_bundle_list</code> that is returned by
<code>fhir_search()</code>. The second important argument is
<code>design</code>, which tells the function which data to extract from
the bundle. When we want to extract just one resource type, we can use a
<code>fhir_table_description</code> in the argument <code>design</code>.
<code>fhir_crack()</code> then returns a single data.frame or data.table
(if argument <code>data.table = TRUE</code>).</p>
<p>We’ll show you an example of how it works first and then go on to
explain the <code>fhir_table_description</code> in more detail.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pat_table_description <span class="ot">&lt;-</span> <span class="fu">fhir_table_description</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">resource =</span> <span class="st">&quot;Patient&quot;</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols     =</span> <span class="fu">list</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">id     =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">gender =</span> <span class="st">&quot;gender&quot;</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">name   =</span> <span class="st">&quot;name/family&quot;</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">city   =</span> <span class="st">&quot;address/city&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> <span class="fu">fhir_crack</span>(</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">bundles =</span> pat_bundles,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">design  =</span> pat_table_description,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="dv">0</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(table)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">#        id gender               name          city</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 2072744 female           Nordmann          &lt;NA&gt;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 2431578   male              Smith          &lt;NA&gt;</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 2431568   male Chalmers:::Windsor PleasantVille</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 2431577   male            Malekar          &lt;NA&gt;</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 2431757   male             murali          &lt;NA&gt;</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 2431759   male                XYZ       Phoenix</span></span></code></pre></div>
<div id="the-table_description" class="section level3">
<h3>The table_description</h3>
<p>A <code>fhir_table_description</code> holds all the information
<code>fhir_crack()</code> needs to create a table from resources of a
certain type. It is created with <code>fhir_table_description()</code>
by providing the following arguments:</p>
<div id="the-resource-argument" class="section level4">
<h4>The <code>resource</code> argument</h4>
<p>This is basically a string that defines the resource type
(e.g. Patient or Observation) to extract. It is the only argument that
you must provide and you set it like this:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fhir_table_description</span>(<span class="at">resource =</span> <span class="st">&quot;Patient&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A fhir_table_description with the following elements: </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># resource: Patient</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># cols: </span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># An empty fhir_columns object</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># sep:           &#39;:::&#39;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># brackets:      no brackets</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># rm_empty_cols: FALSE</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># format:        &#39;compact&#39;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># keep_attr:     FALSE</span></span></code></pre></div>
<p>Internally, <code>fhir_table_description()</code> calls
<code>fhir_resource_type()</code> which checks the type you provided
against list of all currently available resource types which can be
found at
<a href="https://hl7.org/FHIR/resourcelist.html" target="_blank">https://hl7.org/FHIR/resourcelist.html</a>.
Case errors are corrected automatically and the function throws a
warning if the resource type doesn’t match the list under hl7.org.</p>
<p>As you can see in the above output, there are more elements in a
<code>fhir_table_description</code> which are filled automatically by
<code>fhir_table_description()</code>.</p>
</div>
<div id="the-cols-argument" class="section level4">
<h4>The cols argument</h4>
<p>The <code>cols</code> argument takes the column names and XPath (1.0)
expressions defining the columns to create from the FHIR resources. The
XPath expression has to be built relatively to the root of the resource
tree. If the <code>cols</code> element is empty,
<code>fhir_crack()</code> will extract all available elements of the
resource and name the columns automatically. To explicitly define
columns, you can provide a (named) character or a (named) list with
XPath expressions like this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fhir_table_description</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">resource =</span> <span class="st">&quot;Patient&quot;</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols     =</span> <span class="fu">list</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">gender =</span> <span class="st">&quot;gender&quot;</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">name   =</span> <span class="st">&quot;name/family&quot;</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">city   =</span> <span class="st">&quot;address/city&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># A fhir_table_description with the following elements: </span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># resource: Patient</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># cols: </span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># column name | xpath expression</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># gender      | gender</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># name        | name/family</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># city        | address/city</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co"># sep:           &#39;:::&#39;</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co"># brackets:      no brackets</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co"># rm_empty_cols: FALSE</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># format:        &#39;compact&#39;</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co"># keep_attr:     FALSE</span></span></code></pre></div>
<p>In this case a table with three columns called gender, name and city
will be created. They will be filled with the element that can be found
under the respective xpath expression in the resource. The element will
be extracted regardless of the attribute that is used (in FHIR this is
mostly <code>@value</code> but can also be <code>@id</code> or
<code>@url</code> in rare cases). If you are interested in keeping the
attribute information, you can set <code>keep_attr = TRUE</code>, in
which case the attribute will be attached to the column name.</p>
<p>Internally, <code>fhir_table_description()</code> calls
<code>fhir_columns()</code> to check the validity of the XPath
expressions and assign column names. You can provide the XPath
expressions in a named or unnamed character vector or a named or unnamed
list. If you choose the unnamed version, the names will be set
automatically and reflect the respective XPath expression:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#custom column names</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fhir_columns</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">xpaths =</span> <span class="fu">c</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">gender =</span> <span class="st">&quot;gender&quot;</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">name   =</span> <span class="st">&quot;name/family&quot;</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">city   =</span> <span class="st">&quot;address/city&quot;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># column name | xpath expression</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># gender      | gender</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># name        | name/family</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># city        | address/city</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#automatic column names</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="fu">fhir_columns</span>(<span class="at">xpaths =</span> <span class="fu">c</span>(<span class="st">&quot;gender&quot;</span>, <span class="st">&quot;name/family&quot;</span>, <span class="st">&quot;address/city&quot;</span>))</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------- -----------------</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># column name  | xpath expression</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------- -----------------</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># gender       | gender</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># name.family  | name/family</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co"># address.city | address/city</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------- -----------------</span></span></code></pre></div>
<p>A <code>fhir_columns</code> object that is created explicitly like
this can of course also be used in the <code>columns</code> argument of
<code>fhir_table_description</code>. We strongly advise to only use
fully specified relative XPath expressions here,
e.g. <code>&quot;ingredient/strength/numerator/code&quot;</code> and not search
paths like <code>&quot;//code&quot;</code>, as those can generate unexpected
results especially if the searched element appears on different levels
of the resource.</p>
</div>
<div id="other-arguments" class="section level4">
<h4>Other arguments</h4>
<p>While the <code>resource</code> and <code>cols</code> control
<em>what</em> is extracted from the bundles, the remaining elements of a
<code>fhir_table_description</code> control <em>how</em> the resulting
table looks. These elements for example control how
<code>fhir_crack()</code> deals with multiple entries for the same
element and with columns that are completely empty, i.e. have only
<code>NA</code> values. Furthermore you can select the shape of the
output tables and how column names are generated:</p>
<ul>
<li>The <code>sep</code> element is a string defining the separator used
when multiple entries to the same attribute are pasted together. This
could for example happen if there is more than one address entry in a
Patient resource. Examples of this are shown further down under the
heading <strong>Multiple entries</strong>.</li>
<li>The <code>brackets</code> element is either an empty character
vector (of length 0) or a character vector of length 2. If it is empty,
multiple entries will be pasted together without indices. If it is of
length 2, the two strings provided here are used as brackets for
automatically generated indices to sort out multiple entries (see
paragraph Multiple Entries). <code>brackets = c(&quot;[&quot;, &quot;]&quot;)</code>
e.g. will lead to indices like <code>[1.1]</code>.<br />
</li>
<li>The <code>rm_empty_cols</code> flag can be <code>TRUE</code> or
<code>FALSE</code>. If <code>TRUE</code>, columns containing only
<code>NA</code> values will be removed, if <code>FALSE</code>, these
columns will be kept.<br />
</li>
<li>The <code>format</code> element takes values <code>compact</code> or
<code>wide</code> that specify the shape of the output table. In a
<code>compact</code> table multiple entries are written into the same
cell/column separated by <code>sep</code>. In a <code>wide</code> table
multiple entries are spread over several indexed columns. See the
paragraph on multiple entries for more information.</li>
<li>The <code>keep_attr</code> flag controls whether the xml tag
attributes of the FHIR element should be attached to the end of the
column name or not. For the column extracted by <code>name/given</code>,
the name would result in <code>name.given</code> if
<code>keep_attr = FALSE</code> and <code>name.given@value</code> if
<code>keep_attr = TRUE</code>.</li>
</ul>
<p>All five style elements can also be controlled directly by the
<code>fhir_crack()</code> arguments <code>sep</code>,
<code>brackets</code>, <code>remove_empty_columns</code>,
<code>format</code> and <code>keep_attr</code>. If the function
arguments are <code>NULL</code> (their default), the values provided in
<code>fhir_table_description</code> are used, if they are not NULL, they
will overwrite any values in <code>fhir_table_description</code>.</p>
<p>A fully defined set of a <code>Patient</code> table description would
be like this:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>table_description <span class="ot">&lt;-</span> <span class="fu">fhir_table_description</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">resource =</span> <span class="st">&quot;Patient&quot;</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols     =</span> <span class="fu">list</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">gender =</span> <span class="st">&quot;gender&quot;</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">name   =</span> <span class="st">&quot;name/family&quot;</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">city   =</span> <span class="st">&quot;address/city&quot;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep           =</span> <span class="st">&quot;||&quot;</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">brackets      =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rm_empty_cols =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">format        =</span> <span class="st">&quot;compact&quot;</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">keep_attr     =</span> <span class="cn">FALSE</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>We will now work through examples using
<code>fhir_table_descriptions</code> of different complexity.</p>
</div>
</div>
<div id="examples" class="section level3">
<h3>Examples</h3>
<div id="extract-all-available-attributes" class="section level4">
<h4>Extract all available attributes</h4>
<p>Lets start with an example where we only provide the (mandatory)
<code>resource</code> component of the table_description. In this case,
<code>fhir_crack()</code> will extract all available attributes and use
default values for the other elements:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define a table_description</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>table_description1 <span class="ot">&lt;-</span> <span class="fu">fhir_table_description</span>(<span class="at">resource =</span> <span class="st">&quot;Patient&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#convert resources</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#pass table_description1 to the design argument</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> <span class="fu">fhir_crack</span>(<span class="at">bundles =</span> pat_bundles, <span class="at">design =</span> table_description1, <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#have look at part of the results</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>table[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]<span class="co">#38:42</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   active  address.city address.district   address.line address.period.start</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1   &lt;NA&gt;          &lt;NA&gt;             &lt;NA&gt;           &lt;NA&gt;                 &lt;NA&gt;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2   &lt;NA&gt;          &lt;NA&gt;             &lt;NA&gt;           &lt;NA&gt;                 &lt;NA&gt;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 3   true PleasantVille          Rainbow 534 Erewhon St           1974-12-25</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 4   true          &lt;NA&gt;             &lt;NA&gt;           &lt;NA&gt;                 &lt;NA&gt;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 5   true          &lt;NA&gt;             &lt;NA&gt;           &lt;NA&gt;                 &lt;NA&gt;</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">#see the fill result with:</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">#View(table)</span></span></code></pre></div>
<p>As you can see, this can easily become a rather wide and sparse data
frame. This is due to the fact that every every element appearing in at
least one of the resources will be turned into a variable (i.e. column),
even if none of the other resources contain this element. For those
resources, the value on that element will be set to <code>NA</code>.
Depending on the variability of the resources, the resulting table can
contain a lot of <code>NA</code> values. If a resource has multiple
entries for an element (e.g. several addresses in a Patient resource),
these entries will pasted together using the string provided in
<code>sep</code> as a separator. The column names in this option are
automatically generated by pasting together the path to the respective
element, e.g. <code>name.given</code>.</p>
</div>
<div id="extract-specific-elements" class="section level4">
<h4>Extract specific elements</h4>
<p>If we know which elements we want to extract, we can specify them in
a named list and provide it in the <code>cols</code> component of the
table description:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define a table_description</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>table_description2 <span class="ot">&lt;-</span> <span class="fu">fhir_table_description</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">resource =</span> <span class="st">&quot;Patient&quot;</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols     =</span> <span class="fu">list</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">PID         =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">use_name    =</span> <span class="st">&quot;name/use&quot;</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">given_name  =</span> <span class="st">&quot;name/given&quot;</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">family_name =</span> <span class="st">&quot;name/family&quot;</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">gender      =</span> <span class="st">&quot;gender&quot;</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">birthday    =</span> <span class="st">&quot;birthDate&quot;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#convert resources</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>table <span class="ot">&lt;-</span> <span class="fu">fhir_crack</span>(<span class="at">bundles =</span> pat_bundles, <span class="at">design =</span> table_description2, <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">#have look at the results</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(table)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">#       PID                  use_name                          given_name</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 2072744                  official                            K:::Kari</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 2431578                  official                               Roman</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 2431568 official:::usual:::maiden Peter:::James:::Jim:::Peter:::James</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 2431577                  official                    Ganpat:::Malekar</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 2431757                       old                                &lt;NA&gt;</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 2431759                  official                                 ABC</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co">#          family_name gender   birthday</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 1           Nordmann female 2018-09-12</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 2              Smith   male 2021-07-19</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 Chalmers:::Windsor   male 1974-12-25</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 4            Malekar   male 1996-02-07</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 5             murali   male       &lt;NA&gt;</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 6                XYZ   male 1998-01-03</span></span></code></pre></div>
<p>This option will return more tidy and clear data frames, because you
have full control over the extracted columns including their name in the
resulting table. You should always extract the resource id, because this
is used to link to other resources you might also extract.</p>
<p>If you are not sure which elements are available or where they are
located in the resource, it can be helpful to start by extracting all
available elements. If you are more comfortable with xml, you can also
use <code>xml2::xml_structure</code> on one of the bundles from your
bundle list, this will print the complete xml structure into your
console. Then you can get an overview over the available element and
their location and continue by doing a second, more targeted extraction
to get your final table.</p>
<p>If you want to have a look at how the design looked that was actually
used in the last call to <code>fhir_crack()</code> you can retrieve it
with <code>fhir_canonical_design()</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fhir_canonical_design</span>()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A fhir_table_description with the following elements: </span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># resource: Patient</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># cols: </span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># column name | xpath expression</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># PID         | id</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># use_name    | name/use</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># given_name  | name/given</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># family_name | name/family</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># gender      | gender</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co"># birthday    | birthDate</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># sep:           &#39;:::&#39;</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># brackets:      no brackets</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># rm_empty_cols: FALSE</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co"># format:        &#39;compact&#39;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># keep_attr:     FALSE</span></span></code></pre></div>
</div>
</div>
</div>
<div id="extracting-more-than-one-resource-type" class="section level2">
<h2>Extracting more than one resource type</h2>
<p>Of course the previous example is using just one resource type. If
you are interested in several types of resources, you need one
<code>fhir_table_description</code> per resource type. You can bundle a
bunch of <code>fhir_table_descriptions</code> in a
<code>fhir_design</code>. This is basically a named list of
<code>fhir_table_descriptions</code>, and when you pass it to
<code>fhir_crack()</code>, the result will be a named list of tables
with the same names as the design. Consider an example where we have
downloaded MedicationStatements referring to a certain medication as
well as the Patient resources these MedicationStatements are linked
to.</p>
<p>The design to extract both resource types could look like this:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>meds <span class="ot">&lt;-</span> <span class="fu">fhir_table_description</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">resource =</span> <span class="st">&quot;MedicationStatement&quot;</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols     =</span> <span class="fu">list</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">ms_id       =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">status_text =</span> <span class="st">&quot;text/status&quot;</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">status      =</span> <span class="st">&quot;status&quot;</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">med_system  =</span> <span class="st">&quot;medicationCodeableConcept/coding/system&quot;</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">med_code    =</span> <span class="st">&quot;medicationCodeableConcept/coding/code&quot;</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">med_display =</span> <span class="st">&quot;medicationCodeableConcept/coding/display&quot;</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">dosage      =</span> <span class="st">&quot;dosage/text&quot;</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">patient     =</span> <span class="st">&quot;subject/reference&quot;</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">last_update =</span> <span class="st">&quot;meta/lastUpdated&quot;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep           =</span> <span class="st">&quot;|&quot;</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">brackets      =</span> <span class="cn">NULL</span>,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">rm_empty_cols =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">format        =</span> <span class="st">&#39;compact&#39;</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">keep_attr     =</span> <span class="cn">FALSE</span> </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>pat <span class="ot">&lt;-</span> <span class="fu">fhir_table_description</span>(<span class="at">resource =</span> <span class="st">&quot;Patient&quot;</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">fhir_design</span>(meds, pat)</span></code></pre></div>
<p>In this example, we have spelled out the table_description
MedicationStatement completely, while we have used a short form for
Patients. It looks like this:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>design</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A fhir_design with 2 table descriptions:</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A fhir_table_description with the following elements: </span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># resource: MedicationStatement</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># cols: </span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------------------------------</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># column name | xpath expression</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------------------------------</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ms_id       | id</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># status_text | text/status</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># status      | status</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># med_system  | medicationCodeableConcept/coding/system</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># med_code    | medicationCodeableConcept/coding/code</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># med_display | medicationCodeableConcept/coding/display</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># dosage      | dosage/text</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># patient     | subject/reference</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># last_update | meta/lastUpdated</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------------------------------</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co"># sep:           &#39;|&#39;</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co"># brackets:      no brackets</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># rm_empty_cols: FALSE</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co"># format:        &#39;compact&#39;</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co"># keep_attr:     FALSE</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># A fhir_table_description with the following elements: </span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co"># resource: Patient</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co"># cols: </span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="co"># An empty fhir_columns object</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="co"># sep:           &#39;:::&#39;</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="co"># brackets:      no brackets</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="co"># rm_empty_cols: FALSE</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co"># format:        &#39;compact&#39;</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="co"># keep_attr:     FALSE</span></span></code></pre></div>
<p>As you can see, each table_description is identified by a name, which
will also be the name of the corresponding table in the result of
<code>fhir_crack()</code>.</p>
<p>You can assign the names explicitly, if you prefer:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">fhir_design</span>(<span class="at">Medications =</span> meds, <span class="at">Patients =</span> pat)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>design</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># A fhir_design with 2 table descriptions:</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># A fhir_table_description with the following elements: </span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># resource: MedicationStatement</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># cols: </span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------------------------------</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># column name | xpath expression</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------------------------------</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ms_id       | id</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># status_text | text/status</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># status      | status</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># med_system  | medicationCodeableConcept/coding/system</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co"># med_code    | medicationCodeableConcept/coding/code</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># med_display | medicationCodeableConcept/coding/display</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># dosage      | dosage/text</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co"># patient     | subject/reference</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># last_update | meta/lastUpdated</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------------------------------</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="co"># sep:           &#39;|&#39;</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="co"># brackets:      no brackets</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="co"># rm_empty_cols: FALSE</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="co"># format:        &#39;compact&#39;</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="co"># keep_attr:     FALSE</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="co"># A fhir_table_description with the following elements: </span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="co"># resource: Patient</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="co"># cols: </span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="co"># An empty fhir_columns object</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="co"># sep:           &#39;:::&#39;</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="co"># brackets:      no brackets</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="co"># rm_empty_cols: FALSE</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="co"># format:        &#39;compact&#39;</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="co"># keep_attr:     FALSE</span></span></code></pre></div>
<p>And you can also extract single table_descriptions by their name:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>design<span class="sc">$</span>Patients</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A fhir_table_description with the following elements: </span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># resource: Patient</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># cols: </span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># An empty fhir_columns object</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># sep:           &#39;:::&#39;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># brackets:      no brackets</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># rm_empty_cols: FALSE</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># format:        &#39;compact&#39;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># keep_attr:     FALSE</span></span></code></pre></div>
<p>We can use the <code>design</code> for <code>fhir_crack()</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>list_of_tables <span class="ot">&lt;-</span> <span class="fu">fhir_crack</span>(<span class="at">bundles =</span> med_bundles, <span class="at">design =</span> design, <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(list_of_tables<span class="sc">$</span>Medications)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#    ms_id status_text status            med_system  med_code      med_display</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1  30233   generated active http://snomed.info/ct 429374003 simvastatin 40mg</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2  42091   generated active http://snomed.info/ct 429374003 simvastatin 40mg</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3  45724   generated active http://snomed.info/ct 429374003 simvastatin 40mg</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 4  59597   generated active http://snomed.info/ct 429374003 simvastatin 40mg</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 5  69117   generated active http://snomed.info/ct 429374003 simvastatin 40mg</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 591941   generated active http://snomed.info/ct 429374003 simvastatin 40mg</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#             dosage        patient                   last_update</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 1 tab once daily  Patient/30163 2019-09-26T14:34:44.543+00:00</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 1 tab once daily  Patient/42024 2019-10-09T22:44:05.728+00:00</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 1 tab once daily  Patient/45657 2019-10-11T16:30:24.411+00:00</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 1 tab once daily  Patient/59530 2019-11-12T14:27:00.098+00:00</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 1 tab once daily  Patient/69050 2019-11-16T16:51:50.759+00:00</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 1 tab once daily Patient/591874 2020-01-22T12:53:40.539+00:00</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(list_of_tables<span class="sc">$</span>Patients)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   address.city address.country address.district</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 1         &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 2         &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 3         &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 4         &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 5         &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 6     Westford              US             &lt;NA&gt;</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co">#                                     address.extension</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                                                &lt;NA&gt;</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                                                &lt;NA&gt;</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                                                &lt;NA&gt;</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                                                &lt;NA&gt;</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                                                &lt;NA&gt;</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 http://hl7.org/fhir/StructureDefinition/geolocation</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   address.extension.extension address.extension.extension.valueDecimal</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                        &lt;NA&gt;                                     &lt;NA&gt;</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                        &lt;NA&gt;                                     &lt;NA&gt;</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                        &lt;NA&gt;                                     &lt;NA&gt;</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                        &lt;NA&gt;                                     &lt;NA&gt;</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                        &lt;NA&gt;                                     &lt;NA&gt;</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 6        latitude:::longitude    42.58942256332994:::-71.3827654850569</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a><span class="co">#        address.line address.postalCode address.state address.text address.type</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a><span class="co"># 1              &lt;NA&gt;               &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a><span class="co"># 2              &lt;NA&gt;               &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a><span class="co"># 3              &lt;NA&gt;               &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a><span class="co"># 4              &lt;NA&gt;               &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="co"># 5              &lt;NA&gt;               &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 378 Krajcik Lodge               &lt;NA&gt; Massachusetts         &lt;NA&gt;         &lt;NA&gt;</span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   address.use  birthDate communication.language.coding.code</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a><span class="co"># 1        &lt;NA&gt; 2020-03-23                               &lt;NA&gt;</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a><span class="co"># 2        &lt;NA&gt; 2020-03-24                               &lt;NA&gt;</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 3        &lt;NA&gt; 1979-10-08                               &lt;NA&gt;</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a><span class="co"># 4        &lt;NA&gt; 2019-11-10                               &lt;NA&gt;</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a><span class="co"># 5        &lt;NA&gt; 1970-01-10                               &lt;NA&gt;</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a><span class="co"># 6        &lt;NA&gt; 1946-03-29                              en-US</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   communication.language.coding.display communication.language.coding.system</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                                  &lt;NA&gt;                                 &lt;NA&gt;</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                                  &lt;NA&gt;                                 &lt;NA&gt;</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                                  &lt;NA&gt;                                 &lt;NA&gt;</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                                  &lt;NA&gt;                                 &lt;NA&gt;</span></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                                  &lt;NA&gt;                                 &lt;NA&gt;</span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a><span class="co"># 6                               English                      urn:ietf:bcp:47</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a><span class="co">#   communication.language.text</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                        &lt;NA&gt;</span></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                        &lt;NA&gt;</span></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                        &lt;NA&gt;</span></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                        &lt;NA&gt;</span></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                        &lt;NA&gt;</span></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a><span class="co"># 6                     English</span></span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                                                                                                                                                                                                                                                                                                                                                                                                                                               extension</span></span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  &lt;NA&gt;</span></span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  &lt;NA&gt;</span></span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  &lt;NA&gt;</span></span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  &lt;NA&gt;</span></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  &lt;NA&gt;</span></span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 http://hl7.org/fhir/us/core/StructureDefinition/us-core-race:::http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity:::http://hl7.org/fhir/StructureDefinition/patient-mothersMaidenName:::http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex:::http://hl7.org/fhir/StructureDefinition/patient-birthPlace:::http://synthetichealth.github.io/synthea/disability-adjusted-life-years:::http://synthetichealth.github.io/synthea/quality-adjusted-life-years</span></span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a><span class="co">#                       extension.extension extension.extension.valueCoding.code</span></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                                    &lt;NA&gt;                                 &lt;NA&gt;</span></span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                                    &lt;NA&gt;                                 &lt;NA&gt;</span></span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                                    &lt;NA&gt;                                 &lt;NA&gt;</span></span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                                    &lt;NA&gt;                                 &lt;NA&gt;</span></span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                                    &lt;NA&gt;                                 &lt;NA&gt;</span></span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 ombCategory:::text:::ombCategory:::text                      2106-3:::2186-5</span></span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a><span class="co">#   extension.extension.valueCoding.display</span></span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                                    &lt;NA&gt;</span></span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                                    &lt;NA&gt;</span></span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                                    &lt;NA&gt;</span></span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                                    &lt;NA&gt;</span></span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                                    &lt;NA&gt;</span></span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a><span class="co"># 6          White:::Not Hispanic or Latino</span></span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a><span class="co">#                              extension.extension.valueCoding.system</span></span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                                                              &lt;NA&gt;</span></span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                                                              &lt;NA&gt;</span></span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                                                              &lt;NA&gt;</span></span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                                                              &lt;NA&gt;</span></span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                                                              &lt;NA&gt;</span></span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 urn:oid:2.16.840.1.113883.6.238:::urn:oid:2.16.840.1.113883.6.238</span></span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a><span class="co">#   extension.extension.valueString extension.valueAddress.city</span></span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                            &lt;NA&gt;                        &lt;NA&gt;</span></span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                            &lt;NA&gt;                        &lt;NA&gt;</span></span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                            &lt;NA&gt;                        &lt;NA&gt;</span></span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                            &lt;NA&gt;                        &lt;NA&gt;</span></span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                            &lt;NA&gt;                        &lt;NA&gt;</span></span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a><span class="co"># 6  White:::Not Hispanic or Latino                      Boston</span></span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a><span class="co">#   extension.valueAddress.country extension.valueAddress.state</span></span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                           &lt;NA&gt;                         &lt;NA&gt;</span></span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                           &lt;NA&gt;                         &lt;NA&gt;</span></span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                           &lt;NA&gt;                         &lt;NA&gt;</span></span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                           &lt;NA&gt;                         &lt;NA&gt;</span></span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                           &lt;NA&gt;                         &lt;NA&gt;</span></span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a><span class="co"># 6                             US                Massachusetts</span></span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a><span class="co">#   extension.valueCode                extension.valueDecimal</span></span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                &lt;NA&gt;                                  &lt;NA&gt;</span></span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                &lt;NA&gt;                                  &lt;NA&gt;</span></span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                &lt;NA&gt;                                  &lt;NA&gt;</span></span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                &lt;NA&gt;                                  &lt;NA&gt;</span></span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                &lt;NA&gt;                                  &lt;NA&gt;</span></span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a><span class="co"># 6                   M 4.160702818392717:::67.83929718160728</span></span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a><span class="co">#   extension.valueString gender generalPractitioner.reference      id</span></span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                  &lt;NA&gt;   male                          &lt;NA&gt;  697738</span></span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                  &lt;NA&gt;   male                          &lt;NA&gt;  697934</span></span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                  &lt;NA&gt; female                          &lt;NA&gt;   42024</span></span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                  &lt;NA&gt; female                          &lt;NA&gt;   59530</span></span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                  &lt;NA&gt;   male                          &lt;NA&gt; 1162779</span></span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a><span class="co"># 6   Kristyn560 Lesch175   male           Practitioner/636228  636226</span></span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                                                                                                                                                           identifier.system</span></span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                                                                                                                                                                                                      &lt;NA&gt;</span></span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                                                                                                                                                                                                      &lt;NA&gt;</span></span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                                                                                                                                                                                                      &lt;NA&gt;</span></span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                                                                                                                                                                                                      &lt;NA&gt;</span></span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                                                                                                                                                                                                      &lt;NA&gt;</span></span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 http://www.interopx.com:::http://hospital.smarthealthit.org:::http://hl7.org/fhir/sid/us-ssn:::urn:oid:2.16.840.1.113883.4.3.25:::http://standardhealthrecord.org/fhir/StructureDefinition/passportNumber</span></span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true" tabindex="-1"></a><span class="co">#   identifier.type.coding.code</span></span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                        &lt;NA&gt;</span></span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                        &lt;NA&gt;</span></span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                        &lt;NA&gt;</span></span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                        &lt;NA&gt;</span></span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                        &lt;NA&gt;</span></span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true" tabindex="-1"></a><span class="co"># 6          MR:::SS:::DL:::PPN</span></span>
<span id="cb15-139"><a href="#cb15-139" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                        identifier.type.coding.display</span></span>
<span id="cb15-140"><a href="#cb15-140" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                                                                                &lt;NA&gt;</span></span>
<span id="cb15-141"><a href="#cb15-141" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                                                                                &lt;NA&gt;</span></span>
<span id="cb15-142"><a href="#cb15-142" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                                                                                &lt;NA&gt;</span></span>
<span id="cb15-143"><a href="#cb15-143" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                                                                                &lt;NA&gt;</span></span>
<span id="cb15-144"><a href="#cb15-144" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                                                                                &lt;NA&gt;</span></span>
<span id="cb15-145"><a href="#cb15-145" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 Medical Record Number:::Social Security Number:::Driver&#39;s License:::Passport Number</span></span>
<span id="cb15-146"><a href="#cb15-146" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                                                                                                                                   identifier.type.coding.system</span></span>
<span id="cb15-147"><a href="#cb15-147" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                                                                                                                                                                                          &lt;NA&gt;</span></span>
<span id="cb15-148"><a href="#cb15-148" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                                                                                                                                                                                          &lt;NA&gt;</span></span>
<span id="cb15-149"><a href="#cb15-149" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                                                                                                                                                                                          &lt;NA&gt;</span></span>
<span id="cb15-150"><a href="#cb15-150" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                                                                                                                                                                                          &lt;NA&gt;</span></span>
<span id="cb15-151"><a href="#cb15-151" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                                                                                                                                                                                          &lt;NA&gt;</span></span>
<span id="cb15-152"><a href="#cb15-152" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 http://terminology.hl7.org/CodeSystem/v2-0203:::http://terminology.hl7.org/CodeSystem/v2-0203:::http://terminology.hl7.org/CodeSystem/v2-0203:::http://terminology.hl7.org/CodeSystem/v2-0203</span></span>
<span id="cb15-153"><a href="#cb15-153" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                                  identifier.type.text</span></span>
<span id="cb15-154"><a href="#cb15-154" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                                                                                &lt;NA&gt;</span></span>
<span id="cb15-155"><a href="#cb15-155" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                                                                                &lt;NA&gt;</span></span>
<span id="cb15-156"><a href="#cb15-156" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                                                                                &lt;NA&gt;</span></span>
<span id="cb15-157"><a href="#cb15-157" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                                                                                &lt;NA&gt;</span></span>
<span id="cb15-158"><a href="#cb15-158" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                                                                                &lt;NA&gt;</span></span>
<span id="cb15-159"><a href="#cb15-159" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 Medical Record Number:::Social Security Number:::Driver&#39;s License:::Passport Number</span></span>
<span id="cb15-160"><a href="#cb15-160" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                                       identifier.value</span></span>
<span id="cb15-161"><a href="#cb15-161" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                                                                                 &lt;NA&gt;</span></span>
<span id="cb15-162"><a href="#cb15-162" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                                                                                 &lt;NA&gt;</span></span>
<span id="cb15-163"><a href="#cb15-163" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                                                                                 &lt;NA&gt;</span></span>
<span id="cb15-164"><a href="#cb15-164" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                                                                                 &lt;NA&gt;</span></span>
<span id="cb15-165"><a href="#cb15-165" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                                                                                 &lt;NA&gt;</span></span>
<span id="cb15-166"><a href="#cb15-166" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 411669:::41166989-975d-4d17-b9de-17f94cb3eec1:::999-17-8717:::S99933732:::X75257608X</span></span>
<span id="cb15-167"><a href="#cb15-167" aria-hidden="true" tabindex="-1"></a><span class="co">#   managingOrganization.reference maritalStatus.coding.code</span></span>
<span id="cb15-168"><a href="#cb15-168" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                           &lt;NA&gt;                      &lt;NA&gt;</span></span>
<span id="cb15-169"><a href="#cb15-169" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                           &lt;NA&gt;                      &lt;NA&gt;</span></span>
<span id="cb15-170"><a href="#cb15-170" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                           &lt;NA&gt;                      &lt;NA&gt;</span></span>
<span id="cb15-171"><a href="#cb15-171" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                           &lt;NA&gt;                      &lt;NA&gt;</span></span>
<span id="cb15-172"><a href="#cb15-172" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                           &lt;NA&gt;                      &lt;NA&gt;</span></span>
<span id="cb15-173"><a href="#cb15-173" aria-hidden="true" tabindex="-1"></a><span class="co"># 6            Organization/636227                         M</span></span>
<span id="cb15-174"><a href="#cb15-174" aria-hidden="true" tabindex="-1"></a><span class="co">#   maritalStatus.coding.display</span></span>
<span id="cb15-175"><a href="#cb15-175" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                         &lt;NA&gt;</span></span>
<span id="cb15-176"><a href="#cb15-176" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                         &lt;NA&gt;</span></span>
<span id="cb15-177"><a href="#cb15-177" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                         &lt;NA&gt;</span></span>
<span id="cb15-178"><a href="#cb15-178" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                         &lt;NA&gt;</span></span>
<span id="cb15-179"><a href="#cb15-179" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                         &lt;NA&gt;</span></span>
<span id="cb15-180"><a href="#cb15-180" aria-hidden="true" tabindex="-1"></a><span class="co"># 6                            M</span></span>
<span id="cb15-181"><a href="#cb15-181" aria-hidden="true" tabindex="-1"></a><span class="co">#                              maritalStatus.coding.system maritalStatus.text</span></span>
<span id="cb15-182"><a href="#cb15-182" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                                                   &lt;NA&gt;               &lt;NA&gt;</span></span>
<span id="cb15-183"><a href="#cb15-183" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                                                   &lt;NA&gt;               &lt;NA&gt;</span></span>
<span id="cb15-184"><a href="#cb15-184" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                                                   &lt;NA&gt;               &lt;NA&gt;</span></span>
<span id="cb15-185"><a href="#cb15-185" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                                                   &lt;NA&gt;               &lt;NA&gt;</span></span>
<span id="cb15-186"><a href="#cb15-186" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                                                   &lt;NA&gt;               &lt;NA&gt;</span></span>
<span id="cb15-187"><a href="#cb15-187" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 http://terminology.hl7.org/CodeSystem/v3-MaritalStatus                  M</span></span>
<span id="cb15-188"><a href="#cb15-188" aria-hidden="true" tabindex="-1"></a><span class="co">#                meta.lastUpdated       meta.source meta.versionId</span></span>
<span id="cb15-189"><a href="#cb15-189" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 2020-03-23T16:12:33.294+00:00 #LUrUNxAhdZrFHftu              1</span></span>
<span id="cb15-190"><a href="#cb15-190" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 2020-03-24T06:19:22.991+00:00 #F6KTacg6zpZSnNLM              1</span></span>
<span id="cb15-191"><a href="#cb15-191" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 2020-08-07T14:25:55.860+00:00 #S9uv5jD2iAAi5WFP              3</span></span>
<span id="cb15-192"><a href="#cb15-192" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 2021-07-13T08:44:06.580+00:00 #qWzI8wftDtgcB3LC              6</span></span>
<span id="cb15-193"><a href="#cb15-193" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 2021-10-15T09:10:37.409+00:00 #JnxgDwhILtrVk2uc              5</span></span>
<span id="cb15-194"><a href="#cb15-194" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 2020-03-04T07:48:04.171+00:00 #zQK1HhDgSQFBnN3C              1</span></span>
<span id="cb15-195"><a href="#cb15-195" aria-hidden="true" tabindex="-1"></a><span class="co">#   multipleBirthBoolean   name.family name.given name.prefix     name.text</span></span>
<span id="cb15-196"><a href="#cb15-196" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                 &lt;NA&gt;        Cooper     Xavier        &lt;NA&gt; Xavier Cooper</span></span>
<span id="cb15-197"><a href="#cb15-197" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                 &lt;NA&gt;           Hay      Harry        &lt;NA&gt;     Harry Hay</span></span>
<span id="cb15-198"><a href="#cb15-198" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                 &lt;NA&gt;        Walker      Pippa        &lt;NA&gt;  Pippa Walker</span></span>
<span id="cb15-199"><a href="#cb15-199" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                 &lt;NA&gt;        Singh2      Anna         &lt;NA&gt;          &lt;NA&gt;</span></span>
<span id="cb15-200"><a href="#cb15-200" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                 &lt;NA&gt;           Doe       John        &lt;NA&gt;      John Doe</span></span>
<span id="cb15-201"><a href="#cb15-201" aria-hidden="true" tabindex="-1"></a><span class="co"># 6                false Stiedemann542   Aaron697         Mr.          &lt;NA&gt;</span></span>
<span id="cb15-202"><a href="#cb15-202" aria-hidden="true" tabindex="-1"></a><span class="co">#   name.use telecom.system telecom.use telecom.value text.status</span></span>
<span id="cb15-203"><a href="#cb15-203" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 official           &lt;NA&gt;        &lt;NA&gt;          &lt;NA&gt;   generated</span></span>
<span id="cb15-204"><a href="#cb15-204" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 official           &lt;NA&gt;        &lt;NA&gt;          &lt;NA&gt;   generated</span></span>
<span id="cb15-205"><a href="#cb15-205" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 official           &lt;NA&gt;        &lt;NA&gt;          &lt;NA&gt;   generated</span></span>
<span id="cb15-206"><a href="#cb15-206" aria-hidden="true" tabindex="-1"></a><span class="co"># 4     &lt;NA&gt;           &lt;NA&gt;        &lt;NA&gt;          &lt;NA&gt;   generated</span></span>
<span id="cb15-207"><a href="#cb15-207" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 official           &lt;NA&gt;        &lt;NA&gt;          &lt;NA&gt;   generated</span></span>
<span id="cb15-208"><a href="#cb15-208" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 official          phone        home  555-213-2064   generated</span></span></code></pre></div>
<p>As you can see, the result is a list of tables, one for Patient
resources and one for MedicationStatement resources. When you use
<code>fhir_crack()</code> with a <code>fhir_desgn()</code> instead of a
<code>fhir_table_description</code>, the result is an object of class
<code>fhir_df_list</code> or <code>fhir_dt_list</code> that also has the
design attached. You can extract the design from a list like this using
<code>fhir_design()</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fhir_design</span>(list_of_tables)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A fhir_design with 2 table descriptions:</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A fhir_table_description with the following elements: </span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># resource: MedicationStatement</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># cols: </span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------------------------------</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># column name | xpath expression</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------------------------------</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ms_id       | id</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># status_text | text/status</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># status      | status</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># med_system  | medicationCodeableConcept/coding/system</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co"># med_code    | medicationCodeableConcept/coding/code</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># med_display | medicationCodeableConcept/coding/display</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co"># dosage      | dosage/text</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># patient     | subject/reference</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co"># last_update | meta/lastUpdated</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------------------------------</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co"># sep:           &#39;|&#39;</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co"># brackets:      no brackets</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co"># rm_empty_cols: FALSE</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co"># format:        &#39;compact&#39;</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="co"># keep_attr:     FALSE</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="co"># A fhir_table_description with the following elements: </span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="co"># resource: Patient</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co"># cols: </span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="co"># An empty fhir_columns object</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="co"># sep:           &#39;:::&#39;</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="co"># brackets:      no brackets</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="co"># rm_empty_cols: FALSE</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="co"># format:        &#39;compact&#39;</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="co"># keep_attr:     FALSE</span></span></code></pre></div>
<p>Note that this doesn’t work on single tables created with a
<code>fhir_table_description</code>.</p>
</div>
<div id="saving-and-reading-designs" class="section level2">
<h2>Saving and reading designs</h2>
<p>If you want to save a design for later or to share with others, you
can do so using the <code>fhir_save_design()</code>. This function takes
a design and saves it as an xml file:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>temp_dir <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fhir_save_design</span>(<span class="at">design =</span> design, <span class="at">file =</span> <span class="fu">paste0</span>(temp_dir, <span class="st">&quot;/design.xml&quot;</span>))</span></code></pre></div>
<p>To read the design back into R, you can use
<code>fhir_load_design()</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fhir_load_design</span>(<span class="fu">paste0</span>(temp_dir, <span class="st">&quot;/design.xml&quot;</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A fhir_design with 2 table descriptions:</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A fhir_table_description with the following elements: </span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># resource: MedicationStatement</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># cols: </span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------------------------------</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># column name | xpath expression</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------------------------------</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ms_id       | id</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># status_text | text/status</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># status      | status</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># med_system  | medicationCodeableConcept/coding/system</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co"># med_code    | medicationCodeableConcept/coding/code</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co"># med_display | medicationCodeableConcept/coding/display</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co"># dosage      | dosage/text</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co"># patient     | subject/reference</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co"># last_update | meta/lastUpdated</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------ -----------------------------------------</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co"># sep:           &#39;|&#39;</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co"># brackets:      no brackets</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co"># rm_empty_cols: FALSE</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="co"># format:        &#39;compact&#39;</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="co"># keep_attr:     FALSE</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co"># A fhir_table_description with the following elements: </span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="co"># resource: Patient</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="co"># cols: </span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="co"># An empty fhir_columns object</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="co"># sep:           &#39;:::&#39;</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="co"># brackets:      no brackets</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="co"># rm_empty_cols: FALSE</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="co"># format:        &#39;compact&#39;</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="co"># keep_attr:     FALSE</span></span></code></pre></div>
</div>
<div id="multiple-entries" class="section level2">
<h2>Multiple entries</h2>
<p>A particularly complicated problem in flattening FHIR resources is
caused by the fact that there can be multiple entries to an element. The
profile according to which your FHIR resources have been built defines
how often a particular element can appear in a resource. This is called
the <em>cardinality</em> of the element. For example the Patient
resource defined
<a href="https://www.hl7.org/fhir/patient.html#resource" target="_blank">here</a>
can have zero or one birth dates but arbitrarily many addresses. In the
default setting, <code>fhir_crack()</code> will paste multiple entries
for the same element together in the table, using the separator provided
by the <code>sep</code> argument. In most cases this will work just
fine, but there are some special cases that require a little more
attention.</p>
<p>Let’s have a look at an example bundle containing just three Patient
resources. You can make it available in your workspace like this:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>bundle <span class="ot">&lt;-</span> <span class="fu">fhir_unserialize</span>(example_bundles2)</span></code></pre></div>
<p>This is how the xml looks:</p>
<pre><code>&lt;Bundle&gt;
  &lt;type value=&#39;searchset&#39;/&gt;
  &lt;entry&gt;
    &lt;resource&gt;
        &lt;Patient&gt;
            &lt;id value=&#39;id1&#39;/&gt;
            &lt;address&gt;
                &lt;use value=&#39;home&#39;/&gt;
                &lt;city value=&#39;Amsterdam&#39;/&gt;
                &lt;type value=&#39;physical&#39;/&gt;
                &lt;country value=&#39;Netherlands&#39;/&gt;
            &lt;/address&gt;
            &lt;name&gt;
                &lt;given value=&#39;Marie&#39;/&gt;
            &lt;/name&gt;
        &lt;/Patient&gt;
    &lt;/resource&gt;
  &lt;/entry&gt;
  
  &lt;entry&gt;
    &lt;resource&gt;
        &lt;Patient&gt;
            &lt;id value=&#39;id2&#39;/&gt;
            &lt;address&gt;
                &lt;use value=&#39;home&#39;/&gt;
                &lt;city value=&#39;Rome&#39;/&gt;
                &lt;type value=&#39;physical&#39;/&gt;
                &lt;country value=&#39;Italy&#39;/&gt;
            &lt;/address&gt;
            &lt;address&gt;
                &lt;use value=&#39;work&#39;/&gt;
                &lt;city value=&#39;Stockholm&#39;/&gt;
                &lt;type value=&#39;postal&#39;/&gt;
                &lt;country value=&#39;Sweden&#39;/&gt;
            &lt;/address&gt;
            &lt;name&gt;
                &lt;given value=&#39;Susie&#39;/&gt;
            &lt;/name&gt;
        &lt;/Patient&gt;
    &lt;/resource&gt;
  &lt;/entry&gt;
  
  &lt;entry&gt;
    &lt;resource&gt;
        &lt;Patient&gt;
            &lt;id value=&#39;id3&#39;/&gt;
            &lt;address&gt;
                &lt;use value=&#39;home&#39;/&gt;
                &lt;city value=&#39;Berlin&#39;/&gt;
            &lt;/address&gt;
            &lt;address&gt;
                &lt;type value=&#39;postal&#39;/&gt;
                &lt;country value=&#39;France&#39;/&gt;
            &lt;/address&gt;
            &lt;address&gt;
                &lt;use value=&#39;work&#39;/&gt;
                &lt;city value=&#39;London&#39;/&gt;
                &lt;type value=&#39;postal&#39;/&gt;
                &lt;country value=&#39;England&#39;/&gt;
            &lt;/address&gt;
            &lt;name&gt;
                &lt;given value=&#39;Frank&#39;/&gt;
            &lt;/name&gt;
            &lt;name&gt;
                &lt;given value=&#39;Max&#39;/&gt;
            &lt;/name&gt;
        &lt;/Patient&gt;
    &lt;/resource&gt;
  &lt;/entry&gt;

&lt;/Bundle&gt;</code></pre>
<p>This bundle contains three Patient resources. The first resource has
just one entry for the address attribute. The second Patient resource
has two entries containing the same elements for the address attribute.
The third Patient resource has a rather messy address attribute, with
three entries containing different elements and also two entries for the
name attribute.</p>
<p>Let’s see what happens if we extract all attributes:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>desc1 <span class="ot">&lt;-</span> <span class="fu">fhir_table_description</span>(<span class="at">resource =</span> <span class="st">&quot;Patient&quot;</span>, <span class="at">sep =</span> <span class="st">&quot; | &quot;</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">fhir_crack</span>(<span class="at">bundles =</span> bundle, <span class="at">design =</span> desc1, <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#       address.city  address.country      address.type address.use  id</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1        Amsterdam      Netherlands          physical        home id1</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 Rome | Stockholm   Italy | Sweden physical | postal home | work id2</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 3  Berlin | London France | England   postal | postal home | work id3</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">#    name.given</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1       Marie</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2       Susie</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 Frank | Max</span></span></code></pre></div>
<p>As you can see, multiple entries for the same attribute (address and
name) are pasted together. This works fine for Patient 2, but for
Patient 3 you can see a problem with the number of entries that are
displayed. The original Patient resource had <em>three</em> (incomplete)
<code>address</code> entries, but because the first two of them use
complementary elements (<code>use</code> and <code>city</code>
vs. <code>type</code> and <code>country</code>), the resulting pasted
entries look like there had just been two entries for the
<code>address</code> attribute.</p>
<p>You can counter this problem by setting <code>brackets</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>desc2 <span class="ot">&lt;-</span> <span class="fu">fhir_table_description</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">resource =</span> <span class="st">&quot;Patient&quot;</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep      =</span> <span class="st">&quot; | &quot;</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">brackets =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">fhir_crack</span>(<span class="at">bundles =</span> bundle, <span class="at">design =</span> desc2, <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>df2</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                 address.city            address.country</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1             [1.1]Amsterdam           [1.1]Netherlands</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 [1.1]Rome | [2.1]Stockholm   [1.1]Italy | [2.1]Sweden</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 3  [1.1]Berlin | [3.1]London [2.1]France | [3.1]England</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                  address.type           address.use     id</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 1               [1.1]physical             [1.1]home [1]id1</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 [1.1]physical | [2.1]postal [1.1]home | [2.1]work [1]id2</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 3   [2.1]postal | [3.1]postal [1.1]home | [3.1]work [1]id3</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co">#              name.given</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 1            [1.1]Marie</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 2            [1.1]Susie</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 [1.1]Frank | [2.1]Max</span></span></code></pre></div>
<p>Now the indices display the entry the value belongs to. That way you
can see that Patient resource 3 had three entries for the attribute
<code>address</code> and you can also see which attributes belong to
which entry.</p>
<p>If you set the <code>format</code> argument to <code>wide</code>, the
entries are spread over multiple columns and the indices are attached to
column name:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">fhir_crack</span>(<span class="at">bundles =</span> bundle, <span class="at">design =</span> desc2, <span class="at">format =</span> <span class="st">&quot;wide&quot;</span>, <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>df3</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   [1.1]address.city [2.1]address.city [3.1]address.city [1.1]address.country</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1         Amsterdam              &lt;NA&gt;              &lt;NA&gt;          Netherlands</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2              Rome         Stockholm              &lt;NA&gt;                Italy</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3            Berlin              &lt;NA&gt;            London                 &lt;NA&gt;</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   [2.1]address.country [3.1]address.country [1.1]address.type [2.1]address.type</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                 &lt;NA&gt;                 &lt;NA&gt;          physical              &lt;NA&gt;</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2               Sweden                 &lt;NA&gt;          physical            postal</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3               France              England              &lt;NA&gt;            postal</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   [3.1]address.type [1.1]address.use [2.1]address.use [3.1]address.use [1]id</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 1              &lt;NA&gt;             home             &lt;NA&gt;             &lt;NA&gt;   id1</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2              &lt;NA&gt;             home             work             &lt;NA&gt;   id2</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 3            postal             home             &lt;NA&gt;             work   id3</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   [1.1]name.given [2.1]name.given</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 1           Marie            &lt;NA&gt;</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 2           Susie            &lt;NA&gt;</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 3           Frank             Max</span></span></code></pre></div>
<p>Of course the above example is a very specific case that only occurs
if your resources have multiple entries with complementary elements. In
the majority of cases multiple entries in one resource will have the
same structure, thus making numbering of those entries superfluous. But
the indices also help to disentangle those entries and put them in
separate rows, as you’ll see in the next paragraph.</p>
</div>
<div id="process-tables-with-multiple-entries" class="section level2">
<h2>Process tables with multiple entries</h2>
<p>If the table produced by <code>fhir_crack()</code> contains multiple
entries, you’ll probably want to divide these entries into distinct
observations at some point. Apart from directly spreading those values
over multiple columns by using a <code>wide</code> cracking format, the
fhircrackr gives you two options to get from a compact table to either a
long or a wide format: <code>fhir_melt()</code> and
<code>fhir_cast()</code>. The former spreads the entries across rows,
creating a long format, the latter spreads them across columns, creating
a wide format.</p>
<div id="melt-tables-with-multiple-entries" class="section level3">
<h3>Melt tables with multiple entries</h3>
<p><code>fhir_melt()</code> takes an indexed data frame with multiple
entries in one or several <code>columns</code> and spreads (aka melts)
the entries in <code>columns</code> over several rows:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">fhir_melt</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">indexed_data_frame =</span> df2,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns            =</span> <span class="st">&quot;address.city&quot;</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">brackets           =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep                =</span> <span class="st">&quot; | &quot;</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">all_columns        =</span> <span class="cn">TRUE</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   address.city            address.country                address.type</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 [1]Amsterdam           [1.1]Netherlands               [1.1]physical</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2      [1]Rome   [1.1]Italy | [2.1]Sweden [1.1]physical | [2.1]postal</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 [1]Stockholm   [1.1]Italy | [2.1]Sweden [1.1]physical | [2.1]postal</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 4    [1]Berlin [2.1]France | [3.1]England   [2.1]postal | [3.1]postal</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 5         &lt;NA&gt; [2.1]France | [3.1]England   [2.1]postal | [3.1]postal</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 6    [1]London [2.1]France | [3.1]England   [2.1]postal | [3.1]postal</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co">#             address.use     id            name.given resource_identifier</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 1             [1.1]home [1]id1            [1.1]Marie                   1</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 [1.1]home | [2.1]work [1]id2            [1.1]Susie                   2</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 [1.1]home | [2.1]work [1]id2            [1.1]Susie                   2</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 [1.1]home | [3.1]work [1]id3 [1.1]Frank | [2.1]Max                   3</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 [1.1]home | [3.1]work [1]id3 [1.1]Frank | [2.1]Max                   3</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 [1.1]home | [3.1]work [1]id3 [1.1]Frank | [2.1]Max                   3</span></span></code></pre></div>
<p>The new variable <code>resource_identifier</code> records which rows
in the created data frame belong to which row (usually equivalent to one
resource) in the original data frame. <code>brackets</code> and
<code>sep</code> should be given the same character vectors that have
been used to build the indices in <code>fhir_crack()</code>.
<code>columns</code> is a character vector with the names of the
variables you want to melt. You can provide more than one column here
but it makes sense to only have variables from the same repeating
attribute together in one call to <code>fhir_melt()</code>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;address.city&quot;</span>, <span class="st">&quot;address.use&quot;</span>, <span class="st">&quot;address.type&quot;</span>, <span class="st">&quot;address.country&quot;</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fhir_melt</span>(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">indexed_data_frame =</span> df2,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns            =</span> cols,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">brackets           =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>), </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep                =</span> <span class="st">&quot; | &quot;</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">all_columns        =</span> <span class="cn">TRUE</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   address.city address.country address.type address.use     id</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 [1]Amsterdam  [1]Netherlands  [1]physical     [1]home [1]id1</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2      [1]Rome        [1]Italy  [1]physical     [1]home [1]id2</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 [1]Stockholm       [1]Sweden    [1]postal     [1]work [1]id2</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 4    [1]Berlin            &lt;NA&gt;         &lt;NA&gt;     [1]home [1]id3</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 5         &lt;NA&gt;       [1]France    [1]postal        &lt;NA&gt; [1]id3</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 6    [1]London      [1]England    [1]postal     [1]work [1]id3</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co">#              name.given resource_identifier</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 1            [1.1]Marie                   1</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 2            [1.1]Susie                   2</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 3            [1.1]Susie                   2</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 [1.1]Frank | [2.1]Max                   3</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 [1.1]Frank | [2.1]Max                   3</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 [1.1]Frank | [2.1]Max                   3</span></span></code></pre></div>
<p>If the names of the variables in your data frame have been generated
automatically with <code>fhir_crack()</code> you can find all variable
names belonging to the same attribute with
<code>fhir_common_columns()</code>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">fhir_common_columns</span>(<span class="at">data_frame =</span> df2, <span class="at">column_names_prefix =</span> <span class="st">&quot;address&quot;</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>cols</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] &quot;address.city&quot;    &quot;address.country&quot; &quot;address.type&quot;    &quot;address.use&quot;</span></span></code></pre></div>
<p>With the argument <code>all_columns</code> you can control whether
the resulting data frame contains only the molten columns or all columns
of the original data frame:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fhir_melt</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">indexed_data_frame =</span> df2,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns            =</span> cols,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">brackets           =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>), </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep                =</span> <span class="st">&quot; | &quot;</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">all_columns        =</span> <span class="cn">FALSE</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   resource_identifier address.city address.country address.type address.use</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                   1 [1]Amsterdam  [1]Netherlands  [1]physical     [1]home</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                   2      [1]Rome        [1]Italy  [1]physical     [1]home</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                   2 [1]Stockholm       [1]Sweden    [1]postal     [1]work</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                   3    [1]Berlin            &lt;NA&gt;         &lt;NA&gt;     [1]home</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                   3         &lt;NA&gt;       [1]France    [1]postal        &lt;NA&gt;</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 6                   3    [1]London      [1]England    [1]postal     [1]work</span></span></code></pre></div>
<p>Values on the other variables will just repeat in the newly created
rows.</p>
<p>If you try to melt several variables that don’t belong to the same
element in one call to <code>fhir_melt()</code>, this will cause
problems, because the different elements won’t be combined
correctly:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(cols, <span class="st">&quot;name.given&quot;</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fhir_melt</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">indexed_data_frame =</span> df2,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns            =</span> cols,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">brackets           =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>), </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep                =</span> <span class="st">&quot; | &quot;</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">all_columns        =</span> <span class="cn">TRUE</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   address.city address.country address.type address.use     id name.given</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 [1]Amsterdam  [1]Netherlands  [1]physical     [1]home [1]id1   [1]Marie</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 2      [1]Rome        [1]Italy  [1]physical     [1]home [1]id2   [1]Susie</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 [1]Stockholm       [1]Sweden    [1]postal     [1]work [1]id2       &lt;NA&gt;</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 4    [1]Berlin            &lt;NA&gt;         &lt;NA&gt;     [1]home [1]id3   [1]Frank</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 5         &lt;NA&gt;       [1]France    [1]postal        &lt;NA&gt; [1]id3     [1]Max</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 6    [1]London      [1]England    [1]postal     [1]work [1]id3       &lt;NA&gt;</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   resource_identifier</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                   1</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                   2</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                   2</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                   3</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                   3</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 6                   3</span></span></code></pre></div>
<p>Instead, melt the attributes one after another:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">fhir_common_columns</span>(<span class="at">data_frame =</span> df2, <span class="at">column_names_prefix =</span> <span class="st">&quot;address&quot;</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>molten_1 <span class="ot">&lt;-</span> <span class="fu">fhir_melt</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">indexed_data_frame =</span> df2,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns            =</span> cols,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">brackets           =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep                =</span> <span class="st">&quot; | &quot;</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">all_columns        =</span> <span class="cn">TRUE</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>molten_1</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   address.city address.country address.type address.use     id</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 [1]Amsterdam  [1]Netherlands  [1]physical     [1]home [1]id1</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2      [1]Rome        [1]Italy  [1]physical     [1]home [1]id2</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 [1]Stockholm       [1]Sweden    [1]postal     [1]work [1]id2</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 4    [1]Berlin            &lt;NA&gt;         &lt;NA&gt;     [1]home [1]id3</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 5         &lt;NA&gt;       [1]France    [1]postal        &lt;NA&gt; [1]id3</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 6    [1]London      [1]England    [1]postal     [1]work [1]id3</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co">#              name.given resource_identifier</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 1            [1.1]Marie                   1</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 2            [1.1]Susie                   2</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 3            [1.1]Susie                   2</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 [1.1]Frank | [2.1]Max                   3</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 [1.1]Frank | [2.1]Max                   3</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 [1.1]Frank | [2.1]Max                   3</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>molten_2 <span class="ot">&lt;-</span> <span class="fu">fhir_melt</span>(</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">indexed_data_frame =</span> molten_1,</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns            =</span> <span class="st">&quot;name.given&quot;</span>,</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">brackets           =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>),</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep                =</span> <span class="st">&quot; | &quot;</span>,</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">all_columns        =</span> <span class="cn">TRUE</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>molten_2</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   address.city address.country address.type address.use     id name.given</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 [1]Amsterdam  [1]Netherlands  [1]physical     [1]home [1]id1   [1]Marie</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="co"># 2      [1]Rome        [1]Italy  [1]physical     [1]home [1]id2   [1]Susie</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 [1]Stockholm       [1]Sweden    [1]postal     [1]work [1]id2   [1]Susie</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 4    [1]Berlin            &lt;NA&gt;         &lt;NA&gt;     [1]home [1]id3   [1]Frank</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 5    [1]Berlin            &lt;NA&gt;         &lt;NA&gt;     [1]home [1]id3     [1]Max</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a><span class="co"># 6         &lt;NA&gt;       [1]France    [1]postal        &lt;NA&gt; [1]id3   [1]Frank</span></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a><span class="co"># 7         &lt;NA&gt;       [1]France    [1]postal        &lt;NA&gt; [1]id3     [1]Max</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="co"># 8    [1]London      [1]England    [1]postal     [1]work [1]id3   [1]Frank</span></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a><span class="co"># 9    [1]London      [1]England    [1]postal     [1]work [1]id3     [1]Max</span></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   resource_identifier</span></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                   1</span></span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                   2</span></span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                   3</span></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                   4</span></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                   4</span></span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a><span class="co"># 6                   5</span></span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a><span class="co"># 7                   5</span></span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a><span class="co"># 8                   6</span></span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a><span class="co"># 9                   6</span></span></code></pre></div>
<p>This will give you the appropriate product of all multiple
entries.</p>
</div>
<div id="remove-indices" class="section level3">
<h3>Remove indices</h3>
<p>Once you have sorted out the multiple entries, you might want to get
rid of the indices in your table. This can be achieved using
<code>fhir_rm_indices()</code>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fhir_rm_indices</span>(<span class="at">indexed_data_frame =</span> molten_2, <span class="at">brackets =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   address.city address.country address.type address.use  id name.given</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1    Amsterdam     Netherlands     physical        home id1      Marie</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2         Rome           Italy     physical        home id2      Susie</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 3    Stockholm          Sweden       postal        work id2      Susie</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 4       Berlin            &lt;NA&gt;         &lt;NA&gt;        home id3      Frank</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 5       Berlin            &lt;NA&gt;         &lt;NA&gt;        home id3        Max</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 6         &lt;NA&gt;          France       postal        &lt;NA&gt; id3      Frank</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 7         &lt;NA&gt;          France       postal        &lt;NA&gt; id3        Max</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 8       London         England       postal        work id3      Frank</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 9       London         England       postal        work id3        Max</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   resource_identifier</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                   1</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2                   2</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 3                   3</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 4                   4</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 5                   4</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 6                   5</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 7                   5</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 8                   6</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 9                   6</span></span></code></pre></div>
<p>Again, <code>brackets</code> and <code>sep</code> should be given the
same character vector that was used for <code>fhir_crack()</code> and
<code>fhir_melt()</code> respectively.</p>
</div>
<div id="cast-tables-with-multiple-entries" class="section level3">
<h3>Cast tables with multiple entries</h3>
<p>Instead of spreading the entries across rows, you can also spread
them across columns using <code>fhir_cast()</code>. As you’ve seen above
this can be achieved by setting <code>format = &quot;wide&quot;</code> in
<code>fhir_crack()</code>. There is, however, a function that turns a
<code>compact</code> table into a <code>wide</code> table and this
function is <code>fhir_cast()</code>. It takes a compact table with
multiple entries and the brackets and separator that have been used in
<code>fhir_crack()</code> as input:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fhir_cast</span>(df2, <span class="at">brackets =</span> <span class="fu">c</span>(<span class="st">&quot;[&quot;</span>, <span class="st">&quot;]&quot;</span>), <span class="at">sep =</span> <span class="st">&quot; | &quot;</span>, <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   [1.1]address.city [2.1]address.city [3.1]address.city [1.1]address.country</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1         Amsterdam              &lt;NA&gt;              &lt;NA&gt;          Netherlands</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2              Rome         Stockholm              &lt;NA&gt;                Italy</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 3            Berlin              &lt;NA&gt;            London                 &lt;NA&gt;</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   [2.1]address.country [3.1]address.country [1.1]address.type [2.1]address.type</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1                 &lt;NA&gt;                 &lt;NA&gt;          physical              &lt;NA&gt;</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2               Sweden                 &lt;NA&gt;          physical            postal</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 3               France              England              &lt;NA&gt;            postal</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   [3.1]address.type [1.1]address.use [2.1]address.use [3.1]address.use [1]id</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1              &lt;NA&gt;             home             &lt;NA&gt;             &lt;NA&gt;   id1</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2              &lt;NA&gt;             home             work             &lt;NA&gt;   id2</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 3            postal             home             &lt;NA&gt;             work   id3</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   [1.1]name.given [2.1]name.given</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 1           Marie            &lt;NA&gt;</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2           Susie            &lt;NA&gt;</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 3           Frank             Max</span></span></code></pre></div>
<p>Contrary to <code>fhir_melt()</code> this function requires all
column names to reflect the XPath expression of the respective
attribute. The column containing information on
<code>address/city</code> for example has to be named
<code>adress.city</code> because the information of the indices is
incorporated in those names to avoid duplicate column names. This column
naming scheme is automatically used when you don’t give explicit column
names in the table_description/design for <code>fhir_crack()</code> so
it makes sense to only cast tables that have automatically generated
column names.</p>
<p>The tables produced by <code>fhir_crack(..., format = &quot;wide&quot;)</code>
and <code>fhir_cast()</code> can also be used to recreate the resources
that were cracked in the first place, as you’ll the in the vignette
about recreation of resources.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
